<!doctype html><html lang=en class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Send push notifications to your phone via PUT/POST"><link href=https://ntfy.sh/config/ rel=canonical><link rel=icon href=../static/img/favicon.png><meta name=generator content="mkdocs-1.4.2, mkdocs-material-8.5.10"><title>Configuration - ntfy</title><link rel=stylesheet href=../assets/stylesheets/main.472b142f.min.css><link rel=stylesheet href=../assets/stylesheets/palette.08040f6c.min.css><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback"><style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style><link rel=stylesheet href=../static/css/extra.css><script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script></head> <body dir=ltr data-md-color-scheme=default data-md-color-primary data-md-color-accent> <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#configuring-the-ntfy-server class=md-skip> Skip to content </a> </div> <div data-md-component=announce> </div> <header class=md-header data-md-component=header> <nav class="md-header__inner md-grid" aria-label=Header> <a href=/ title=ntfy class="md-header__button md-logo" aria-label=ntfy data-md-component=logo> <img src=../static/img/ntfy.png alt=logo> </a> <label class="md-header__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg> </label> <div class=md-header__title data-md-component=header-title> <div class=md-header__ellipsis> <div class=md-header__topic> <span class=md-ellipsis> ntfy </span> </div> <div class=md-header__topic data-md-component=header-topic> <span class=md-ellipsis> Configuration </span> </div> </div> </div> <form class=md-header__option data-md-component=palette> <input class=md-option data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme=default data-md-color-primary data-md-color-accent aria-label="Switch to dark mode" type=radio name=__palette id=__palette_1> <label class="md-header__button md-icon" title="Switch to dark mode" for=__palette_2 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 2a7 7 0 0 1 7 7c0 2.38-1.19 4.47-3 5.74V17a1 1 0 0 1-1 1H9a1 1 0 0 1-1-1v-2.26C6.19 13.47 5 11.38 5 9a7 7 0 0 1 7-7M9 21v-1h6v1a1 1 0 0 1-1 1h-4a1 1 0 0 1-1-1m3-17a5 5 0 0 0-5 5c0 2.05 1.23 3.81 3 4.58V16h4v-2.42c1.77-.77 3-2.53 3-4.58a5 5 0 0 0-5-5Z"/></svg> </label> <input class=md-option data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme=slate data-md-color-primary data-md-color-accent=indigo aria-label="Switch to light mode" type=radio name=__palette id=__palette_2> <label class="md-header__button md-icon" title="Switch to light mode" for=__palette_1 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 2a7 7 0 0 0-7 7c0 2.38 1.19 4.47 3 5.74V17a1 1 0 0 0 1 1h6a1 1 0 0 0 1-1v-2.26c1.81-1.27 3-3.36 3-5.74a7 7 0 0 0-7-7M9 21a1 1 0 0 0 1 1h4a1 1 0 0 0 1-1v-1H9v1Z"/></svg> </label> </form> <label class="md-header__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=Search placeholder=Search autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query required> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg> </label> <nav class=md-search__options aria-label=Search> <a href=javascript:void(0) class="md-search__icon md-icon" title=Share aria-label=Share data-clipboard data-clipboard-text data-md-component=search-share tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7 0-.24-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91 1.61 0 2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08Z"/></svg> </a> <button type=reset class="md-search__icon md-icon" title=Clear aria-label=Clear tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg> </button> </nav> <div class=md-search__suggest data-md-component=search-suggest></div> </form> <div class=md-search__output> <div class=md-search__scrollwrap data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> Initializing search </div> <ol class=md-search-result__list></ol> </div> </div> </div> </div> </div> <div class=md-header__source> <a href=https://github.com/binwiederhier/ntfy title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg> </div> <div class=md-source__repository> binwiederhier/ntfy </div> </a> </div> </nav> </header> <div class=md-container data-md-component=container> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary md-nav--integrated" aria-label=Navigation data-md-level=0> <label class=md-nav__title for=__drawer> <a href=/ title=ntfy class="md-nav__button md-logo" aria-label=ntfy data-md-component=logo> <img src=../static/img/ntfy.png alt=logo> </a> ntfy </label> <div class=md-nav__source> <a href=https://github.com/binwiederhier/ntfy title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg> </div> <div class=md-source__repository> binwiederhier/ntfy </div> </a> </div> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=.. class=md-nav__link> Getting started </a> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_2 type=checkbox id=__nav_2> <label class=md-nav__link for=__nav_2> Publishing <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Publishing data-md-level=1> <label class=md-nav__title for=__nav_2> <span class="md-nav__icon md-icon"></span> Publishing </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../publish/ class=md-nav__link> Sending messages </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_3 type=checkbox id=__nav_3> <label class=md-nav__link for=__nav_3> Subscribing <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Subscribing data-md-level=1> <label class=md-nav__title for=__nav_3> <span class="md-nav__icon md-icon"></span> Subscribing </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../subscribe/phone/ class=md-nav__link> From your phone </a> </li> <li class=md-nav__item> <a href=../subscribe/web/ class=md-nav__link> From the Web UI </a> </li> <li class=md-nav__item> <a href=../subscribe/cli/ class=md-nav__link> From the CLI </a> </li> <li class=md-nav__item> <a href=../subscribe/api/ class=md-nav__link> Using the API </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_4 type=checkbox id=__nav_4 checked> <label class=md-nav__link for=__nav_4> Self-hosting <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Self-hosting data-md-level=1> <label class=md-nav__title for=__nav_4> <span class="md-nav__icon md-icon"></span> Self-hosting </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../install/ class=md-nav__link> Installation </a> </li> <li class="md-nav__item md-nav__item--active"> <input class="md-nav__toggle md-toggle" data-md-toggle=toc type=checkbox id=__toc> <label class="md-nav__link md-nav__link--active" for=__toc> Configuration <span class="md-nav__icon md-icon"></span> </label> <a href=./ class="md-nav__link md-nav__link--active"> Configuration </a> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#quick-start class=md-nav__link> Quick start </a> </li> <li class=md-nav__item> <a href=#example-config class=md-nav__link> Example config </a> </li> <li class=md-nav__item> <a href=#message-cache class=md-nav__link> Message cache </a> </li> <li class=md-nav__item> <a href=#attachments class=md-nav__link> Attachments </a> </li> <li class=md-nav__item> <a href=#access-control class=md-nav__link> Access control </a> <nav class=md-nav aria-label="Access control"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#users-and-roles class=md-nav__link> Users and roles </a> </li> <li class=md-nav__item> <a href=#access-control-list-acl class=md-nav__link> Access control list (ACL) </a> </li> <li class=md-nav__item> <a href=#example-private-instance class=md-nav__link> Example: Private instance </a> </li> <li class=md-nav__item> <a href=#example-unifiedpush class=md-nav__link> Example: UnifiedPush </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#e-mail-notifications class=md-nav__link> E-mail notifications </a> </li> <li class=md-nav__item> <a href=#e-mail-publishing class=md-nav__link> E-mail publishing </a> </li> <li class=md-nav__item> <a href=#behind-a-proxy-tls-etc class=md-nav__link> Behind a proxy (TLS, etc.) </a> <nav class=md-nav aria-label="Behind a proxy (TLS, etc.)"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#tlsssl class=md-nav__link> TLS/SSL </a> </li> <li class=md-nav__item> <a href=#nginxapache2caddy class=md-nav__link> nginx/Apache2/caddy </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#firebase-fcm class=md-nav__link> Firebase (FCM) </a> </li> <li class=md-nav__item> <a href=#ios-instant-notifications class=md-nav__link> iOS instant notifications </a> </li> <li class=md-nav__item> <a href=#rate-limiting class=md-nav__link> Rate limiting </a> <nav class=md-nav aria-label="Rate limiting"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#general-limits class=md-nav__link> General limits </a> </li> <li class=md-nav__item> <a href=#request-limits class=md-nav__link> Request limits </a> </li> <li class=md-nav__item> <a href=#attachment-limits class=md-nav__link> Attachment limits </a> </li> <li class=md-nav__item> <a href=#e-mail-limits class=md-nav__link> E-mail limits </a> </li> <li class=md-nav__item> <a href=#firebase-limits class=md-nav__link> Firebase limits </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#tuning-for-scale class=md-nav__link> Tuning for scale </a> <nav class=md-nav aria-label="Tuning for scale"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#message-cache_1 class=md-nav__link> Message cache </a> </li> <li class=md-nav__item> <a href=#for-systemd-services class=md-nav__link> For systemd services </a> </li> <li class=md-nav__item> <a href=#outside-of-systemd class=md-nav__link> Outside of systemd </a> </li> <li class=md-nav__item> <a href=#proxy-limits-nginx-apache2 class=md-nav__link> Proxy limits (nginx, Apache2) </a> </li> <li class=md-nav__item> <a href=#banning-bad-actors-fail2ban class=md-nav__link> Banning bad actors (fail2ban) </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#debuggingtracing class=md-nav__link> Debugging/tracing </a> </li> <li class=md-nav__item> <a href=#config-options class=md-nav__link> Config options </a> </li> <li class=md-nav__item> <a href=#command-line-options class=md-nav__link> Command line options </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_5 type=checkbox id=__nav_5> <label class=md-nav__link for=__nav_5> Other things <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Other things" data-md-level=1> <label class=md-nav__title for=__nav_5> <span class="md-nav__icon md-icon"></span> Other things </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../faq/ class=md-nav__link> FAQs </a> </li> <li class=md-nav__item> <a href=../examples/ class=md-nav__link> Examples </a> </li> <li class=md-nav__item> <a href=../integrations/ class=md-nav__link> Integrations + projects </a> </li> <li class=md-nav__item> <a href=../releases/ class=md-nav__link> Release notes </a> </li> <li class=md-nav__item> <a href=../deprecations/ class=md-nav__link> Deprecation notices </a> </li> <li class=md-nav__item> <a href=../emojis/ class=md-nav__link> Emojis ðŸ¥³ ðŸŽ‰ </a> </li> <li class=md-nav__item> <a href=../develop/ class=md-nav__link> Development </a> </li> <li class=md-nav__item> <a href=../privacy/ class=md-nav__link> Privacy policy </a> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class=md-content data-md-component=content> <article class="md-content__inner md-typeset"> <a href=https://github.com/binwiederhier/ntfy/blob/main/docs/config.md title="Edit this page" class="md-content__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25Z"/></svg> </a> <h1 id=configuring-the-ntfy-server>Configuring the ntfy server<a class=headerlink href=#configuring-the-ntfy-server title="Permanent link">&para;</a></h1> <p>The ntfy server can be configured in three ways: using a config file (typically at <code>/etc/ntfy/server.yml</code>, see <a href=https://github.com/binwiederhier/ntfy/blob/main/server/server.yml>server.yml</a>), via command line arguments or using environment variables.</p> <h2 id=quick-start>Quick start<a class=headerlink href=#quick-start title="Permanent link">&para;</a></h2> <p>By default, simply running <code>ntfy serve</code> will start the server at port 80. No configuration needed. Batteries included ðŸ˜€. If everything works as it should, you'll see something like this: <div class=highlight><pre><span></span><code>$ ntfy serve
2021/11/30 19:59:08 Listening on :80
</code></pre></div></p> <p>You can immediately start <a href=../publish/ >publishing messages</a>, or subscribe via the <a href=../subscribe/phone/ >Android app</a>, <a href=../subscribe/web/ >the web UI</a>, or simply via <a href=../subscribe/api/ >curl or your favorite HTTP client</a>. To configure the server further, check out the <a href=#config-options>config options table</a> or simply type <code>ntfy serve --help</code> to get a list of <a href=#command-line-options>command line options</a>.</p> <h2 id=example-config>Example config<a class=headerlink href=#example-config title="Permanent link">&para;</a></h2> <div class="admonition info"> <p class=admonition-title>Info</p> <p>Definitely check out the <strong><a href=https://github.com/binwiederhier/ntfy/blob/main/server/server.yml>server.yml</a></strong> file. It contains examples and detailed descriptions of all the settings.</p> </div> <p>The most basic settings are <code>base-url</code> (the external URL of the ntfy server), the HTTP/HTTPS listen address (<code>listen-http</code> and <code>listen-https</code>), and socket path (<code>listen-unix</code>). All the other things are additional features.</p> <p>Here are a few working sample configs:</p> <div class="tabbed-set tabbed-alternate" data-tabs=1:3><input checked=checked id=__tabbed_1_1 name=__tabbed_1 type=radio><input id=__tabbed_1_2 name=__tabbed_1 type=radio><input id=__tabbed_1_3 name=__tabbed_1 type=radio><div class=tabbed-labels><label for=__tabbed_1_1>server.yml (HTTP-only, with cache + attachments)</label><label for=__tabbed_1_2>server.yml (HTTP+HTTPS, with cache + attachments)</label><label for=__tabbed_1_3>server.yml (ntfy.sh config)</label></div> <div class=tabbed-content> <div class=tabbed-block> <div class=highlight><pre><span></span><code><span class=nt>base-url</span><span class=p>:</span><span class=w> </span><span class=s>&quot;http://ntfy.example.com&quot;</span><span class=w></span>
<span class=nt>cache-file</span><span class=p>:</span><span class=w> </span><span class=s>&quot;/var/cache/ntfy/cache.db&quot;</span><span class=w></span>
<span class=nt>attachment-cache-dir</span><span class=p>:</span><span class=w> </span><span class=s>&quot;/var/cache/ntfy/attachments&quot;</span><span class=w></span>
</code></pre></div> </div> <div class=tabbed-block> <div class=highlight><pre><span></span><code><span class=nt>base-url</span><span class=p>:</span><span class=w> </span><span class=s>&quot;http://ntfy.example.com&quot;</span><span class=w></span>
<span class=nt>listen-http</span><span class=p>:</span><span class=w> </span><span class=s>&quot;:80&quot;</span><span class=w></span>
<span class=nt>listen-https</span><span class=p>:</span><span class=w> </span><span class=s>&quot;:443&quot;</span><span class=w></span>
<span class=nt>key-file</span><span class=p>:</span><span class=w> </span><span class=s>&quot;/etc/letsencrypt/live/ntfy.example.com.key&quot;</span><span class=w></span>
<span class=nt>cert-file</span><span class=p>:</span><span class=w> </span><span class=s>&quot;/etc/letsencrypt/live/ntfy.example.com.crt&quot;</span><span class=w></span>
<span class=nt>cache-file</span><span class=p>:</span><span class=w> </span><span class=s>&quot;/var/cache/ntfy/cache.db&quot;</span><span class=w></span>
<span class=nt>attachment-cache-dir</span><span class=p>:</span><span class=w> </span><span class=s>&quot;/var/cache/ntfy/attachments&quot;</span><span class=w></span>
</code></pre></div> </div> <div class=tabbed-block> <div class=highlight><pre><span></span><code><span class=c1># All the things: Behind a proxy, Firebase, cache, attachments, </span><span class=w></span>
<span class=c1># SMTP publishing &amp; receiving</span><span class=w></span>

<span class=nt>base-url</span><span class=p>:</span><span class=w> </span><span class=s>&quot;https://ntfy.sh&quot;</span><span class=w></span>
<span class=nt>listen-http</span><span class=p>:</span><span class=w> </span><span class=s>&quot;127.0.0.1:2586&quot;</span><span class=w></span>
<span class=nt>firebase-key-file</span><span class=p>:</span><span class=w> </span><span class=s>&quot;/etc/ntfy/firebase.json&quot;</span><span class=w></span>
<span class=nt>cache-file</span><span class=p>:</span><span class=w> </span><span class=s>&quot;/var/cache/ntfy/cache.db&quot;</span><span class=w></span>
<span class=nt>behind-proxy</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">true</span><span class=w></span>
<span class=nt>attachment-cache-dir</span><span class=p>:</span><span class=w> </span><span class=s>&quot;/var/cache/ntfy/attachments&quot;</span><span class=w></span>
<span class=nt>smtp-sender-addr</span><span class=p>:</span><span class=w> </span><span class=s>&quot;email-smtp.us-east-2.amazonaws.com:587&quot;</span><span class=w></span>
<span class=nt>smtp-sender-user</span><span class=p>:</span><span class=w> </span><span class=s>&quot;AKIDEADBEEFAFFE12345&quot;</span><span class=w></span>
<span class=nt>smtp-sender-pass</span><span class=p>:</span><span class=w> </span><span class=s>&quot;Abd13Kf+sfAk2DzifjafldkThisIsNotARealKeyOMG.&quot;</span><span class=w></span>
<span class=nt>smtp-sender-from</span><span class=p>:</span><span class=w> </span><span class=s>&quot;ntfy@ntfy.sh&quot;</span><span class=w></span>
<span class=nt>smtp-server-listen</span><span class=p>:</span><span class=w> </span><span class=s>&quot;:25&quot;</span><span class=w></span>
<span class=nt>smtp-server-domain</span><span class=p>:</span><span class=w> </span><span class=s>&quot;ntfy.sh&quot;</span><span class=w></span>
<span class=nt>smtp-server-addr-prefix</span><span class=p>:</span><span class=w> </span><span class=s>&quot;ntfy-&quot;</span><span class=w></span>
<span class=nt>keepalive-interval</span><span class=p>:</span><span class=w> </span><span class=s>&quot;45s&quot;</span><span class=w></span>
</code></pre></div> </div> </div> </div> <h2 id=message-cache>Message cache<a class=headerlink href=#message-cache title="Permanent link">&para;</a></h2> <p>If desired, ntfy can temporarily keep notifications in an in-memory or an on-disk cache. Caching messages for a short period of time is important to allow <a href=../subscribe/phone/ >phones</a> and other devices with brittle Internet connections to be able to retrieve notifications that they may have missed. </p> <p>By default, ntfy keeps messages <strong>in-memory for 12 hours</strong>, which means that <strong>cached messages do not survive an application restart</strong>. You can override this behavior using the following config settings:</p> <ul> <li><code>cache-file</code>: if set, ntfy will store messages in a SQLite based cache (default is empty, which means in-memory cache). <strong>This is required if you'd like messages to be retained across restarts</strong>.</li> <li><code>cache-duration</code>: defines the duration for which messages are stored in the cache (default is <code>12h</code>). </li> </ul> <p>You can also entirely disable the cache by setting <code>cache-duration</code> to <code>0</code>. When the cache is disabled, messages are only passed on to the connected subscribers, but never stored on disk or even kept in memory longer than is needed to forward the message to the subscribers.</p> <p>Subscribers can retrieve cached messaging using the <a href=../subscribe/api/#poll-for-messages><code>poll=1</code> parameter</a>, as well as the <a href=../subscribe/api/#fetch-cached-messages><code>since=</code> parameter</a>.</p> <h2 id=attachments>Attachments<a class=headerlink href=#attachments title="Permanent link">&para;</a></h2> <p>If desired, you may allow users to upload and <a href=../publish/#attachments>attach files to notifications</a>. To enable this feature, you have to simply configure an attachment cache directory and a base URL (<code>attachment-cache-dir</code>, <code>base-url</code>). Once these options are set and the directory is writable by the server user, you can upload attachments via PUT.</p> <p>By default, attachments are stored in the disk-cache <strong>for only 3 hours</strong>. The main reason for this is to avoid legal issues and such when hosting user controlled content. Typically, this is more than enough time for the user (or the auto download feature) to download the file. The following config options are relevant to attachments:</p> <ul> <li><code>base-url</code> is the root URL for the ntfy server; this is needed for the generated attachment URLs</li> <li><code>attachment-cache-dir</code> is the cache directory for attached files</li> <li><code>attachment-total-size-limit</code> is the size limit of the on-disk attachment cache (default: 5G)</li> <li><code>attachment-file-size-limit</code> is the per-file attachment size limit (e.g. 300k, 2M, 100M, default: 15M)</li> <li><code>attachment-expiry-duration</code> is the duration after which uploaded attachments will be deleted (e.g. 3h, 20h, default: 3h)</li> </ul> <p>Here's an example config using mostly the defaults (except for the cache directory, which is empty by default): </p> <div class="tabbed-set tabbed-alternate" data-tabs=2:2><input checked=checked id=__tabbed_2_1 name=__tabbed_2 type=radio><input id=__tabbed_2_2 name=__tabbed_2 type=radio><div class=tabbed-labels><label for=__tabbed_2_1>/etc/ntfy/server.yml (minimal)</label><label for=__tabbed_2_2>/etc/ntfy/server.yml (all options)</label></div> <div class=tabbed-content> <div class=tabbed-block> <div class=highlight><pre><span></span><code><span class=nt>base-url</span><span class=p>:</span><span class=w> </span><span class=s>&quot;https://ntfy.sh&quot;</span><span class=w></span>
<span class=nt>attachment-cache-dir</span><span class=p>:</span><span class=w> </span><span class=s>&quot;/var/cache/ntfy/attachments&quot;</span><span class=w></span>
</code></pre></div> </div> <div class=tabbed-block> <div class=highlight><pre><span></span><code><span class=nt>base-url</span><span class=p>:</span><span class=w> </span><span class=s>&quot;https://ntfy.sh&quot;</span><span class=w></span>
<span class=nt>attachment-cache-dir</span><span class=p>:</span><span class=w> </span><span class=s>&quot;/var/cache/ntfy/attachments&quot;</span><span class=w></span>
<span class=nt>attachment-total-size-limit</span><span class=p>:</span><span class=w> </span><span class=s>&quot;5G&quot;</span><span class=w></span>
<span class=nt>attachment-file-size-limit</span><span class=p>:</span><span class=w> </span><span class=s>&quot;15M&quot;</span><span class=w></span>
<span class=nt>attachment-expiry-duration</span><span class=p>:</span><span class=w> </span><span class=s>&quot;3h&quot;</span><span class=w></span>
<span class=nt>visitor-attachment-total-size-limit</span><span class=p>:</span><span class=w> </span><span class=s>&quot;100M&quot;</span><span class=w></span>
<span class=nt>visitor-attachment-daily-bandwidth-limit</span><span class=p>:</span><span class=w> </span><span class=s>&quot;500M&quot;</span><span class=w></span>
</code></pre></div> </div> </div> </div> <p>Please also refer to the <a href=#rate-limiting>rate limiting</a> settings below, specifically <code>visitor-attachment-total-size-limit</code> and <code>visitor-attachment-daily-bandwidth-limit</code>. Setting these conservatively is necessary to avoid abuse.</p> <h2 id=access-control>Access control<a class=headerlink href=#access-control title="Permanent link">&para;</a></h2> <p>By default, the ntfy server is open for everyone, meaning <strong>everyone can read and write to any topic</strong> (this is how ntfy.sh is configured). To restrict access to your own server, you can optionally configure authentication and authorization. </p> <p>ntfy's auth is implemented with a simple <a href=https://www.sqlite.org/ >SQLite</a>-based backend. It implements two roles (<code>user</code> and <code>admin</code>) and per-topic <code>read</code> and <code>write</code> permissions using an <a href=https://en.wikipedia.org/wiki/Access-control_list>access control list (ACL)</a>. Access control entries can be applied to users as well as the special everyone user (<code>*</code>), which represents anonymous API access. </p> <p>To set up auth, simply <strong>configure the following two options</strong>:</p> <ul> <li><code>auth-file</code> is the user/access database; it is created automatically if it doesn't already exist; suggested location <code>/var/lib/ntfy/user.db</code> (easiest if deb/rpm package is used)</li> <li><code>auth-default-access</code> defines the default/fallback access if no access control entry is found; it can be set to <code>read-write</code> (default), <code>read-only</code>, <code>write-only</code> or <code>deny-all</code>.</li> </ul> <p>Once configured, you can use the <code>ntfy user</code> command to <a href=#users-and-roles>add or modify users</a>, and the <code>ntfy access</code> command lets you <a href=#access-control-list-acl>modify the access control list</a> for specific users and topic patterns. Both of these commands <strong>directly edit the auth database</strong> (as defined in <code>auth-file</code>), so they only work on the server, and only if the user accessing them has the right permissions.</p> <h3 id=users-and-roles>Users and roles<a class=headerlink href=#users-and-roles title="Permanent link">&para;</a></h3> <p>The <code>ntfy user</code> command allows you to add/remove/change users in the ntfy user database, as well as change passwords or roles (<code>user</code> or <code>admin</code>). In practice, you'll often just create one admin user with <code>ntfy user add --role=admin ...</code> and be done with all this (see <a href=#example-private-instance>example below</a>).</p> <p><strong>Roles:</strong></p> <ul> <li>Role <code>user</code> (default): Users with this role have no special permissions. Manage access using <code>ntfy access</code> (see <a href=#access-control-list-acl>below</a>).</li> <li>Role <code>admin</code>: Users with this role can read/write to all topics. Granular access control is not necessary.</li> </ul> <p><strong>Example commands</strong> (type <code>ntfy user --help</code> or <code>ntfy user COMMAND --help</code> for more details):</p> <div class=highlight><pre><span></span><code>ntfy user list                     # Shows list of users (alias: &#39;ntfy access&#39;)
ntfy user add phil                 # Add regular user phil  
ntfy user add --role=admin phil    # Add admin user phil
ntfy user del phil                 # Delete user phil
ntfy user change-pass phil         # Change password for user phil
ntfy user change-role phil admin   # Make user phil an admin
</code></pre></div> <h3 id=access-control-list-acl>Access control list (ACL)<a class=headerlink href=#access-control-list-acl title="Permanent link">&para;</a></h3> <p>The access control list (ACL) <strong>manages access to topics for non-admin users, and for anonymous access (<code>everyone</code>/<code>*</code>)</strong>. Each entry represents the access permissions for a user to a specific topic or topic pattern. </p> <p>The ACL can be displayed or modified with the <code>ntfy access</code> command:</p> <div class=highlight><pre><span></span><code>ntfy access                            # Shows access control list (alias: &#39;ntfy user list&#39;)
ntfy access USERNAME                   # Shows access control entries for USERNAME
ntfy access USERNAME TOPIC PERMISSION  # Allow/deny access for USERNAME to TOPIC
</code></pre></div> <p>A <code>USERNAME</code> is an existing user, as created with <code>ntfy user add</code> (see <a href=#users-and-roles>users and roles</a>), or the anonymous user <code>everyone</code> or <code>*</code>, which represents clients that access the API without username/password.</p> <p>A <code>TOPIC</code> is either a specific topic name (e.g. <code>mytopic</code>, or <code>phil_alerts</code>), or a wildcard pattern that matches any number of topics (e.g. <code>alerts_*</code> or <code>ben-*</code>). Only the wildcard character <code>*</code> is supported. It stands for zero to any number of characters.</p> <p>A <code>PERMISSION</code> is any of the following supported permissions:</p> <ul> <li><code>read-write</code> (alias: <code>rw</code>): Allows <a href=../publish/ >publishing messages</a> to the given topic, as well as <a href=../subscribe/api/ >subscribing</a> and reading messages</li> <li><code>read-only</code> (aliases: <code>read</code>, <code>ro</code>): Allows only subscribing and reading messages, but not publishing to the topic</li> <li><code>write-only</code> (aliases: <code>write</code>, <code>wo</code>): Allows only publishing to the topic, but not subscribing to it</li> <li><code>deny</code> (alias: <code>none</code>): Allows neither publishing nor subscribing to a topic </li> </ul> <p><strong>Example commands</strong> (type <code>ntfy access --help</code> for more details): <div class=highlight><pre><span></span><code>ntfy access                        # Shows entire access control list
ntfy access phil                   # Shows access for user phil
ntfy access phil mytopic rw        # Allow read-write access to mytopic for user phil
ntfy access everyone mytopic rw    # Allow anonymous read-write access to mytopic
ntfy access everyone &quot;up*&quot; write   # Allow anonymous write-only access to topics &quot;up...&quot;
ntfy access --reset                # Reset entire access control list
ntfy access --reset phil           # Reset all access for user phil
ntfy access --reset phil mytopic   # Reset access for user phil and topic mytopic
</code></pre></div></p> <p><strong>Example ACL:</strong> <div class=highlight><pre><span></span><code>$ ntfy access
user phil (admin)
- read-write access to all topics (admin role)
user ben (user)
- read-write access to topic garagedoor
- read-write access to topic alerts*
- read-only access to topic furnace
user * (anonymous)
- read-only access to topic announcements
- read-only access to topic server-stats
- no access to any (other) topics (server config)
</code></pre></div></p> <p>In this example, <code>phil</code> has the role <code>admin</code>, so he has read-write access to all topics (no ACL entries are necessary). User <code>ben</code> has three topic-specific entries. He can read, but not write to topic <code>furnace</code>, and has read-write access to topic <code>garagedoor</code> and all topics starting with the word <code>alerts</code> (wildcards). Clients that are not authenticated (called <code>*</code>/<code>everyone</code>) only have read access to the <code>announcements</code> and <code>server-stats</code> topics.</p> <h3 id=example-private-instance>Example: Private instance<a class=headerlink href=#example-private-instance title="Permanent link">&para;</a></h3> <p>The easiest way to configure a private instance is to set <code>auth-default-access</code> to <code>deny-all</code> in the <code>server.yml</code>:</p> <div class="tabbed-set tabbed-alternate" data-tabs=3:1><input checked=checked id=__tabbed_3_1 name=__tabbed_3 type=radio><div class=tabbed-labels><label for=__tabbed_3_1>/etc/ntfy/server.yml</label></div> <div class=tabbed-content> <div class=tabbed-block> <div class=highlight><pre><span></span><code><span class=nt>auth-file</span><span class=p>:</span><span class=w> </span><span class=s>&quot;/var/lib/ntfy/user.db&quot;</span><span class=w></span>
<span class=nt>auth-default-access</span><span class=p>:</span><span class=w> </span><span class=s>&quot;deny-all&quot;</span><span class=w></span>
</code></pre></div> </div> </div> </div> <p>After that, simply create an <code>admin</code> user:</p> <div class=highlight><pre><span></span><code>$ ntfy user add --role=admin phil
password: mypass
confirm: mypass
user phil added with role admin 
</code></pre></div> <p>Once you've done that, you can publish and subscribe using <a href=https://en.wikipedia.org/wiki/Basic_access_authentication>Basic Auth</a> with the given username/password. Be sure to use HTTPS to avoid eavesdropping and exposing your password. Here's a simple example:</p> <div class="tabbed-set tabbed-alternate" data-tabs=4:7><input checked=checked id=__tabbed_4_1 name=__tabbed_4 type=radio><input id=__tabbed_4_2 name=__tabbed_4 type=radio><input id=__tabbed_4_3 name=__tabbed_4 type=radio><input id=__tabbed_4_4 name=__tabbed_4 type=radio><input id=__tabbed_4_5 name=__tabbed_4 type=radio><input id=__tabbed_4_6 name=__tabbed_4 type=radio><input id=__tabbed_4_7 name=__tabbed_4 type=radio><div class=tabbed-labels><label for=__tabbed_4_1>Command line (curl)</label><label for=__tabbed_4_2>ntfy CLI</label><label for=__tabbed_4_3>HTTP</label><label for=__tabbed_4_4>JavaScript</label><label for=__tabbed_4_5>Go</label><label for=__tabbed_4_6>Python</label><label for=__tabbed_4_7>PHP</label></div> <div class=tabbed-content> <div class=tabbed-block> <div class=highlight><pre><span></span><code>curl \
    -u phil:mypass \
    -d &quot;Look ma, with auth&quot; \
    https://ntfy.example.com/mysecrets
</code></pre></div> </div> <div class=tabbed-block> <div class=highlight><pre><span></span><code>ntfy publish \
    -u phil:mypass \
    ntfy.example.com/mysecrets \
    &quot;Look ma, with auth&quot;
</code></pre></div> </div> <div class=tabbed-block> <div class=highlight><pre><span></span><code><span class=nf>POST</span> <span class=nn>/mysecrets</span> <span class=kr>HTTP</span><span class=o>/</span><span class=m>1.1</span>
<span class=na>Host</span><span class=o>:</span> <span class=l>ntfy.example.com</span>
<span class=na>Authorization</span><span class=o>:</span> <span class=l>Basic cGhpbDpteXBhc3M=</span>

Look ma, with auth
</code></pre></div> </div> <div class=tabbed-block> <div class=highlight><pre><span></span><code><span class=nx>fetch</span><span class=p>(</span><span class=s1>&#39;https://ntfy.example.com/mysecrets&#39;</span><span class=p>,</span><span class=w> </span><span class=p>{</span><span class=w></span>
<span class=w>    </span><span class=nx>method</span><span class=o>:</span><span class=w> </span><span class=s1>&#39;POST&#39;</span><span class=p>,</span><span class=w> </span><span class=c1>// PUT works too</span><span class=w></span>
<span class=w>    </span><span class=nx>body</span><span class=o>:</span><span class=w> </span><span class=s1>&#39;Look ma, with auth&#39;</span><span class=p>,</span><span class=w></span>
<span class=w>    </span><span class=nx>headers</span><span class=o>:</span><span class=w> </span><span class=p>{</span><span class=w></span>
<span class=w>        </span><span class=s1>&#39;Authorization&#39;</span><span class=o>:</span><span class=w> </span><span class=s1>&#39;Basic cGhpbDpteXBhc3M=&#39;</span><span class=w></span>
<span class=w>    </span><span class=p>}</span><span class=w></span>
<span class=p>})</span><span class=w></span>
</code></pre></div> </div> <div class=tabbed-block> <div class=highlight><pre><span></span><code><span class=nx>req</span><span class=p>,</span><span class=w> </span><span class=nx>_</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>http</span><span class=p>.</span><span class=nx>NewRequest</span><span class=p>(</span><span class=s>&quot;POST&quot;</span><span class=p>,</span><span class=w> </span><span class=s>&quot;https://ntfy.example.com/mysecrets&quot;</span><span class=p>,</span><span class=w></span>
<span class=w>    </span><span class=nx>strings</span><span class=p>.</span><span class=nx>NewReader</span><span class=p>(</span><span class=s>&quot;Look ma, with auth&quot;</span><span class=p>))</span><span class=w></span>
<span class=nx>req</span><span class=p>.</span><span class=nx>Header</span><span class=p>.</span><span class=nx>Set</span><span class=p>(</span><span class=s>&quot;Authorization&quot;</span><span class=p>,</span><span class=w> </span><span class=s>&quot;Basic cGhpbDpteXBhc3M=&quot;</span><span class=p>)</span><span class=w></span>
<span class=nx>http</span><span class=p>.</span><span class=nx>DefaultClient</span><span class=p>.</span><span class=nx>Do</span><span class=p>(</span><span class=nx>req</span><span class=p>)</span><span class=w></span>
</code></pre></div> </div> <div class=tabbed-block> <div class=highlight><pre><span></span><code><span class=n>requests</span><span class=o>.</span><span class=n>post</span><span class=p>(</span><span class=s2>&quot;https://ntfy.example.com/mysecrets&quot;</span><span class=p>,</span>
    <span class=n>data</span><span class=o>=</span><span class=s2>&quot;Look ma, with auth&quot;</span><span class=p>,</span>
    <span class=n>headers</span><span class=o>=</span><span class=p>{</span>
        <span class=s2>&quot;Authorization&quot;</span><span class=p>:</span> <span class=s2>&quot;Basic cGhpbDpteXBhc3M=&quot;</span>
    <span class=p>})</span>
</code></pre></div> </div> <div class=tabbed-block> <div class=highlight><pre><span></span><code><span class=nb>file_get_contents</span><span class=p>(</span><span class=s1>&#39;https://ntfy.example.com/mysecrets&#39;</span><span class=p>,</span> <span class=k>false</span><span class=p>,</span> <span class=nb>stream_context_create</span><span class=p>([</span>
    <span class=s1>&#39;http&#39;</span> <span class=o>=&gt;</span> <span class=p>[</span>
        <span class=s1>&#39;method&#39;</span> <span class=o>=&gt;</span> <span class=s1>&#39;POST&#39;</span><span class=p>,</span> <span class=c1>// PUT also works</span>
        <span class=s1>&#39;header&#39;</span> <span class=o>=&gt;</span> 
            <span class=s1>&#39;Content-Type: text/plain\r\n&#39;</span> <span class=o>.</span>
            <span class=s1>&#39;Authorization: Basic cGhpbDpteXBhc3M=&#39;</span><span class=p>,</span>
        <span class=s1>&#39;content&#39;</span> <span class=o>=&gt;</span> <span class=s1>&#39;Look ma, with auth&#39;</span>
    <span class=p>]</span>
<span class=p>]));</span>
</code></pre></div> </div> </div> </div> <h3 id=example-unifiedpush>Example: UnifiedPush<a class=headerlink href=#example-unifiedpush title="Permanent link">&para;</a></h3> <p><a href=https://unifiedpush.org>UnifiedPush</a> requires that the <a href=https://unifiedpush.org/spec/definitions/#application-server>application server</a> (e.g. Synapse, Fediverse Server, â€¦) has anonymous write access to the <a href=https://unifiedpush.org/spec/definitions/#endpoint>topic</a> used for push messages. The topic names used by UnifiedPush all start with the <code>up*</code> prefix. Please refer to the <strong><a href=https://unifiedpush.org/users/distributors/ntfy/#limit-access-to-some-users>UnifiedPush documentation</a></strong> for more details.</p> <p>To enable support for UnifiedPush for private servers (i.e. <code>auth-default-access: "deny-all"</code>), you should either allow anonymous write access for the entire prefix or explicitly per topic:</p> <div class="tabbed-set tabbed-alternate" data-tabs=5:2><input checked=checked id=__tabbed_5_1 name=__tabbed_5 type=radio><input id=__tabbed_5_2 name=__tabbed_5 type=radio><div class=tabbed-labels><label for=__tabbed_5_1>Prefix</label><label for=__tabbed_5_2>Explicitly</label></div> <div class=tabbed-content> <div class=tabbed-block> <div class=highlight><pre><span></span><code>$ ntfy access &#39;*&#39; &#39;up*&#39; write-only
</code></pre></div> </div> <div class=tabbed-block> <div class=highlight><pre><span></span><code>$ ntfy access &#39;*&#39; upYzMtZGZiYTY5 write-only
</code></pre></div> </div> </div> </div> <h2 id=e-mail-notifications>E-mail notifications<a class=headerlink href=#e-mail-notifications title="Permanent link">&para;</a></h2> <p>To allow forwarding messages via e-mail, you can configure an <strong>SMTP server for outgoing messages</strong>. Once configured, you can set the <code>X-Email</code> header to <a href=../publish/#e-mail-notifications>send messages via e-mail</a> (e.g. <code>curl -d "hi there" -H "X-Email: phil@example.com" ntfy.sh/mytopic</code>).</p> <p>As of today, only SMTP servers with PLAIN auth and STARTLS are supported. To enable e-mail sending, you must set the following settings:</p> <ul> <li><code>base-url</code> is the root URL for the ntfy server; this is needed for e-mail footer</li> <li><code>smtp-sender-addr</code> is the hostname:port of the SMTP server</li> <li><code>smtp-sender-user</code> and <code>smtp-sender-pass</code> are the username and password of the SMTP user</li> <li><code>smtp-sender-from</code> is the e-mail address of the sender</li> </ul> <p>Here's an example config using <a href=https://aws.amazon.com/ses/ >Amazon SES</a> for outgoing mail (this is how it is configured for <code>ntfy.sh</code>):</p> <div class="tabbed-set tabbed-alternate" data-tabs=6:1><input checked=checked id=__tabbed_6_1 name=__tabbed_6 type=radio><div class=tabbed-labels><label for=__tabbed_6_1>/etc/ntfy/server.yml</label></div> <div class=tabbed-content> <div class=tabbed-block> <div class=highlight><pre><span></span><code><span class=nt>base-url</span><span class=p>:</span><span class=w> </span><span class=s>&quot;https://ntfy.sh&quot;</span><span class=w></span>
<span class=nt>smtp-sender-addr</span><span class=p>:</span><span class=w> </span><span class=s>&quot;email-smtp.us-east-2.amazonaws.com:587&quot;</span><span class=w></span>
<span class=nt>smtp-sender-user</span><span class=p>:</span><span class=w> </span><span class=s>&quot;AKIDEADBEEFAFFE12345&quot;</span><span class=w></span>
<span class=nt>smtp-sender-pass</span><span class=p>:</span><span class=w> </span><span class=s>&quot;Abd13Kf+sfAk2DzifjafldkThisIsNotARealKeyOMG.&quot;</span><span class=w></span>
<span class=nt>smtp-sender-from</span><span class=p>:</span><span class=w> </span><span class=s>&quot;ntfy@ntfy.sh&quot;</span><span class=w></span>
</code></pre></div> </div> </div> </div> <p>Please also refer to the <a href=#rate-limiting>rate limiting</a> settings below, specifically <code>visitor-email-limit-burst</code> and <code>visitor-email-limit-burst</code>. Setting these conservatively is necessary to avoid abuse.</p> <h2 id=e-mail-publishing>E-mail publishing<a class=headerlink href=#e-mail-publishing title="Permanent link">&para;</a></h2> <p>To allow publishing messages via e-mail, ntfy can run a lightweight <strong>SMTP server for incoming messages</strong>. Once configured, users can <a href=../publish/#e-mail-publishing>send emails to a topic e-mail address</a> (e.g. <code>mytopic@ntfy.sh</code> or <code>myprefix-mytopic@ntfy.sh</code>) to publish messages to a topic. This is useful for e-mail based integrations such as for statuspage.io (though these days most services also support webhooks and HTTP calls).</p> <p>To configure the SMTP server, you must at least set <code>smtp-server-listen</code> and <code>smtp-server-domain</code>:</p> <ul> <li><code>smtp-server-listen</code> defines the IP address and port the SMTP server will listen on, e.g. <code>:25</code> or <code>1.2.3.4:25</code></li> <li><code>smtp-server-domain</code> is the e-mail domain, e.g. <code>ntfy.sh</code> (must be identical to MX record, see below)</li> <li><code>smtp-server-addr-prefix</code> is an optional prefix for the e-mail addresses to prevent spam. If set to <code>ntfy-</code>, for instance, only e-mails to <code>ntfy-$topic@ntfy.sh</code> will be accepted. If this is not set, all emails to <code>$topic@ntfy.sh</code> will be accepted (which may obviously be a spam problem).</li> </ul> <p>Here's an example config (this is how it is configured for <code>ntfy.sh</code>):</p> <div class="tabbed-set tabbed-alternate" data-tabs=7:1><input checked=checked id=__tabbed_7_1 name=__tabbed_7 type=radio><div class=tabbed-labels><label for=__tabbed_7_1>/etc/ntfy/server.yml</label></div> <div class=tabbed-content> <div class=tabbed-block> <div class=highlight><pre><span></span><code><span class=nt>smtp-server-listen</span><span class=p>:</span><span class=w> </span><span class=s>&quot;:25&quot;</span><span class=w></span>
<span class=nt>smtp-server-domain</span><span class=p>:</span><span class=w> </span><span class=s>&quot;ntfy.sh&quot;</span><span class=w></span>
<span class=nt>smtp-server-addr-prefix</span><span class=p>:</span><span class=w> </span><span class=s>&quot;ntfy-&quot;</span><span class=w></span>
</code></pre></div> </div> </div> </div> <p>In addition to configuring the ntfy server, you have to create two DNS records (an <a href=https://en.wikipedia.org/wiki/MX_record>MX record</a> and a corresponding A record), so incoming mail will find its way to your server. Here's an example of how <code>ntfy.sh</code> is configured (in <a href=https://aws.amazon.com/route53/ >Amazon Route 53</a>):</p> <figure> <p><img alt="DNS records for incoming mail" src=../static/img/screenshot-email-publishing-dns.png width=600> </p> <figcaption>DNS records for incoming mail</figcaption> </figure> <p>You can check if everything is working correctly by sending an email as raw SMTP via <code>nc</code>. Create a text file, e.g. <code>email.txt</code></p> <div class=highlight><pre><span></span><code>EHLO example.com
MAIL FROM: phil@example.com
RCPT TO: ntfy-mytopic@ntfy.sh
DATA
Subject: Email for you
Content-Type: text/plain; charset=&quot;UTF-8&quot;

Hello from ðŸ‡©ðŸ‡ª
.
</code></pre></div> <p>And then send the mail via <code>nc</code> like this. If you see any lines starting with <code>451</code>, those are errors from the ntfy server. Read them carefully.</p> <div class=highlight><pre><span></span><code>$ cat email.txt | nc -N ntfy.sh 25
220 ntfy.sh ESMTP Service Ready
250-Hello example.com
...
250 2.0.0 Roger, accepting mail from &lt;phil@example.com&gt;
250 2.0.0 I&#39;ll make sure &lt;ntfy-mytopic@ntfy.sh&gt; gets this
</code></pre></div> <p>As for the DNS setup, be sure to verify that <code>dig MX</code> and <code>dig A</code> are returning results similar to this:</p> <div class=highlight><pre><span></span><code>$ dig MX ntfy.sh +short 
10 mx1.ntfy.sh.
$ dig A mx1.ntfy.sh +short 
3.139.215.220
</code></pre></div> <h2 id=behind-a-proxy-tls-etc>Behind a proxy (TLS, etc.)<a class=headerlink href=#behind-a-proxy-tls-etc title="Permanent link">&para;</a></h2> <div class="admonition warning"> <p class=admonition-title>Warning</p> <p>If you are running ntfy behind a proxy, you must set the <code>behind-proxy</code> flag. Otherwise, all visitors are <a href=#rate-limiting>rate limited</a> as if they are one.</p> </div> <p>It may be desirable to run ntfy behind a proxy (e.g. nginx, HAproxy or Apache), so you can provide TLS certificates using Let's Encrypt using certbot, or simply because you'd like to share the ports (80/443) with other services. Whatever your reasons may be, there are a few things to consider. </p> <p>If you are running ntfy behind a proxy, you should set the <code>behind-proxy</code> flag. This will instruct the <a href=#rate-limiting>rate limiting</a> logic to use the <code>X-Forwarded-For</code> header as the primary identifier for a visitor, as opposed to the remote IP address. If the <code>behind-proxy</code> flag is not set, all visitors will be counted as one, because from the perspective of the ntfy server, they all share the proxy's IP address.</p> <div class="tabbed-set tabbed-alternate" data-tabs=8:1><input checked=checked id=__tabbed_8_1 name=__tabbed_8 type=radio><div class=tabbed-labels><label for=__tabbed_8_1>/etc/ntfy/server.yml</label></div> <div class=tabbed-content> <div class=tabbed-block> <div class=highlight><pre><span></span><code><span class=c1># Tell ntfy to use &quot;X-Forwarded-For&quot; to identify visitors</span><span class=w></span>
<span class=nt>behind-proxy</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">true</span><span class=w></span>
</code></pre></div> </div> </div> </div> <h3 id=tlsssl>TLS/SSL<a class=headerlink href=#tlsssl title="Permanent link">&para;</a></h3> <p>ntfy supports HTTPS/TLS by setting the <code>listen-https</code> <a href=#config-options>config option</a>. However, if you are behind a proxy, it is recommended that TLS/SSL termination is done by the proxy itself (see below).</p> <p>I highly recommend using <a href=https://certbot.eff.org/ >certbot</a>. I use it with the <a href=https://certbot-dns-route53.readthedocs.io/en/stable/ >dns-route53 plugin</a>, which lets you use <a href=https://aws.amazon.com/route53/ >AWS Route 53</a> as the challenge. That's much easier than using the HTTP challenge. I've found <a href=https://nandovieira.com/using-lets-encrypt-in-development-with-nginx-and-aws-route53>this guide</a> to be incredibly helpful.</p> <h3 id=nginxapache2caddy>nginx/Apache2/caddy<a class=headerlink href=#nginxapache2caddy title="Permanent link">&para;</a></h3> <p>For your convenience, here's a working config that'll help configure things behind a proxy. Be sure to <strong>enable WebSockets</strong> by forwarding the <code>Connection</code> and <code>Upgrade</code> headers accordingly. </p> <p>In this example, ntfy runs on <code>:2586</code> and we proxy traffic to it. We also redirect HTTP to HTTPS for GET requests against a topic or the root domain:</p> <div class="tabbed-set tabbed-alternate" data-tabs=9:4><input checked=checked id=__tabbed_9_1 name=__tabbed_9 type=radio><input id=__tabbed_9_2 name=__tabbed_9 type=radio><input id=__tabbed_9_3 name=__tabbed_9 type=radio><input id=__tabbed_9_4 name=__tabbed_9 type=radio><div class=tabbed-labels><label for=__tabbed_9_1>nginx (convenient)</label><label for=__tabbed_9_2>nginx (more secure)</label><label for=__tabbed_9_3>Apache2</label><label for=__tabbed_9_4>caddy</label></div> <div class=tabbed-content> <div class=tabbed-block> <div class=highlight><pre><span></span><code># /etc/nginx/sites-*/ntfy
#
# This config allows insecure HTTP POST/PUT requests against topics to allow a short curl syntax (without -L
# and &quot;https://&quot; prefix). It also disables output buffering, which has worked well for the ntfy.sh server.
#
# This is how ntfy.sh is configured.

server {
  listen 80;
  server_name ntfy.sh;

  location / {
    # Redirect HTTP to HTTPS, but only for GET topic addresses, since we want 
    # it to work with curl without the annoying https:// prefix
    set $redirect_https &quot;&quot;;
    if ($request_method = GET) {
      set $redirect_https &quot;yes&quot;;
    }
    if ($request_uri ~* &quot;^/([-_a-z0-9]{0,64}$|docs/|static/)&quot;) {
      set $redirect_https &quot;${redirect_https}yes&quot;;
    }
    if ($redirect_https = &quot;yesyes&quot;) {
      return 302 https://$http_host$request_uri$is_args$query_string;
    }

    proxy_pass http://127.0.0.1:2586;
    proxy_http_version 1.1;

    proxy_buffering off;
    proxy_request_buffering off;
    proxy_redirect off;

    proxy_set_header Host $http_host;
    proxy_set_header Upgrade $http_upgrade;
    proxy_set_header Connection &quot;upgrade&quot;;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;

    proxy_connect_timeout 3m;
    proxy_send_timeout 3m;
    proxy_read_timeout 3m;

    client_max_body_size 20m; # Must be &gt;= attachment-file-size-limit in /etc/ntfy/server.yml
  }
}

server {
  listen 443 ssl;
  server_name ntfy.sh;

  ssl_session_cache builtin:1000 shared:SSL:10m;
  ssl_protocols TLSv1.2 TLSv1.3;
  ssl_ciphers HIGH:!aNULL:!eNULL:!EXPORT:!CAMELLIA:!DES:!MD5:!PSK:!RC4;
  ssl_prefer_server_ciphers on;

  ssl_certificate /etc/letsencrypt/live/ntfy.sh/fullchain.pem;
  ssl_certificate_key /etc/letsencrypt/live/ntfy.sh/privkey.pem;

  location / {
    proxy_pass http://127.0.0.1:2586;
    proxy_http_version 1.1;

    proxy_buffering off;
    proxy_request_buffering off;
    proxy_redirect off;

    proxy_set_header Host $http_host;
    proxy_set_header Upgrade $http_upgrade;
    proxy_set_header Connection &quot;upgrade&quot;;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;

    proxy_connect_timeout 3m;
    proxy_send_timeout 3m;
    proxy_read_timeout 3m;

    client_max_body_size 20m; # Must be &gt;= attachment-file-size-limit in /etc/ntfy/server.yml
  }
}
</code></pre></div> </div> <div class=tabbed-block> <div class=highlight><pre><span></span><code># /etc/nginx/sites-*/ntfy
#
# This config requires the use of the -L flag in curl to redirect to HTTPS, and it keeps nginx output buffering
# enabled. While recommended, I have had issues with that in the past.

server {
  listen 80;
  server_name ntfy.sh;

  location / {
    return 302 https://$http_host$request_uri$is_args$query_string;

    proxy_pass http://127.0.0.1:2586;
    proxy_http_version 1.1;

    proxy_set_header Host $http_host;
    proxy_set_header Upgrade $http_upgrade;
    proxy_set_header Connection &quot;upgrade&quot;;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;

    proxy_connect_timeout 3m;
    proxy_send_timeout 3m;
    proxy_read_timeout 3m;

    client_max_body_size 20m; # Must be &gt;= attachment-file-size-limit in /etc/ntfy/server.yml
  }
}

server {
  listen 443 ssl;
  server_name ntfy.sh;

  ssl_session_cache builtin:1000 shared:SSL:10m;
  ssl_protocols TLSv1.2 TLSv1.3;
  ssl_ciphers HIGH:!aNULL:!eNULL:!EXPORT:!CAMELLIA:!DES:!MD5:!PSK:!RC4;
  ssl_prefer_server_ciphers on;

  ssl_certificate /etc/letsencrypt/live/ntfy.sh/fullchain.pem;
  ssl_certificate_key /etc/letsencrypt/live/ntfy.sh/privkey.pem;

  location / {
    proxy_pass http://127.0.0.1:2586;
    proxy_http_version 1.1;

    proxy_set_header Host $http_host;
    proxy_set_header Upgrade $http_upgrade;
    proxy_set_header Connection &quot;upgrade&quot;;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;

    proxy_connect_timeout 3m;
    proxy_send_timeout 3m;
    proxy_read_timeout 3m;

    client_max_body_size 20m; # Must be &gt;= attachment-file-size-limit in /etc/ntfy/server.yml
  }
}
</code></pre></div> </div> <div class=tabbed-block> <div class=highlight><pre><span></span><code># /etc/apache2/sites-*/ntfy.conf

&lt;VirtualHost *:80&gt;
    ServerName ntfy.sh

    # Proxy connections to ntfy (requires &quot;a2enmod proxy&quot;)
    ProxyPass / http://127.0.0.1:2586/
    ProxyPassReverse / http://127.0.0.1:2586/

    SetEnv proxy-nokeepalive 1
    SetEnv proxy-sendchunked 1

    # Higher than the max message size of 4096 bytes
    LimitRequestBody 102400

    # Enable mod_rewrite (requires &quot;a2enmod rewrite&quot;)
    RewriteEngine on

    # WebSockets support (requires &quot;a2enmod rewrite proxy_wstunnel&quot;)
    RewriteCond %{HTTP:Upgrade} websocket [NC]
    RewriteCond %{HTTP:Connection} upgrade [NC]
    RewriteRule ^/?(.*) &quot;ws://127.0.0.1:2586/$1&quot; [P,L]

    # Redirect HTTP to HTTPS, but only for GET topic addresses, since we want 
    # it to work with curl without the annoying https:// prefix 
    RewriteCond %{REQUEST_METHOD} GET
    RewriteRule ^/([-_A-Za-z0-9]{0,64})$ https://%{SERVER_NAME}/$1 [R,L]
&lt;/VirtualHost&gt;

&lt;VirtualHost *:443&gt;
    ServerName ntfy.sh

    SSLEngine on
    SSLCertificateFile /etc/letsencrypt/live/ntfy.sh/fullchain.pem
    SSLCertificateKeyFile /etc/letsencrypt/live/ntfy.sh/privkey.pem
    Include /etc/letsencrypt/options-ssl-apache.conf

    # Proxy connections to ntfy (requires &quot;a2enmod proxy&quot;)
    ProxyPass / http://127.0.0.1:2586/
    ProxyPassReverse / http://127.0.0.1:2586/

    SetEnv proxy-nokeepalive 1
    SetEnv proxy-sendchunked 1

    # Higher than the max message size of 4096 bytes 
    LimitRequestBody 102400

    # Enable mod_rewrite (requires &quot;a2enmod rewrite&quot;)
    RewriteEngine on

    # WebSockets support (requires &quot;a2enmod rewrite proxy_wstunnel&quot;)
    RewriteCond %{HTTP:Upgrade} websocket [NC]
    RewriteCond %{HTTP:Connection} upgrade [NC]
    RewriteRule ^/?(.*) &quot;ws://127.0.0.1:2586/$1&quot; [P,L] 
&lt;/VirtualHost&gt;
</code></pre></div> </div> <div class=tabbed-block> <div class=highlight><pre><span></span><code># Note that this config is most certainly incomplete. Please help out and let me know what&#39;s missing
# via Discord/Matrix or in a GitHub issue.

ntfy.sh, http://nfty.sh {
    reverse_proxy 127.0.0.1:2586

    # Redirect HTTP to HTTPS, but only for GET topic addresses, since we want
    # it to work with curl without the annoying https:// prefix
    @httpget {
        protocol http
        method GET
        path_regexp ^/([-_a-z0-9]{0,64}$|docs/|static/)
    }
    redir @httpget https://{host}{uri}
}
</code></pre></div> </div> </div> </div> <h2 id=firebase-fcm>Firebase (FCM)<a class=headerlink href=#firebase-fcm title="Permanent link">&para;</a></h2> <div class="admonition info"> <p class=admonition-title>Info</p> <p>Using Firebase is <strong>optional</strong> and only works if you modify and <a href=../develop/#android-app>build your own Android .apk</a>. For a self-hosted instance, it's easier to just not bother with FCM.</p> </div> <p><a href=https://firebase.google.com/docs/cloud-messaging>Firebase Cloud Messaging (FCM)</a> is the Google approved way to send push messages to Android devices. FCM is the only method that an Android app can receive messages without having to run a <a href=https://developer.android.com/guide/components/foreground-services>foreground service</a>.</p> <p>For the main host <a href=https://ntfy.sh>ntfy.sh</a>, the <a href=../subscribe/phone/ >ntfy Android app</a> uses Firebase to send messages to the device. For other hosts, instant delivery is used and FCM is not involved.</p> <p>To configure FCM for your self-hosted instance of the ntfy server, follow these steps:</p> <ol> <li>Sign up for a <a href=https://console.firebase.google.com/ >Firebase account</a></li> <li>Create a Firebase app and download the key file (e.g. <code>myapp-firebase-adminsdk-...json</code>)</li> <li>Place the key file in <code>/etc/ntfy</code>, set the <code>firebase-key-file</code> in <code>server.yml</code> accordingly and restart the ntfy server</li> <li>Build your own Android .apk following <a href=../develop/#android-app>these instructions</a></li> </ol> <p>Example: <div class=highlight><pre><span></span><code># If set, also publish messages to a Firebase Cloud Messaging (FCM) topic for your app.
# This is optional and only required to support Android apps (which don&#39;t allow background services anymore).
#
firebase-key-file: &quot;/etc/ntfy/ntfy-sh-firebase-adminsdk-ahnce-9f4d6f14b5.json&quot;
</code></pre></div></p> <h2 id=ios-instant-notifications>iOS instant notifications<a class=headerlink href=#ios-instant-notifications title="Permanent link">&para;</a></h2> <p>Unlike Android, iOS heavily restricts background processing, which sadly makes it impossible to implement instant push notifications without a central server. </p> <p>To still support instant notifications on iOS through your self-hosted ntfy server, you have to forward so called <code>poll_request</code> messages to the main ntfy.sh server (or any upstream server that's APNS/Firebase connected, if you build your own iOS app), which will then forward it to Firebase/APNS.</p> <p>To configure it, simply set <code>upstream-base-url</code> like so:</p> <div class=highlight><pre><span></span><code><span class=nt>upstream-base-url</span><span class=p>:</span><span class=w> </span><span class=s>&quot;https://ntfy.sh&quot;</span><span class=w></span>
</code></pre></div> <p>If set, all incoming messages will publish a poll request to the configured upstream server, containing the message ID of the original message, instructing the iOS app to poll this server for the actual message contents.</p> <p>If <code>upstream-base-url</code> is not set, notifications will still eventually get to your device, but delivery can take hours, depending on the state of the phone. If you are using your phone, it shouldn't take more than 20-30 minutes though.</p> <p>In case you're curious, here's an example of the entire flow: </p> <ul> <li>In the iOS app, you subscribe to <code>https://ntfy.example.com/mytopic</code></li> <li>The app subscribes to the Firebase topic <code>6de73be8dfb7d69e...</code> (the SHA256 of the topic URL)</li> <li>When you publish a message to <code>https://ntfy.example.com/mytopic</code>, your ntfy server will publish a poll request to <code>https://ntfy.sh/6de73be8dfb7d69e...</code>. The request from your server to the upstream server contains only the message ID (in the <code>X-Poll-ID</code> header), and the SHA256 checksum of the topic URL (as upstream topic).</li> <li>The ntfy.sh server publishes the poll request message to Firebase, which forwards it to APNS, which forwards it to your iOS device</li> <li>Your iOS device receives the poll request, and fetches the actual message from your server, and then displays it</li> </ul> <p>Here's an example of what the self-hosted server forwards to the upstream server. The request is equivalent to this curl:</p> <div class=highlight><pre><span></span><code>curl -X POST -H &quot;X-Poll-ID: s4PdJozxM8na&quot; https://ntfy.sh/6de73be8dfb7d69e32fb2c00c23fe7adbd8b5504406e3068c273aa24cef4055b
{&quot;id&quot;:&quot;4HsClFEuCIcs&quot;,&quot;time&quot;:1654087955,&quot;event&quot;:&quot;poll_request&quot;,&quot;topic&quot;:&quot;6de73be8dfb7d69e32fb2c00c23fe7adbd8b5504406e3068c273aa24cef4055b&quot;,&quot;message&quot;:&quot;New message&quot;,&quot;poll_id&quot;:&quot;s4PdJozxM8na&quot;}
</code></pre></div> <p>Note that the self-hosted server literally sends the message <code>New message</code> for every message, even if your message may be <code>Some other message</code>. This is so that if iOS cannot talk to the self-hosted server (in time, or at all), it'll show <code>New message</code> as a popup.</p> <h2 id=rate-limiting>Rate limiting<a class=headerlink href=#rate-limiting title="Permanent link">&para;</a></h2> <div class="admonition info"> <p class=admonition-title>Info</p> <p>Be aware that if you are running ntfy behind a proxy, you must set the <code>behind-proxy</code> flag. Otherwise, all visitors are rate limited as if they are one.</p> </div> <p>By default, ntfy runs without authentication, so it is vitally important that we protect the server from abuse or overload. There are various limits and rate limits in place that you can use to configure the server:</p> <ul> <li><strong>Global limit</strong>: A global limit applies across all visitors (IPs, clients, users)</li> <li><strong>Visitor limit</strong>: A visitor limit only applies to a certain visitor. A <strong>visitor</strong> is identified by its IP address (or the <code>X-Forwarded-For</code> header if <code>behind-proxy</code> is set). All config options that start with the word <code>visitor</code> apply only on a per-visitor basis.</li> </ul> <p>During normal usage, you shouldn't encounter these limits at all, and even if you burst a few requests or emails (e.g. when you reconnect after a connection drop), it shouldn't have any effect.</p> <h3 id=general-limits>General limits<a class=headerlink href=#general-limits title="Permanent link">&para;</a></h3> <p>Let's do the easy limits first:</p> <ul> <li><code>global-topic-limit</code> defines the total number of topics before the server rejects new topics. It defaults to 15,000.</li> <li><code>visitor-subscription-limit</code> is the number of subscriptions (open connections) per visitor. This value defaults to 30.</li> </ul> <h3 id=request-limits>Request limits<a class=headerlink href=#request-limits title="Permanent link">&para;</a></h3> <p>In addition to the limits above, there is a requests/second limit per visitor for all sensitive GET/PUT/POST requests. This limit uses a <a href=https://en.wikipedia.org/wiki/Token_bucket>token bucket</a> (using Go's <a href=https://pkg.go.dev/golang.org/x/time/rate>rate package</a>):</p> <p>Each visitor has a bucket of 60 requests they can fire against the server (defined by <code>visitor-request-limit-burst</code>). After the 60, new requests will encounter a <code>429 Too Many Requests</code> response. The visitor request bucket is refilled at a rate of one request every 5s (defined by <code>visitor-request-limit-replenish</code>)</p> <ul> <li><code>visitor-request-limit-burst</code> is the initial bucket of requests each visitor has. This defaults to 60.</li> <li><code>visitor-request-limit-replenish</code> is the rate at which the bucket is refilled (one request per x). Defaults to 5s.</li> <li><code>visitor-request-limit-exempt-hosts</code> is a comma-separated list of hostnames and IPs to be exempt from request rate limiting; hostnames are resolved at the time the server is started. Defaults to an empty list.</li> </ul> <h3 id=attachment-limits>Attachment limits<a class=headerlink href=#attachment-limits title="Permanent link">&para;</a></h3> <p>Aside from the global file size and total attachment cache limits (see <a href=#attachments>above</a>), there are two relevant per-visitor limits:</p> <ul> <li><code>visitor-attachment-total-size-limit</code> is the total storage limit used for attachments per visitor. It defaults to 100M. The per-visitor storage is automatically decreased as attachments expire. External attachments (attached via <code>X-Attach</code>, see <a href=../publish/#attachments>publishing docs</a>) do not count here. </li> <li><code>visitor-attachment-daily-bandwidth-limit</code> is the total daily attachment download/upload bandwidth limit per visitor, including PUT and GET requests. This is to protect your precious bandwidth from abuse, since egress costs money in most cloud providers. This defaults to 500M.</li> </ul> <h3 id=e-mail-limits>E-mail limits<a class=headerlink href=#e-mail-limits title="Permanent link">&para;</a></h3> <p>Similarly to the request limit, there is also an e-mail limit (only relevant if <a href=#e-mail-notifications>e-mail notifications</a> are enabled):</p> <ul> <li><code>visitor-email-limit-burst</code> is the initial bucket of emails each visitor has. This defaults to 16.</li> <li><code>visitor-email-limit-replenish</code> is the rate at which the bucket is refilled (one email per x). Defaults to 1h.</li> </ul> <h3 id=firebase-limits>Firebase limits<a class=headerlink href=#firebase-limits title="Permanent link">&para;</a></h3> <p>If <a href=#firebase-fcm>Firebase is configured</a>, all messages are also published to a Firebase topic (unless <code>Firebase: no</code> is set). Firebase enforces <a href=https://firebase.google.com/docs/cloud-messaging/concept-options#topics_throttling>its own limits</a> on how many messages can be published. Unfortunately these limits are a little vague and can change depending on the time of day. In practice, I have only ever observed <code>429 Quota exceeded</code> responses from Firebase if <strong>too many messages are published to the same topic</strong>. </p> <p>In ntfy, if Firebase responds with a 429 after publishing to a topic, the visitor (= IP address) who published the message is <strong>banned from publishing to Firebase for 10 minutes</strong> (not configurable). Because publishing to Firebase happens asynchronously, there is no indication of the user that this has happened. Non-Firebase subscribers (WebSocket or HTTP stream) are not affected. After the 10 minutes are up, messages forwarding to Firebase is resumed for this visitor.</p> <p>If this ever happens, there will be a log message that looks something like this: <div class=highlight><pre><span></span><code>WARN Firebase quota exceeded (likely for topic), temporarily denying Firebase access to visitor
</code></pre></div></p> <h2 id=tuning-for-scale>Tuning for scale<a class=headerlink href=#tuning-for-scale title="Permanent link">&para;</a></h2> <p>If you're running ntfy for your home server, you probably don't need to worry about scale at all. In its default config, if it's not behind a proxy, the ntfy server can keep about <strong>as many connections as the open file limit allows</strong>. This limit is typically called <code>nofile</code>. Other than that, RAM and CPU are obviously relevant. You may also want to check out <a href=https://www.reddit.com/r/golang/comments/r9u4ee/how_many_actively_connected_http_clients_can_a_go/ >this discussion on Reddit</a>.</p> <p>Depending on <em>how you run it</em>, here are a few limits that are relevant:</p> <h3 id=message-cache_1>Message cache<a class=headerlink href=#message-cache_1 title="Permanent link">&para;</a></h3> <p>By default, the <a href=#message-cache>message cache</a> (defined by <code>cache-file</code>) uses the SQLite default settings, which means it syncs to disk on every write. For personal servers, this is perfectly adequate. For larger installations, such as ntfy.sh, the <a href=https://sqlite.org/wal.html>write-ahead log (WAL)</a> should be enabled, and the sync mode should be adjusted. See <a href=https://phiresky.github.io/blog/2020/sqlite-performance-tuning/ >this article</a> for details.</p> <p>In addition to that, for very high load servers (such as ntfy.sh), it may be beneficial to write messages to the cache in batches, and asynchronously. This can be enabled with the <code>cache-batch-size</code> and <code>cache-batch-timeout</code>. If you start seeing <code>database locked</code> messages in the logs, you should probably enable that.</p> <p>Here's how ntfy.sh has been tuned in the <code>server.yml</code> file:</p> <div class=highlight><pre><span></span><code><span class=nt>cache-batch-size</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">25</span><span class=w></span>
<span class=nt>cache-batch-timeout</span><span class=p>:</span><span class=w> </span><span class=s>&quot;1s&quot;</span><span class=w></span>
<span class=nt>cache-startup-queries</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">|</span><span class=w></span>
<span class=w>    </span><span class=no>pragma journal_mode = WAL;</span><span class=w></span>
<span class=w>    </span><span class=no>pragma synchronous = normal;</span><span class=w></span>
<span class=w>    </span><span class=no>pragma temp_store = memory;</span><span class=w></span>
<span class=w>    </span><span class=no>pragma busy_timeout = 15000;</span><span class=w></span>
<span class=w>    </span><span class=no>vacuum;</span><span class=w></span>
</code></pre></div> <h3 id=for-systemd-services>For systemd services<a class=headerlink href=#for-systemd-services title="Permanent link">&para;</a></h3> <p>If you're running ntfy in a systemd service (e.g. for .deb/.rpm packages), the main limiting factor is the <code>LimitNOFILE</code> setting in the systemd unit. The default open files limit for <code>ntfy.service</code> is 10,000. You can override it by creating a <code>/etc/systemd/system/ntfy.service.d/override.conf</code> file. As far as I can tell, <code>/etc/security/limits.conf</code> is not relevant.</p> <div class="tabbed-set tabbed-alternate" data-tabs=10:1><input checked=checked id=__tabbed_10_1 name=__tabbed_10 type=radio><div class=tabbed-labels><label for=__tabbed_10_1>/etc/systemd/system/ntfy.service.d/override.conf</label></div> <div class=tabbed-content> <div class=tabbed-block> <div class=highlight><pre><span></span><code># Allow 20,000 ntfy connections (and give room for other file handles)
[Service]
LimitNOFILE=20500
</code></pre></div> </div> </div> </div> <h3 id=outside-of-systemd>Outside of systemd<a class=headerlink href=#outside-of-systemd title="Permanent link">&para;</a></h3> <p>If you're running outside systemd, you may want to adjust your <code>/etc/security/limits.conf</code> file to increase the <code>nofile</code> setting. Here's an example that increases the limit to 5,000. You can find out the current setting by running <code>ulimit -n</code>, or manually override it temporarily by running <code>ulimit -n 50000</code>.</p> <div class="tabbed-set tabbed-alternate" data-tabs=11:1><input checked=checked id=__tabbed_11_1 name=__tabbed_11 type=radio><div class=tabbed-labels><label for=__tabbed_11_1>/etc/security/limits.conf</label></div> <div class=tabbed-content> <div class=tabbed-block> <div class=highlight><pre><span></span><code># Increase open files limit globally
* hard nofile 20500
</code></pre></div> </div> </div> </div> <h3 id=proxy-limits-nginx-apache2>Proxy limits (nginx, Apache2)<a class=headerlink href=#proxy-limits-nginx-apache2 title="Permanent link">&para;</a></h3> <p>If you are running <a href=#behind-a-proxy-tls-etc>behind a proxy</a> (e.g. nginx, Apache), the open files limit of the proxy is also relevant. So if your proxy runs inside of systemd, increase the limits in systemd for the proxy. Typically, the proxy open files limit has to be <strong>double the number of how many connections you'd like to support</strong>, because the proxy has to maintain the client connection and the connection to ntfy.</p> <div class="tabbed-set tabbed-alternate" data-tabs=12:2><input checked=checked id=__tabbed_12_1 name=__tabbed_12 type=radio><input id=__tabbed_12_2 name=__tabbed_12 type=radio><div class=tabbed-labels><label for=__tabbed_12_1>/etc/nginx/nginx.conf</label><label for=__tabbed_12_2>/etc/systemd/system/nginx.service.d/override.conf</label></div> <div class=tabbed-content> <div class=tabbed-block> <div class=highlight><pre><span></span><code>events {
  # Allow 40,000 proxy connections (2x of the desired ntfy connection count;
  # and give room for other file handles)
  worker_connections 40500;
}
</code></pre></div> </div> <div class=tabbed-block> <div class=highlight><pre><span></span><code># Allow 40,000 proxy connections (2x of the desired ntfy connection count;
# and give room for other file handles)
[Service]
LimitNOFILE=40500
</code></pre></div> </div> </div> </div> <h3 id=banning-bad-actors-fail2ban>Banning bad actors (fail2ban)<a class=headerlink href=#banning-bad-actors-fail2ban title="Permanent link">&para;</a></h3> <p>If you put stuff on the Internet, bad actors will try to break them or break in. <a href=https://www.fail2ban.org/ >fail2ban</a> and nginx's <a href=http://nginx.org/en/docs/http/ngx_http_limit_req_module.html>ngx_http_limit_req_module module</a> can be used to ban client IPs if they misbehave. This is on top of the <a href=#rate-limiting>rate limiting</a> inside the ntfy server.</p> <p>Here's an example for how ntfy.sh is configured, following the instructions from two tutorials (<a href=https://easyengine.io/tutorials/nginx/fail2ban/ >here</a> and <a href=https://easyengine.io/tutorials/nginx/block-wp-login-php-bruteforce-attack/ >here</a>):</p> <div class="tabbed-set tabbed-alternate" data-tabs=13:4><input checked=checked id=__tabbed_13_1 name=__tabbed_13 type=radio><input id=__tabbed_13_2 name=__tabbed_13 type=radio><input id=__tabbed_13_3 name=__tabbed_13 type=radio><input id=__tabbed_13_4 name=__tabbed_13 type=radio><div class=tabbed-labels><label for=__tabbed_13_1>/etc/nginx/nginx.conf</label><label for=__tabbed_13_2>/etc/nginx/sites-enabled/ntfy.sh</label><label for=__tabbed_13_3>/etc/fail2ban/filter.d/nginx-req-limit.conf</label><label for=__tabbed_13_4>/etc/fail2ban/jail.local</label></div> <div class=tabbed-content> <div class=tabbed-block> <div class=highlight><pre><span></span><code># Rate limit all IP addresses
http {
  limit_req_zone $binary_remote_addr zone=one:10m rate=1r/s;
}

# Alternatively, whitelist certain IP addresses
http {
  geo $limited {
    default 1;
    116.203.112.46/32 0;
    132.226.42.65/32 0;
    ...
  }
  map $limited $limitkey {
    1 $binary_remote_addr;
    0 &quot;&quot;;
  }
  limit_req_zone $limitkey zone=one:10m rate=1r/s;
}
</code></pre></div> </div> <div class=tabbed-block> <div class=highlight><pre><span></span><code># For each server/location block
server {
  location / {
    limit_req zone=one burst=1000 nodelay;
  }
}    
</code></pre></div> </div> <div class=tabbed-block> <div class=highlight><pre><span></span><code>[Definition]
failregex = limiting requests, excess:.* by zone.*client: &lt;HOST&gt;
ignoreregex =
</code></pre></div> </div> <div class=tabbed-block> <div class=highlight><pre><span></span><code>[nginx-req-limit]
enabled = true
filter = nginx-req-limit
action = iptables-multiport[name=ReqLimit, port=&quot;http,https&quot;, protocol=tcp]
logpath = /var/log/nginx/error.log
findtime = 600
bantime = 7200
maxretry = 10
</code></pre></div> </div> </div> </div> <h2 id=debuggingtracing>Debugging/tracing<a class=headerlink href=#debuggingtracing title="Permanent link">&para;</a></h2> <p>If something's not working right, you can debug/trace through what the ntfy server is doing by setting the <code>log-level</code> to <code>DEBUG</code> or <code>TRACE</code>. The <code>DEBUG</code> setting will output information about each published message, but not the message contents. The <code>TRACE</code> setting will also print the message contents. </p> <div class="admonition warning"> <p class=admonition-title>Warning</p> <p>Both options are very verbose and should only be enabled in production for short periods of time. Otherwise, you're going to run out of disk space pretty quickly.</p> </div> <p>You can also hot-reload the <code>log-level</code> by sending the <code>SIGHUP</code> signal to the process after editing the <code>server.yml</code> file. You can do so by calling <code>systemctl reload ntfy</code> (if ntfy is running inside systemd), or by calling <code>kill -HUP $(pidof ntfy)</code>. If successful, you'll see something like this:</p> <div class=highlight><pre><span></span><code>$ ntfy serve
2022/06/02 10:29:28 INFO Listening on :2586[http] :1025[smtp], log level is INFO
2022/06/02 10:29:34 INFO Partially hot reloading configuration ...
2022/06/02 10:29:34 INFO Log level is TRACE
</code></pre></div> <h2 id=config-options>Config options<a class=headerlink href=#config-options title="Permanent link">&para;</a></h2> <p>Each config option can be set in the config file <code>/etc/ntfy/server.yml</code> (e.g. <code>listen-http: :80</code>) or as a CLI option (e.g. <code>--listen-http :80</code>. Here's a list of all available options. Alternatively, you can set an environment variable before running the <code>ntfy</code> command (e.g. <code>export NTFY_LISTEN_HTTP=:80</code>).</p> <div class="admonition info"> <p class=admonition-title>Info</p> <p>All config options can also be defined in the <code>server.yml</code> file using underscores instead of dashes, e.g. <code>cache_duration</code> and <code>cache-duration</code> are both supported. This is to support stricter YAML parsers that do not support dashes.</p> </div> <table> <thead> <tr> <th>Config option</th> <th>Env variable</th> <th>Format</th> <th>Default</th> <th>Description</th> </tr> </thead> <tbody> <tr> <td><code>base-url</code></td> <td><code>NTFY_BASE_URL</code></td> <td><em>URL</em></td> <td>-</td> <td>Public facing base URL of the service (e.g. <code>https://ntfy.sh</code>)</td> </tr> <tr> <td><code>listen-http</code></td> <td><code>NTFY_LISTEN_HTTP</code></td> <td><code>[host]:port</code></td> <td><code>:80</code></td> <td>Listen address for the HTTP web server</td> </tr> <tr> <td><code>listen-https</code></td> <td><code>NTFY_LISTEN_HTTPS</code></td> <td><code>[host]:port</code></td> <td>-</td> <td>Listen address for the HTTPS web server. If set, you also need to set <code>key-file</code> and <code>cert-file</code>.</td> </tr> <tr> <td><code>listen-unix</code></td> <td><code>NTFY_LISTEN_UNIX</code></td> <td><em>filename</em></td> <td>-</td> <td>Path to a Unix socket to listen on</td> </tr> <tr> <td><code>listen-unix-mode</code></td> <td><code>NTFY_LISTEN_UNIX_MODE</code></td> <td><em>file mode</em></td> <td><em>system default</em></td> <td>File mode of the Unix socket, e.g. 0700 or 0777</td> </tr> <tr> <td><code>key-file</code></td> <td><code>NTFY_KEY_FILE</code></td> <td><em>filename</em></td> <td>-</td> <td>HTTPS/TLS private key file, only used if <code>listen-https</code> is set.</td> </tr> <tr> <td><code>cert-file</code></td> <td><code>NTFY_CERT_FILE</code></td> <td><em>filename</em></td> <td>-</td> <td>HTTPS/TLS certificate file, only used if <code>listen-https</code> is set.</td> </tr> <tr> <td><code>firebase-key-file</code></td> <td><code>NTFY_FIREBASE_KEY_FILE</code></td> <td><em>filename</em></td> <td>-</td> <td>If set, also publish messages to a Firebase Cloud Messaging (FCM) topic for your app. This is optional and only required to save battery when using the Android app. See <a href=#firebase-fcm>Firebase (FCM</a>.</td> </tr> <tr> <td><code>cache-file</code></td> <td><code>NTFY_CACHE_FILE</code></td> <td><em>filename</em></td> <td>-</td> <td>If set, messages are cached in a local SQLite database instead of only in-memory. This allows for service restarts without losing messages in support of the since= parameter. See <a href=#message-cache>message cache</a>.</td> </tr> <tr> <td><code>cache-duration</code></td> <td><code>NTFY_CACHE_DURATION</code></td> <td><em>duration</em></td> <td>12h</td> <td>Duration for which messages will be buffered before they are deleted. This is required to support the <code>since=...</code> and <code>poll=1</code> parameter. Set this to <code>0</code> to disable the cache entirely.</td> </tr> <tr> <td><code>cache-startup-queries</code></td> <td><code>NTFY_CACHE_STARTUP_QUERIES</code></td> <td><em>string (SQL queries)</em></td> <td>-</td> <td>SQL queries to run during database startup; this is useful for tuning and <a href=#wal-for-message-cache>enabling WAL mode</a></td> </tr> <tr> <td><code>cache-batch-size</code></td> <td><code>NTFY_CACHE_BATCH_SIZE</code></td> <td><em>int</em></td> <td>0</td> <td>Max size of messages to batch together when writing to message cache (if zero, writes are synchronous)</td> </tr> <tr> <td><code>cache-batch-timeout</code></td> <td><code>NTFY_CACHE_BATCH_TIMEOUT</code></td> <td><em>duration</em></td> <td>0s</td> <td>Timeout for batched async writes to the message cache (if zero, writes are synchronous)</td> </tr> <tr> <td><code>auth-file</code></td> <td><code>NTFY_AUTH_FILE</code></td> <td><em>filename</em></td> <td>-</td> <td>Auth database file used for access control. If set, enables authentication and access control. See <a href=#access-control>access control</a>.</td> </tr> <tr> <td><code>auth-default-access</code></td> <td><code>NTFY_AUTH_DEFAULT_ACCESS</code></td> <td><code>read-write</code>, <code>read-only</code>, <code>write-only</code>, <code>deny-all</code></td> <td><code>read-write</code></td> <td>Default permissions if no matching entries in the auth database are found. Default is <code>read-write</code>.</td> </tr> <tr> <td><code>behind-proxy</code></td> <td><code>NTFY_BEHIND_PROXY</code></td> <td><em>bool</em></td> <td>false</td> <td>If set, the X-Forwarded-For header is used to determine the visitor IP address instead of the remote address of the connection.</td> </tr> <tr> <td><code>attachment-cache-dir</code></td> <td><code>NTFY_ATTACHMENT_CACHE_DIR</code></td> <td><em>directory</em></td> <td>-</td> <td>Cache directory for attached files. To enable attachments, this has to be set.</td> </tr> <tr> <td><code>attachment-total-size-limit</code></td> <td><code>NTFY_ATTACHMENT_TOTAL_SIZE_LIMIT</code></td> <td><em>size</em></td> <td>5G</td> <td>Limit of the on-disk attachment cache directory. If the limits is exceeded, new attachments will be rejected.</td> </tr> <tr> <td><code>attachment-file-size-limit</code></td> <td><code>NTFY_ATTACHMENT_FILE_SIZE_LIMIT</code></td> <td><em>size</em></td> <td>15M</td> <td>Per-file attachment size limit (e.g. 300k, 2M, 100M). Larger attachment will be rejected.</td> </tr> <tr> <td><code>attachment-expiry-duration</code></td> <td><code>NTFY_ATTACHMENT_EXPIRY_DURATION</code></td> <td><em>duration</em></td> <td>3h</td> <td>Duration after which uploaded attachments will be deleted (e.g. 3h, 20h). Strongly affects <code>visitor-attachment-total-size-limit</code>.</td> </tr> <tr> <td><code>smtp-sender-addr</code></td> <td><code>NTFY_SMTP_SENDER_ADDR</code></td> <td><code>host:port</code></td> <td>-</td> <td>SMTP server address to allow email sending</td> </tr> <tr> <td><code>smtp-sender-user</code></td> <td><code>NTFY_SMTP_SENDER_USER</code></td> <td><em>string</em></td> <td>-</td> <td>SMTP user; only used if e-mail sending is enabled</td> </tr> <tr> <td><code>smtp-sender-pass</code></td> <td><code>NTFY_SMTP_SENDER_PASS</code></td> <td><em>string</em></td> <td>-</td> <td>SMTP password; only used if e-mail sending is enabled</td> </tr> <tr> <td><code>smtp-sender-from</code></td> <td><code>NTFY_SMTP_SENDER_FROM</code></td> <td><em>e-mail address</em></td> <td>-</td> <td>SMTP sender e-mail address; only used if e-mail sending is enabled</td> </tr> <tr> <td><code>smtp-server-listen</code></td> <td><code>NTFY_SMTP_SERVER_LISTEN</code></td> <td><code>[ip]:port</code></td> <td>-</td> <td>Defines the IP address and port the SMTP server will listen on, e.g. <code>:25</code> or <code>1.2.3.4:25</code></td> </tr> <tr> <td><code>smtp-server-domain</code></td> <td><code>NTFY_SMTP_SERVER_DOMAIN</code></td> <td><em>domain name</em></td> <td>-</td> <td>SMTP server e-mail domain, e.g. <code>ntfy.sh</code></td> </tr> <tr> <td><code>smtp-server-addr-prefix</code></td> <td><code>NTFY_SMTP_SERVER_ADDR_PREFIX</code></td> <td><em>string</em></td> <td>-</td> <td>Optional prefix for the e-mail addresses to prevent spam, e.g. <code>ntfy-</code></td> </tr> <tr> <td><code>keepalive-interval</code></td> <td><code>NTFY_KEEPALIVE_INTERVAL</code></td> <td><em>duration</em></td> <td>45s</td> <td>Interval in which keepalive messages are sent to the client. This is to prevent intermediaries closing the connection for inactivity. Note that the Android app has a hardcoded timeout at 77s, so it should be less than that.</td> </tr> <tr> <td><code>manager-interval</code></td> <td><code>NTFY_MANAGER_INTERVAL</code></td> <td><em>duration</em></td> <td>1m</td> <td>Interval in which the manager prunes old messages, deletes topics and prints the stats.</td> </tr> <tr> <td><code>global-topic-limit</code></td> <td><code>NTFY_GLOBAL_TOPIC_LIMIT</code></td> <td><em>number</em></td> <td>15,000</td> <td>Rate limiting: Total number of topics before the server rejects new topics.</td> </tr> <tr> <td><code>upstream-base-url</code></td> <td><code>NTFY_UPSTREAM_BASE_URL</code></td> <td><em>URL</em></td> <td><code>https://ntfy.sh</code></td> <td>Forward poll request to an upstream server, this is needed for iOS push notifications for self-hosted servers</td> </tr> <tr> <td><code>visitor-attachment-total-size-limit</code></td> <td><code>NTFY_VISITOR_ATTACHMENT_TOTAL_SIZE_LIMIT</code></td> <td><em>size</em></td> <td>100M</td> <td>Rate limiting: Total storage limit used for attachments per visitor, for all attachments combined. Storage is freed after attachments expire. See <code>attachment-expiry-duration</code>.</td> </tr> <tr> <td><code>visitor-attachment-daily-bandwidth-limit</code></td> <td><code>NTFY_VISITOR_ATTACHMENT_DAILY_BANDWIDTH_LIMIT</code></td> <td><em>size</em></td> <td>500M</td> <td>Rate limiting: Total daily attachment download/upload traffic limit per visitor. This is to protect your bandwidth costs from exploding.</td> </tr> <tr> <td><code>visitor-email-limit-burst</code></td> <td><code>NTFY_VISITOR_EMAIL_LIMIT_BURST</code></td> <td><em>number</em></td> <td>16</td> <td>Rate limiting:Initial limit of e-mails per visitor</td> </tr> <tr> <td><code>visitor-email-limit-replenish</code></td> <td><code>NTFY_VISITOR_EMAIL_LIMIT_REPLENISH</code></td> <td><em>duration</em></td> <td>1h</td> <td>Rate limiting: Strongly related to <code>visitor-email-limit-burst</code>: The rate at which the bucket is refilled</td> </tr> <tr> <td><code>visitor-request-limit-burst</code></td> <td><code>NTFY_VISITOR_REQUEST_LIMIT_BURST</code></td> <td><em>number</em></td> <td>60</td> <td>Rate limiting: Allowed GET/PUT/POST requests per second, per visitor. This setting is the initial bucket of requests each visitor has</td> </tr> <tr> <td><code>visitor-request-limit-replenish</code></td> <td><code>NTFY_VISITOR_REQUEST_LIMIT_REPLENISH</code></td> <td><em>duration</em></td> <td>5s</td> <td>Rate limiting: Strongly related to <code>visitor-request-limit-burst</code>: The rate at which the bucket is refilled</td> </tr> <tr> <td><code>visitor-request-limit-exempt-hosts</code></td> <td><code>NTFY_VISITOR_REQUEST_LIMIT_EXEMPT_HOSTS</code></td> <td><em>comma-separated host/IP list</em></td> <td>-</td> <td>Rate limiting: List of hostnames and IPs to be exempt from request rate limiting</td> </tr> <tr> <td><code>visitor-subscription-limit</code></td> <td><code>NTFY_VISITOR_SUBSCRIPTION_LIMIT</code></td> <td><em>number</em></td> <td>30</td> <td>Rate limiting: Number of subscriptions per visitor (IP address)</td> </tr> <tr> <td><code>web-root</code></td> <td><code>NTFY_WEB_ROOT</code></td> <td><code>app</code>, <code>home</code> or <code>disable</code></td> <td><code>app</code></td> <td>Sets web root to landing page (home), web app (app) or disables the web app entirely (disable)</td> </tr> </tbody> </table> <p>The format for a <em>duration</em> is: <code>&lt;number&gt;(smh)</code>, e.g. 30s, 20m or 1h. <br> The format for a <em>size</em> is: <code>&lt;number&gt;(GMK)</code>, e.g. 1G, 200M or 4000k.</p> <h2 id=command-line-options>Command line options<a class=headerlink href=#command-line-options title="Permanent link">&para;</a></h2> <div class=highlight><pre><span></span><code>$ ntfy serve --help
NAME:
   ntfy serve - Run the ntfy server

USAGE:
   ntfy serve [OPTIONS..]

CATEGORY:
   Server commands

DESCRIPTION:
   Run the ntfy server and listen for incoming requests

   The command will load the configuration from /etc/ntfy/server.yml. Config options can 
   be overridden using the command line options.

   Examples:
     ntfy serve                      # Starts server in the foreground (on port 80)
     ntfy serve --listen-http :8080  # Starts server with alternate port

OPTIONS:
   --attachment-cache-dir value, --attachment_cache_dir value                                          cache directory for attached files [$NTFY_ATTACHMENT_CACHE_DIR]
   --attachment-expiry-duration value, --attachment_expiry_duration value, -X value                    duration after which uploaded attachments will be deleted (e.g. 3h, 20h) (default: 3h) [$NTFY_ATTACHMENT_EXPIRY_DURATION]
   --attachment-file-size-limit value, --attachment_file_size_limit value, -Y value                    per-file attachment size limit (e.g. 300k, 2M, 100M) (default: 15M) [$NTFY_ATTACHMENT_FILE_SIZE_LIMIT]
   --attachment-total-size-limit value, --attachment_total_size_limit value, -A value                  limit of the on-disk attachment cache (default: 5G) [$NTFY_ATTACHMENT_TOTAL_SIZE_LIMIT]
   --auth-default-access value, --auth_default_access value, -p value                                  default permissions if no matching entries in the auth database are found (default: &quot;read-write&quot;) [$NTFY_AUTH_DEFAULT_ACCESS]
   --auth-file value, --auth_file value, -H value                                                      auth database file used for access control [$NTFY_AUTH_FILE]
   --base-url value, --base_url value, -B value                                                        externally visible base URL for this host (e.g. https://ntfy.sh) [$NTFY_BASE_URL]
   --behind-proxy, --behind_proxy, -P                                                                  if set, use X-Forwarded-For header to determine visitor IP address (for rate limiting) (default: false) [$NTFY_BEHIND_PROXY]
   --cache-duration since, --cache_duration since, -b since                                            buffer messages for this time to allow since requests (default: 12h0m0s) [$NTFY_CACHE_DURATION]
   --cache-file value, --cache_file value, -C value                                                    cache file used for message caching [$NTFY_CACHE_FILE]
   --cache-batch-size value, --cache_batch_size value                                                  max size of messages to batch together when writing to message cache (if zero, writes are synchronous) (default: 0) [$NTFY_BATCH_SIZE]
   --cache-batch-timeout value, --cache_batch_timeout value                                            timeout for batched async writes to the message cache (if zero, writes are synchronous) (default: 0s) [$NTFY_CACHE_BATCH_TIMEOUT]   
   --cache-startup-queries value, --cache_startup_queries value                                        queries run when the cache database is initialized [$NTFY_CACHE_STARTUP_QUERIES]
   --cert-file value, --cert_file value, -E value                                                      certificate file, if listen-https is set [$NTFY_CERT_FILE]
   --config value, -c value                                                                            config file (default: /etc/ntfy/server.yml) [$NTFY_CONFIG_FILE]
   --debug, -d                                                                                         enable debug logging (default: false) [$NTFY_DEBUG]
   --firebase-key-file value, --firebase_key_file value, -F value                                      Firebase credentials file; if set additionally publish to FCM topic [$NTFY_FIREBASE_KEY_FILE]
   --global-topic-limit value, --global_topic_limit value, -T value                                    total number of topics allowed (default: 15000) [$NTFY_GLOBAL_TOPIC_LIMIT]
   --keepalive-interval value, --keepalive_interval value, -k value                                    interval of keepalive messages (default: 45s) [$NTFY_KEEPALIVE_INTERVAL]
   --key-file value, --key_file value, -K value                                                        private key file, if listen-https is set [$NTFY_KEY_FILE]
   --listen-http value, --listen_http value, -l value                                                  ip:port used to as HTTP listen address (default: &quot;:80&quot;) [$NTFY_LISTEN_HTTP]
   --listen-https value, --listen_https value, -L value                                                ip:port used to as HTTPS listen address [$NTFY_LISTEN_HTTPS]
   --listen-unix value, --listen_unix value, -U value                                                  listen on unix socket path [$NTFY_LISTEN_UNIX]
   --log-level value, --log_level value                                                                set log level (default: &quot;INFO&quot;) [$NTFY_LOG_LEVEL]
   --manager-interval value, --manager_interval value, -m value                                        interval of for message pruning and stats printing (default: 1m0s) [$NTFY_MANAGER_INTERVAL]
   --no-log-dates, --no_log_dates                                                                      disable the date/time prefix (default: false) [$NTFY_NO_LOG_DATES]
   --smtp-sender-addr value, --smtp_sender_addr value                                                  SMTP server address (host:port) for outgoing emails [$NTFY_SMTP_SENDER_ADDR]
   --smtp-sender-from value, --smtp_sender_from value                                                  SMTP sender address (if e-mail sending is enabled) [$NTFY_SMTP_SENDER_FROM]
   --smtp-sender-pass value, --smtp_sender_pass value                                                  SMTP password (if e-mail sending is enabled) [$NTFY_SMTP_SENDER_PASS]
   --smtp-sender-user value, --smtp_sender_user value                                                  SMTP user (if e-mail sending is enabled) [$NTFY_SMTP_SENDER_USER]
   --smtp-server-addr-prefix value, --smtp_server_addr_prefix value                                    SMTP email address prefix for topics to prevent spam (e.g. &#39;ntfy-&#39;) [$NTFY_SMTP_SERVER_ADDR_PREFIX]
   --smtp-server-domain value, --smtp_server_domain value                                              SMTP domain for incoming e-mail, e.g. ntfy.sh [$NTFY_SMTP_SERVER_DOMAIN]
   --smtp-server-listen value, --smtp_server_listen value                                              SMTP server address (ip:port) for incoming emails, e.g. :25 [$NTFY_SMTP_SERVER_LISTEN]
   --trace                                                                                             enable tracing (very verbose, be careful) (default: false) [$NTFY_TRACE]
   --upstream-base-url value, --upstream_base_url value                                                forward poll request to an upstream server, this is needed for iOS push notifications for self-hosted servers [$NTFY_UPSTREAM_BASE_URL]
   --visitor-attachment-daily-bandwidth-limit value, --visitor_attachment_daily_bandwidth_limit value  total daily attachment download/upload bandwidth limit per visitor (default: &quot;500M&quot;) [$NTFY_VISITOR_ATTACHMENT_DAILY_BANDWIDTH_LIMIT]
   --visitor-attachment-total-size-limit value, --visitor_attachment_total_size_limit value            total storage limit used for attachments per visitor (default: &quot;100M&quot;) [$NTFY_VISITOR_ATTACHMENT_TOTAL_SIZE_LIMIT]
   --visitor-email-limit-burst value, --visitor_email_limit_burst value                                initial limit of e-mails per visitor (default: 16) [$NTFY_VISITOR_EMAIL_LIMIT_BURST]
   --visitor-email-limit-replenish value, --visitor_email_limit_replenish value                        interval at which burst limit is replenished (one per x) (default: 1h0m0s) [$NTFY_VISITOR_EMAIL_LIMIT_REPLENISH]
   --visitor-request-limit-burst value, --visitor_request_limit_burst value                            initial limit of requests per visitor (default: 60) [$NTFY_VISITOR_REQUEST_LIMIT_BURST]
   --visitor-request-limit-exempt-hosts value, --visitor_request_limit_exempt_hosts value              hostnames and/or IP addresses of hosts that will be exempt from the visitor request limit [$NTFY_VISITOR_REQUEST_LIMIT_EXEMPT_HOSTS]
   --visitor-request-limit-replenish value, --visitor_request_limit_replenish value                    interval at which burst limit is replenished (one per x) (default: 5s) [$NTFY_VISITOR_REQUEST_LIMIT_REPLENISH]
   --visitor-subscription-limit value, --visitor_subscription_limit value                              number of subscriptions per visitor (default: 30) [$NTFY_VISITOR_SUBSCRIPTION_LIMIT]
   --web-root value, --web_root value                                                                  sets web root to landing page (home), web app (app) or disabled (disable) (default: &quot;app&quot;) [$NTFY_WEB_ROOT]
</code></pre></div> </article> </div> <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var tab,labels=set.querySelector(".tabbed-labels");for(tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script> </div> </main> <footer class=md-footer> <nav class="md-footer__inner md-grid" aria-label=Footer> <a href=../install/ class="md-footer__link md-footer__link--prev" aria-label="Previous: Installation" rel=prev> <div class="md-footer__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg> </div> <div class=md-footer__title> <div class=md-ellipsis> <span class=md-footer__direction> Previous </span> Installation </div> </div> </a> <a href=../faq/ class="md-footer__link md-footer__link--next" aria-label="Next: FAQs" rel=next> <div class=md-footer__title> <div class=md-ellipsis> <span class=md-footer__direction> Next </span> FAQs </div> </div> <div class="md-footer__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4Z"/></svg> </div> </a> </nav> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-copyright> <div class=md-copyright__highlight> Made with â¤ï¸ by Philipp C. Heckel </div> Made with <a href=https://squidfunk.github.io/mkdocs-material/ target=_blank rel=noopener> Material for MkDocs </a> </div> <div class=md-social> <a href=https://github.com/binwiederhier target=_blank rel=noopener title=github.com class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 480 512"><!-- Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M186.1 328.7c0 20.9-10.9 55.1-36.7 55.1s-36.7-34.2-36.7-55.1 10.9-55.1 36.7-55.1 36.7 34.2 36.7 55.1zM480 278.2c0 31.9-3.2 65.7-17.5 95-37.9 76.6-142.1 74.8-216.7 74.8-75.8 0-186.2 2.7-225.6-74.8-14.6-29-20.2-63.1-20.2-95 0-41.9 13.9-81.5 41.5-113.6-5.2-15.8-7.7-32.4-7.7-48.8 0-21.5 4.9-32.3 14.6-51.8 45.3 0 74.3 9 108.8 36 29-6.9 58.8-10 88.7-10 27 0 54.2 2.9 80.4 9.2 34-26.7 63-35.2 107.8-35.2 9.8 19.5 14.6 30.3 14.6 51.8 0 16.4-2.6 32.7-7.7 48.2 27.5 32.4 39 72.3 39 114.2zm-64.3 50.5c0-43.9-26.7-82.6-73.5-82.6-18.9 0-37 3.4-56 6-14.9 2.3-29.8 3.2-45.1 3.2-15.2 0-30.1-.9-45.1-3.2-18.7-2.6-37-6-56-6-46.8 0-73.5 38.7-73.5 82.6 0 87.8 80.4 101.3 150.4 101.3h48.2c70.3 0 150.6-13.4 150.6-101.3zm-82.6-55.1c-25.8 0-36.7 34.2-36.7 55.1s10.9 55.1 36.7 55.1 36.7-34.2 36.7-55.1-10.9-55.1-36.7-55.1z"/></svg> </a> </div> </div> </div> </footer> </div> <div class=md-dialog data-md-component=dialog> <div class="md-dialog__inner md-typeset"></div> </div> <script id=__config type=application/json>{"base": "..", "features": ["search.suggest", "search.highlight", "search.share", "navigation.sections", "toc.integrate", "content.tabs.link"], "search": "../assets/javascripts/workers/search.16e2a7d4.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version.title": "Select version"}}</script> <script src=../assets/javascripts/bundle.d6c3db9e.min.js></script> <script src=../static/js/extra.js></script> </body> </html>