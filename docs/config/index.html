<!doctype html><html lang=en class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Send push notifications to your phone via PUT/POST"><link href=https://ntfy.sh/config/ rel=canonical><link href=../install/ rel=prev><link href=../faq/ rel=next><link rel=icon href=../static/img/favicon.ico><meta name=generator content="mkdocs-1.6.1, mkdocs-material-9.6.16"><title>Configuration - ntfy</title><link rel=stylesheet href=../assets/stylesheets/main.7e37652d.min.css><link rel=stylesheet href=../assets/stylesheets/palette.06af60db.min.css><link rel=stylesheet href=../static/css/extra.css><script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script></head> <body dir=ltr data-md-color-scheme=default data-md-color-primary=indigo data-md-color-accent=indigo> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#configuring-the-ntfy-server class=md-skip> Skip to content </a> </div> <div data-md-component=announce> <aside class=md-banner> <div class="md-banner__inner md-grid md-typeset"> <style>
    div[data-md-component="announce"] {
        z-index: 10;
    }

    div[data-md-component="announce"] a {
        color: white;
    }

    div[data-md-component="announce"] a:hover, div[data-md-component="announce"] a:focus {
        transition: ease-in 150ms;
        color: #ccc;
    }

    div[data-md-component="announce"] .md-banner__button {
        color: #ccc;
    }

    div[data-md-component="announce"] .md-banner.hidden {
        display: none;
    }

    div[data-md-component="announce"] .twemoji {
        margin-top: 2px;
    }
</style> <button id=announce-bar-close class="md-banner__button md-icon" aria-label="Don't show this again"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"> <path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"></path> </svg> </button> If you like ntfy, please consider sponsoring me via <a target=_blank href=https://github.com/sponsors/binwiederhier><strong>GitHub Sponsors</strong></a> or <a href=https://en.liberapay.com/ntfy/ target=_blank><strong>Liberapay</strong></a> <svg xmlns=http://www.w3.org/2000/svg role=img viewbox="0 0 36 36" class="twemoji md-footer-custom-text"> <path fill=#DD2E44 d="M35.885 11.833c0-5.45-4.418-9.868-9.867-9.868-3.308 0-6.227 1.633-8.018 4.129-1.791-2.496-4.71-4.129-8.017-4.129-5.45 0-9.868 4.417-9.868 9.868 0 .772.098 1.52.266 2.241C1.751 22.587 11.216 31.568 18 34.034c6.783-2.466 16.249-11.447 17.617-19.959.17-.721.268-1.469.268-2.242z"/> </svg>, or subscribing to <a target=_blank href=https://ntfy.sh/app><strong>ntfy Pro</strong></a>. <script>
    announceBarKey = 'announce-bar-closed-sponsor';
    document.getElementById('announce-bar-close').addEventListener('click', (e) => {
        localStorage.setItem(announceBarKey, 'true');
        document.querySelector('div[data-md-component="announce"] .md-banner').style.display = 'none';
    });
    if (localStorage.getItem(announceBarKey) === 'true') {
        document.querySelector('div[data-md-component="announce"] .md-banner').style.display = 'none';
    }
</script> </div> </aside> </div> <header class="md-header md-header--shadow" data-md-component=header> <nav class="md-header__inner md-grid" aria-label=Header> <a href=/ title=ntfy class="md-header__button md-logo" aria-label=ntfy data-md-component=logo> <img src=../static/img/ntfy.png alt=logo> </a> <label class="md-header__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg> </label> <div class=md-header__title data-md-component=header-title> <div class=md-header__ellipsis> <div class=md-header__topic> <span class=md-ellipsis> ntfy </span> </div> <div class=md-header__topic data-md-component=header-topic> <span class=md-ellipsis> Configuration </span> </div> </div> </div> <form class=md-header__option data-md-component=palette> <input class=md-option data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme=default data-md-color-primary=indigo data-md-color-accent=indigo aria-label="Switch to dark mode" type=radio name=__palette id=__palette_0> <label class="md-header__button md-icon" title="Switch to dark mode" for=__palette_1 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 2a7 7 0 0 1 7 7c0 2.38-1.19 4.47-3 5.74V17a1 1 0 0 1-1 1H9a1 1 0 0 1-1-1v-2.26C6.19 13.47 5 11.38 5 9a7 7 0 0 1 7-7M9 21v-1h6v1a1 1 0 0 1-1 1h-4a1 1 0 0 1-1-1m3-17a5 5 0 0 0-5 5c0 2.05 1.23 3.81 3 4.58V16h4v-2.42c1.77-.77 3-2.53 3-4.58a5 5 0 0 0-5-5"/></svg> </label> <input class=md-option data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme=slate data-md-color-primary=indigo data-md-color-accent=indigo aria-label="Switch to light mode" type=radio name=__palette id=__palette_1> <label class="md-header__button md-icon" title="Switch to light mode" for=__palette_0 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 2a7 7 0 0 0-7 7c0 2.38 1.19 4.47 3 5.74V17a1 1 0 0 0 1 1h6a1 1 0 0 0 1-1v-2.26c1.81-1.27 3-3.36 3-5.74a7 7 0 0 0-7-7M9 21a1 1 0 0 0 1 1h4a1 1 0 0 0 1-1v-1H9z"/></svg> </label> </form> <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script> <label class="md-header__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=Search placeholder=Search autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query required> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg> </label> <nav class=md-search__options aria-label=Search> <a href=javascript:void(0) class="md-search__icon md-icon" title=Share aria-label=Share data-clipboard data-clipboard-text data-md-component=search-share tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7s-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91s2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08"/></svg> </a> <button type=reset class="md-search__icon md-icon" title=Clear aria-label=Clear tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg> </button> </nav> <div class=md-search__suggest data-md-component=search-suggest></div> </form> <div class=md-search__output> <div class=md-search__scrollwrap tabindex=0 data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> Initializing search </div> <ol class=md-search-result__list role=presentation></ol> </div> </div> </div> </div> </div> <div class=md-header__source> <a href=https://github.com/binwiederhier/ntfy title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path fill=currentColor d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg> </div> <div class=md-source__repository> binwiederhier/ntfy </div> </a> </div> </nav> </header> <div class=md-container data-md-component=container> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary md-nav--integrated" aria-label=Navigation data-md-level=0> <label class=md-nav__title for=__drawer> <a href=/ title=ntfy class="md-nav__button md-logo" aria-label=ntfy data-md-component=logo> <img src=../static/img/ntfy.png alt=logo> </a> ntfy </label> <div class=md-nav__source> <a href=https://github.com/binwiederhier/ntfy title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path fill=currentColor d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg> </div> <div class=md-source__repository> binwiederhier/ntfy </div> </a> </div> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=.. class=md-nav__link> <span class=md-ellipsis> Getting started </span> </a> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2> <label class=md-nav__link for=__nav_2 id=__nav_2_label tabindex> <span class=md-ellipsis> Publishing </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_2_label aria-expanded=false> <label class=md-nav__title for=__nav_2> <span class="md-nav__icon md-icon"></span> Publishing </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../publish/ class=md-nav__link> <span class=md-ellipsis> Sending messages </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3> <label class=md-nav__link for=__nav_3 id=__nav_3_label tabindex> <span class=md-ellipsis> Subscribing </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_3_label aria-expanded=false> <label class=md-nav__title for=__nav_3> <span class="md-nav__icon md-icon"></span> Subscribing </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../subscribe/phone/ class=md-nav__link> <span class=md-ellipsis> From your phone </span> </a> </li> <li class=md-nav__item> <a href=../subscribe/web/ class=md-nav__link> <span class=md-ellipsis> From the Web app </span> </a> </li> <li class=md-nav__item> <a href=../subscribe/pwa/ class=md-nav__link> <span class=md-ellipsis> From the Desktop </span> </a> </li> <li class=md-nav__item> <a href=../subscribe/cli/ class=md-nav__link> <span class=md-ellipsis> From the CLI </span> </a> </li> <li class=md-nav__item> <a href=../subscribe/api/ class=md-nav__link> <span class=md-ellipsis> Using the API </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_4 checked> <label class=md-nav__link for=__nav_4 id=__nav_4_label tabindex> <span class=md-ellipsis> Self-hosting </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_4_label aria-expanded=true> <label class=md-nav__title for=__nav_4> <span class="md-nav__icon md-icon"></span> Self-hosting </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../install/ class=md-nav__link> <span class=md-ellipsis> Installation </span> </a> </li> <li class="md-nav__item md-nav__item--active"> <input class="md-nav__toggle md-toggle" type=checkbox id=__toc> <label class="md-nav__link md-nav__link--active" for=__toc> <span class=md-ellipsis> Configuration </span> <span class="md-nav__icon md-icon"></span> </label> <a href=./ class="md-nav__link md-nav__link--active"> <span class=md-ellipsis> Configuration </span> </a> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#quick-start class=md-nav__link> <span class=md-ellipsis> Quick start </span> </a> </li> <li class=md-nav__item> <a href=#example-config class=md-nav__link> <span class=md-ellipsis> Example config </span> </a> </li> <li class=md-nav__item> <a href=#message-cache class=md-nav__link> <span class=md-ellipsis> Message cache </span> </a> </li> <li class=md-nav__item> <a href=#attachments class=md-nav__link> <span class=md-ellipsis> Attachments </span> </a> </li> <li class=md-nav__item> <a href=#access-control class=md-nav__link> <span class=md-ellipsis> Access control </span> </a> <nav class=md-nav aria-label="Access control"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#users-and-roles class=md-nav__link> <span class=md-ellipsis> Users and roles </span> </a> <nav class=md-nav aria-label="Users and roles"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#users-via-the-cli class=md-nav__link> <span class=md-ellipsis> Users via the CLI </span> </a> </li> <li class=md-nav__item> <a href=#users-via-the-config class=md-nav__link> <span class=md-ellipsis> Users via the config </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#access-control-list-acl class=md-nav__link> <span class=md-ellipsis> Access control list (ACL) </span> </a> <nav class=md-nav aria-label="Access control list (ACL)"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#acl-entries-via-the-cli class=md-nav__link> <span class=md-ellipsis> ACL entries via the CLI </span> </a> </li> <li class=md-nav__item> <a href=#acl-entries-via-the-config class=md-nav__link> <span class=md-ellipsis> ACL entries via the config </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#access-tokens class=md-nav__link> <span class=md-ellipsis> Access tokens </span> </a> <nav class=md-nav aria-label="Access tokens"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#tokens-via-the-cli class=md-nav__link> <span class=md-ellipsis> Tokens via the CLI </span> </a> </li> <li class=md-nav__item> <a href=#tokens-via-the-config class=md-nav__link> <span class=md-ellipsis> Tokens via the config </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#example-private-instance class=md-nav__link> <span class=md-ellipsis> Example: Private instance </span> </a> </li> <li class=md-nav__item> <a href=#example-unifiedpush class=md-nav__link> <span class=md-ellipsis> Example: UnifiedPush </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#e-mail-notifications class=md-nav__link> <span class=md-ellipsis> E-mail notifications </span> </a> </li> <li class=md-nav__item> <a href=#e-mail-publishing class=md-nav__link> <span class=md-ellipsis> E-mail publishing </span> </a> <nav class=md-nav aria-label="E-mail publishing"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#local-only-email class=md-nav__link> <span class=md-ellipsis> Local-only email </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#behind-a-proxy-tls-etc class=md-nav__link> <span class=md-ellipsis> Behind a proxy (TLS, etc.) </span> </a> <nav class=md-nav aria-label="Behind a proxy (TLS, etc.)"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#ip-based-rate-limiting class=md-nav__link> <span class=md-ellipsis> IP-based rate limiting </span> </a> </li> <li class=md-nav__item> <a href=#tlsssl class=md-nav__link> <span class=md-ellipsis> TLS/SSL </span> </a> </li> <li class=md-nav__item> <a href=#nginxapache2caddy class=md-nav__link> <span class=md-ellipsis> nginx/Apache2/caddy </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#firebase-fcm class=md-nav__link> <span class=md-ellipsis> Firebase (FCM) </span> </a> </li> <li class=md-nav__item> <a href=#ios-instant-notifications class=md-nav__link> <span class=md-ellipsis> iOS instant notifications </span> </a> </li> <li class=md-nav__item> <a href=#web-push class=md-nav__link> <span class=md-ellipsis> Web Push </span> </a> </li> <li class=md-nav__item> <a href=#tiers class=md-nav__link> <span class=md-ellipsis> Tiers </span> </a> </li> <li class=md-nav__item> <a href=#payments class=md-nav__link> <span class=md-ellipsis> Payments </span> </a> </li> <li class=md-nav__item> <a href=#phone-calls class=md-nav__link> <span class=md-ellipsis> Phone calls </span> </a> </li> <li class=md-nav__item> <a href=#message-limits class=md-nav__link> <span class=md-ellipsis> Message limits </span> </a> </li> <li class=md-nav__item> <a href=#rate-limiting class=md-nav__link> <span class=md-ellipsis> Rate limiting </span> </a> <nav class=md-nav aria-label="Rate limiting"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#general-limits class=md-nav__link> <span class=md-ellipsis> General limits </span> </a> </li> <li class=md-nav__item> <a href=#request-limits class=md-nav__link> <span class=md-ellipsis> Request limits </span> </a> </li> <li class=md-nav__item> <a href=#message-limits_1 class=md-nav__link> <span class=md-ellipsis> Message limits </span> </a> </li> <li class=md-nav__item> <a href=#attachment-limits class=md-nav__link> <span class=md-ellipsis> Attachment limits </span> </a> </li> <li class=md-nav__item> <a href=#e-mail-limits class=md-nav__link> <span class=md-ellipsis> E-mail limits </span> </a> </li> <li class=md-nav__item> <a href=#firebase-limits class=md-nav__link> <span class=md-ellipsis> Firebase limits </span> </a> </li> <li class=md-nav__item> <a href=#ipv6-considerations class=md-nav__link> <span class=md-ellipsis> IPv6 considerations </span> </a> </li> <li class=md-nav__item> <a href=#subscriber-based-rate-limiting class=md-nav__link> <span class=md-ellipsis> Subscriber-based rate limiting </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#tuning-for-scale class=md-nav__link> <span class=md-ellipsis> Tuning for scale </span> </a> <nav class=md-nav aria-label="Tuning for scale"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#message-cache_1 class=md-nav__link> <span class=md-ellipsis> Message cache </span> </a> </li> <li class=md-nav__item> <a href=#for-systemd-services class=md-nav__link> <span class=md-ellipsis> For systemd services </span> </a> </li> <li class=md-nav__item> <a href=#outside-of-systemd class=md-nav__link> <span class=md-ellipsis> Outside of systemd </span> </a> </li> <li class=md-nav__item> <a href=#proxy-limits-nginx-apache2 class=md-nav__link> <span class=md-ellipsis> Proxy limits (nginx, Apache2) </span> </a> </li> <li class=md-nav__item> <a href=#banning-bad-actors-fail2ban class=md-nav__link> <span class=md-ellipsis> Banning bad actors (fail2ban) </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#ipv6-support class=md-nav__link> <span class=md-ellipsis> IPv6 support </span> </a> </li> <li class=md-nav__item> <a href=#health-checks class=md-nav__link> <span class=md-ellipsis> Health checks </span> </a> </li> <li class=md-nav__item> <a href=#monitoring class=md-nav__link> <span class=md-ellipsis> Monitoring </span> </a> </li> <li class=md-nav__item> <a href=#profiling class=md-nav__link> <span class=md-ellipsis> Profiling </span> </a> </li> <li class=md-nav__item> <a href=#logging-debugging class=md-nav__link> <span class=md-ellipsis> Logging &amp; debugging </span> </a> </li> <li class=md-nav__item> <a href=#config-options class=md-nav__link> <span class=md-ellipsis> Config options </span> </a> </li> <li class=md-nav__item> <a href=#command-line-options class=md-nav__link> <span class=md-ellipsis> Command line options </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_5> <label class=md-nav__link for=__nav_5 id=__nav_5_label tabindex> <span class=md-ellipsis> Other things </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_5_label aria-expanded=false> <label class=md-nav__title for=__nav_5> <span class="md-nav__icon md-icon"></span> Other things </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../faq/ class=md-nav__link> <span class=md-ellipsis> FAQs </span> </a> </li> <li class=md-nav__item> <a href=../examples/ class=md-nav__link> <span class=md-ellipsis> Examples </span> </a> </li> <li class=md-nav__item> <a href=../integrations/ class=md-nav__link> <span class=md-ellipsis> Integrations + projects </span> </a> </li> <li class=md-nav__item> <a href=../releases/ class=md-nav__link> <span class=md-ellipsis> Release notes </span> </a> </li> <li class=md-nav__item> <a href=../emojis/ class=md-nav__link> <span class=md-ellipsis> Emojis ðŸ¥³ ðŸŽ‰ </span> </a> </li> <li class=md-nav__item> <a href=../publish/template-functions/ class=md-nav__link> <span class=md-ellipsis> Template functions </span> </a> </li> <li class=md-nav__item> <a href=../troubleshooting/ class=md-nav__link> <span class=md-ellipsis> Troubleshooting </span> </a> </li> <li class=md-nav__item> <a href=../known-issues/ class=md-nav__link> <span class=md-ellipsis> Known issues </span> </a> </li> <li class=md-nav__item> <a href=../deprecations/ class=md-nav__link> <span class=md-ellipsis> Deprecation notices </span> </a> </li> <li class=md-nav__item> <a href=../develop/ class=md-nav__link> <span class=md-ellipsis> Development </span> </a> </li> <li class=md-nav__item> <a href=../privacy/ class=md-nav__link> <span class=md-ellipsis> Privacy policy </span> </a> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class=md-content data-md-component=content> <article class="md-content__inner md-typeset"> <h1 id=configuring-the-ntfy-server>Configuring the ntfy server<a class=headerlink href=#configuring-the-ntfy-server title="Permanent link">&para;</a></h1> <p>The ntfy server can be configured in three ways: using a config file (typically at <code>/etc/ntfy/server.yml</code>, see <a href=https://github.com/binwiederhier/ntfy/blob/main/server/server.yml>server.yml</a>), via command line arguments or using environment variables.</p> <h2 id=quick-start>Quick start<a class=headerlink href=#quick-start title="Permanent link">&para;</a></h2> <p>By default, simply running <code>ntfy serve</code> will start the server at port 80. No configuration needed. Batteries included ðŸ˜€. If everything works as it should, you'll see something like this: <div class=highlight><pre><span></span><code>$ ntfy serve
2021/11/30 19:59:08 Listening on :80
</code></pre></div></p> <p>You can immediately start <a href=../publish/ >publishing messages</a>, or subscribe via the <a href=../subscribe/phone/ >Android app</a>, <a href=../subscribe/web/ >the web UI</a>, or simply via <a href=../subscribe/api/ >curl or your favorite HTTP client</a>. To configure the server further, check out the <a href=#config-options>config options table</a> or simply type <code>ntfy serve --help</code> to get a list of <a href=#command-line-options>command line options</a>.</p> <h2 id=example-config>Example config<a class=headerlink href=#example-config title="Permanent link">&para;</a></h2> <div class="admonition info"> <p class=admonition-title>Info</p> <p>Definitely check out the <strong><a href=https://github.com/binwiederhier/ntfy/blob/main/server/server.yml>server.yml</a></strong> file. It contains examples and detailed descriptions of all the settings. You may also want to look at how ntfy.sh is configured in the <a href=https://github.com/binwiederhier/ntfy-ansible>ntfy-ansible</a> repository.</p> </div> <p>The most basic settings are <code>base-url</code> (the external URL of the ntfy server), the HTTP/HTTPS listen address (<code>listen-http</code> and <code>listen-https</code>), and socket path (<code>listen-unix</code>). All the other things are additional features.</p> <p>Here are a few working sample configs using a <code>/etc/ntfy/server.yml</code> file:</p> <div class="tabbed-set tabbed-alternate" data-tabs=1:4><input checked=checked id=__tabbed_1_1 name=__tabbed_1 type=radio><input id=__tabbed_1_2 name=__tabbed_1 type=radio><input id=__tabbed_1_3 name=__tabbed_1 type=radio><input id=__tabbed_1_4 name=__tabbed_1 type=radio><div class=tabbed-labels><label for=__tabbed_1_1>server.yml (HTTP-only, with cache + attachments)</label><label for=__tabbed_1_2>server.yml (HTTP+HTTPS, with cache + attachments)</label><label for=__tabbed_1_3>server.yml (behind proxy, with cache + attachments)</label><label for=__tabbed_1_4>server.yml (ntfy.sh config)</label></div> <div class=tabbed-content> <div class=tabbed-block> <div class=highlight><pre><span></span><code><span class=nt>base-url</span><span class=p>:</span><span class=w> </span><span class=s>&quot;http://ntfy.example.com&quot;</span>
<span class=nt>cache-file</span><span class=p>:</span><span class=w> </span><span class=s>&quot;/var/cache/ntfy/cache.db&quot;</span>
<span class=nt>attachment-cache-dir</span><span class=p>:</span><span class=w> </span><span class=s>&quot;/var/cache/ntfy/attachments&quot;</span>
</code></pre></div> </div> <div class=tabbed-block> <div class=highlight><pre><span></span><code><span class=nt>base-url</span><span class=p>:</span><span class=w> </span><span class=s>&quot;http://ntfy.example.com&quot;</span>
<span class=nt>listen-http</span><span class=p>:</span><span class=w> </span><span class=s>&quot;:80&quot;</span>
<span class=nt>listen-https</span><span class=p>:</span><span class=w> </span><span class=s>&quot;:443&quot;</span>
<span class=nt>key-file</span><span class=p>:</span><span class=w> </span><span class=s>&quot;/etc/letsencrypt/live/ntfy.example.com.key&quot;</span>
<span class=nt>cert-file</span><span class=p>:</span><span class=w> </span><span class=s>&quot;/etc/letsencrypt/live/ntfy.example.com.crt&quot;</span>
<span class=nt>cache-file</span><span class=p>:</span><span class=w> </span><span class=s>&quot;/var/cache/ntfy/cache.db&quot;</span>
<span class=nt>attachment-cache-dir</span><span class=p>:</span><span class=w> </span><span class=s>&quot;/var/cache/ntfy/attachments&quot;</span>
</code></pre></div> </div> <div class=tabbed-block> <div class=highlight><pre><span></span><code><span class=nt>base-url</span><span class=p>:</span><span class=w> </span><span class=s>&quot;http://ntfy.example.com&quot;</span>
<span class=nt>listen-http</span><span class=p>:</span><span class=w> </span><span class=s>&quot;:2586&quot;</span>
<span class=nt>cache-file</span><span class=p>:</span><span class=w> </span><span class=s>&quot;/var/cache/ntfy/cache.db&quot;</span>
<span class=nt>attachment-cache-dir</span><span class=p>:</span><span class=w> </span><span class=s>&quot;/var/cache/ntfy/attachments&quot;</span>
<span class=nt>behind-proxy</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
</code></pre></div> </div> <div class=tabbed-block> <div class=highlight><pre><span></span><code><span class=c1># All the things: Behind a proxy, Firebase, cache, attachments, </span>
<span class=c1># SMTP publishing &amp; receiving</span>

<span class=nt>base-url</span><span class=p>:</span><span class=w> </span><span class=s>&quot;https://ntfy.sh&quot;</span>
<span class=nt>listen-http</span><span class=p>:</span><span class=w> </span><span class=s>&quot;127.0.0.1:2586&quot;</span>
<span class=nt>firebase-key-file</span><span class=p>:</span><span class=w> </span><span class=s>&quot;/etc/ntfy/firebase.json&quot;</span>
<span class=nt>cache-file</span><span class=p>:</span><span class=w> </span><span class=s>&quot;/var/cache/ntfy/cache.db&quot;</span>
<span class=nt>behind-proxy</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class=nt>attachment-cache-dir</span><span class=p>:</span><span class=w> </span><span class=s>&quot;/var/cache/ntfy/attachments&quot;</span>
<span class=nt>smtp-sender-addr</span><span class=p>:</span><span class=w> </span><span class=s>&quot;email-smtp.us-east-2.amazonaws.com:587&quot;</span>
<span class=nt>smtp-sender-user</span><span class=p>:</span><span class=w> </span><span class=s>&quot;AKIDEADBEEFAFFE12345&quot;</span>
<span class=nt>smtp-sender-pass</span><span class=p>:</span><span class=w> </span><span class=s>&quot;Abd13Kf+sfAk2DzifjafldkThisIsNotARealKeyOMG.&quot;</span>
<span class=nt>smtp-sender-from</span><span class=p>:</span><span class=w> </span><span class=s>&quot;ntfy@ntfy.sh&quot;</span>
<span class=nt>smtp-server-listen</span><span class=p>:</span><span class=w> </span><span class=s>&quot;:25&quot;</span>
<span class=nt>smtp-server-domain</span><span class=p>:</span><span class=w> </span><span class=s>&quot;ntfy.sh&quot;</span>
<span class=nt>smtp-server-addr-prefix</span><span class=p>:</span><span class=w> </span><span class=s>&quot;ntfy-&quot;</span>
<span class=nt>keepalive-interval</span><span class=p>:</span><span class=w> </span><span class=s>&quot;45s&quot;</span>
</code></pre></div> </div> </div> </div> <p>Alternatively, you can also use command line arguments or environment variables to configure the server. Here's an example using Docker Compose (i.e. <code>docker-compose.yml</code>):</p> <div class="tabbed-set tabbed-alternate" data-tabs=2:2><input checked=checked id=__tabbed_2_1 name=__tabbed_2 type=radio><input id=__tabbed_2_2 name=__tabbed_2 type=radio><div class=tabbed-labels><label for=__tabbed_2_1>Docker Compose (w/ auth, cache, attachments)</label><label for=__tabbed_2_2>Docker Compose (w/ auth, cache, web push, iOS)</label></div> <div class=tabbed-content> <div class=tabbed-block> <div class=highlight><pre><span></span><code><span class=nt>services</span><span class=p>:</span>
<span class=w>  </span><span class=nt>ntfy</span><span class=p>:</span>
<span class=w>    </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">binwiederhier/ntfy</span>
<span class=w>    </span><span class=nt>restart</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">unless-stopped</span>
<span class=w>    </span><span class=nt>environment</span><span class=p>:</span>
<span class=w>      </span><span class=nt>NTFY_BASE_URL</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">http://ntfy.example.com</span>
<span class=w>      </span><span class=nt>NTFY_CACHE_FILE</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">/var/lib/ntfy/cache.db</span>
<span class=w>      </span><span class=nt>NTFY_AUTH_FILE</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">/var/lib/ntfy/auth.db</span>
<span class=w>      </span><span class=nt>NTFY_AUTH_DEFAULT_ACCESS</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">deny-all</span>
<span class=w>      </span><span class=nt>NTFY_AUTH_USERS</span><span class=p>:</span><span class=w> </span><span class=s>&#39;phil:$$2a$$10$$YLiO8U21sX1uhZamTLJXHuxgVC0Z/GKISibrKCLohPgtG7yIxSk4C:admin&#39;</span><span class=w> </span><span class=c1># Must escape &#39;$&#39; as &#39;$$&#39;</span>
<span class=w>      </span><span class=nt>NTFY_BEHIND_PROXY</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class=w>      </span><span class=nt>NTFY_ATTACHMENT_CACHE_DIR</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">/var/lib/ntfy/attachments</span>
<span class=w>      </span><span class=nt>NTFY_ENABLE_LOGIN</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class=w>    </span><span class=nt>volumes</span><span class=p>:</span>
<span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">./:/var/lib/ntfy</span>
<span class=w>    </span><span class=nt>ports</span><span class=p>:</span>
<span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">80:80</span>
<span class=w>    </span><span class=nt>command</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">serve</span>
</code></pre></div> </div> <div class=tabbed-block> <div class=highlight><pre><span></span><code><span class=nt>services</span><span class=p>:</span>
<span class=w>  </span><span class=nt>ntfy</span><span class=p>:</span>
<span class=w>    </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">binwiederhier/ntfy</span>
<span class=w>    </span><span class=nt>restart</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">unless-stopped</span>
<span class=w>    </span><span class=nt>environment</span><span class=p>:</span>
<span class=w>      </span><span class=nt>NTFY_BASE_URL</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">http://ntfy.example.com</span>
<span class=w>      </span><span class=nt>NTFY_CACHE_FILE</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">/var/lib/ntfy/cache.db</span>
<span class=w>      </span><span class=nt>NTFY_AUTH_FILE</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">/var/lib/ntfy/auth.db</span>
<span class=w>      </span><span class=nt>NTFY_AUTH_DEFAULT_ACCESS</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">deny-all</span>
<span class=w>      </span><span class=nt>NTFY_BEHIND_PROXY</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class=w>      </span><span class=nt>NTFY_ATTACHMENT_CACHE_DIR</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">/var/lib/ntfy/attachments</span>
<span class=w>      </span><span class=nt>NTFY_ENABLE_LOGIN</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class=w>      </span><span class=nt>NTFY_UPSTREAM_BASE_URL</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">https://ntfy.sh</span>
<span class=w>      </span><span class=nt>NTFY_WEB_PUSH_PUBLIC_KEY</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">&lt;public_key&gt;</span>
<span class=w>      </span><span class=nt>NTFY_WEB_PUSH_PRIVATE_KEY</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">&lt;private_key&gt;</span>
<span class=w>      </span><span class=nt>NTFY_WEB_PUSH_FILE</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">/var/lib/ntfy/webpush.db</span>
<span class=w>      </span><span class=nt>NTFY_WEB_PUSH_EMAIL_ADDRESS</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">&lt;email&gt;</span>
<span class=w>    </span><span class=nt>volumes</span><span class=p>:</span>
<span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">./:/var/lib/ntfy</span>
<span class=w>    </span><span class=nt>ports</span><span class=p>:</span>
<span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">8093:80</span>
<span class=w>    </span><span class=nt>command</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">serve</span>
</code></pre></div> </div> </div> </div> <h2 id=message-cache>Message cache<a class=headerlink href=#message-cache title="Permanent link">&para;</a></h2> <p>If desired, ntfy can temporarily keep notifications in an in-memory or an on-disk cache. Caching messages for a short period of time is important to allow <a href=../subscribe/phone/ >phones</a> and other devices with brittle Internet connections to be able to retrieve notifications that they may have missed. </p> <p>By default, ntfy keeps messages <strong>in-memory for 12 hours</strong>, which means that <strong>cached messages do not survive an application restart</strong>. You can override this behavior using the following config settings:</p> <ul> <li><code>cache-file</code>: if set, ntfy will store messages in a SQLite based cache (default is empty, which means in-memory cache). <strong>This is required if you'd like messages to be retained across restarts</strong>.</li> <li><code>cache-duration</code>: defines the duration for which messages are stored in the cache (default is <code>12h</code>). </li> </ul> <p>You can also entirely disable the cache by setting <code>cache-duration</code> to <code>0</code>. When the cache is disabled, messages are only passed on to the connected subscribers, but never stored on disk or even kept in memory longer than is needed to forward the message to the subscribers.</p> <p>Subscribers can retrieve cached messaging using the <a href=../subscribe/api/#poll-for-messages><code>poll=1</code> parameter</a>, as well as the <a href=../subscribe/api/#fetch-cached-messages><code>since=</code> parameter</a>.</p> <h2 id=attachments>Attachments<a class=headerlink href=#attachments title="Permanent link">&para;</a></h2> <p>If desired, you may allow users to upload and <a href=../publish/#attachments>attach files to notifications</a>. To enable this feature, you have to simply configure an attachment cache directory and a base URL (<code>attachment-cache-dir</code>, <code>base-url</code>). Once these options are set and the directory is writable by the server user, you can upload attachments via PUT.</p> <p>By default, attachments are stored in the disk-cache <strong>for only 3 hours</strong>. The main reason for this is to avoid legal issues and such when hosting user controlled content. Typically, this is more than enough time for the user (or the auto download feature) to download the file. The following config options are relevant to attachments:</p> <ul> <li><code>base-url</code> is the root URL for the ntfy server; this is needed for the generated attachment URLs</li> <li><code>attachment-cache-dir</code> is the cache directory for attached files</li> <li><code>attachment-total-size-limit</code> is the size limit of the on-disk attachment cache (default: 5G)</li> <li><code>attachment-file-size-limit</code> is the per-file attachment size limit (e.g. 300k, 2M, 100M, default: 15M)</li> <li><code>attachment-expiry-duration</code> is the duration after which uploaded attachments will be deleted (e.g. 3h, 20h, default: 3h)</li> </ul> <p>Here's an example config using mostly the defaults (except for the cache directory, which is empty by default): </p> <div class="tabbed-set tabbed-alternate" data-tabs=3:2><input checked=checked id=__tabbed_3_1 name=__tabbed_3 type=radio><input id=__tabbed_3_2 name=__tabbed_3 type=radio><div class=tabbed-labels><label for=__tabbed_3_1>/etc/ntfy/server.yml (minimal)</label><label for=__tabbed_3_2>/etc/ntfy/server.yml (all options)</label></div> <div class=tabbed-content> <div class=tabbed-block> <div class=highlight><pre><span></span><code><span class=nt>base-url</span><span class=p>:</span><span class=w> </span><span class=s>&quot;https://ntfy.sh&quot;</span>
<span class=nt>attachment-cache-dir</span><span class=p>:</span><span class=w> </span><span class=s>&quot;/var/cache/ntfy/attachments&quot;</span>
</code></pre></div> </div> <div class=tabbed-block> <div class=highlight><pre><span></span><code><span class=nt>base-url</span><span class=p>:</span><span class=w> </span><span class=s>&quot;https://ntfy.sh&quot;</span>
<span class=nt>attachment-cache-dir</span><span class=p>:</span><span class=w> </span><span class=s>&quot;/var/cache/ntfy/attachments&quot;</span>
<span class=nt>attachment-total-size-limit</span><span class=p>:</span><span class=w> </span><span class=s>&quot;5G&quot;</span>
<span class=nt>attachment-file-size-limit</span><span class=p>:</span><span class=w> </span><span class=s>&quot;15M&quot;</span>
<span class=nt>attachment-expiry-duration</span><span class=p>:</span><span class=w> </span><span class=s>&quot;3h&quot;</span>
<span class=nt>visitor-attachment-total-size-limit</span><span class=p>:</span><span class=w> </span><span class=s>&quot;100M&quot;</span>
<span class=nt>visitor-attachment-daily-bandwidth-limit</span><span class=p>:</span><span class=w> </span><span class=s>&quot;500M&quot;</span>
</code></pre></div> </div> </div> </div> <p>Please also refer to the <a href=#rate-limiting>rate limiting</a> settings below, specifically <code>visitor-attachment-total-size-limit</code> and <code>visitor-attachment-daily-bandwidth-limit</code>. Setting these conservatively is necessary to avoid abuse.</p> <h2 id=access-control>Access control<a class=headerlink href=#access-control title="Permanent link">&para;</a></h2> <p>By default, the ntfy server is open for everyone, meaning <strong>everyone can read and write to any topic</strong> (this is how ntfy.sh is configured). To restrict access to your own server, you can optionally configure authentication and authorization. </p> <p>ntfy's auth is implemented with a simple <a href=https://www.sqlite.org/ >SQLite</a>-based backend. It implements two roles (<code>user</code> and <code>admin</code>) and per-topic <code>read</code> and <code>write</code> permissions using an <a href=https://en.wikipedia.org/wiki/Access-control_list>access control list (ACL)</a>. Access control entries can be applied to users as well as the special everyone user (<code>*</code>), which represents anonymous API access. </p> <p>To set up auth, <strong>configure the following options</strong>:</p> <ul> <li><code>auth-file</code> is the user/access database; it is created automatically if it doesn't already exist; suggested location <code>/var/lib/ntfy/user.db</code> (easiest if deb/rpm package is used)</li> <li><code>auth-default-access</code> defines the default/fallback access if no access control entry is found; it can be set to <code>read-write</code> (default), <code>read-only</code>, <code>write-only</code> or <code>deny-all</code>. <strong>If you are setting up a private instance, you'll want to set this to <code>deny-all</code></strong> (see <a href=#example-private-instance>private instance example</a>).</li> </ul> <p>Once configured, you can use </p> <ul> <li>the <code>ntfy user</code> command and the <code>auth-users</code> config option to <a href=#users-and-roles>add or modify users</a></li> <li>the <code>ntfy access</code> command and the <code>auth-access</code> option to <a href=#access-control-list-acl>modify the access control list</a> and topic patterns, and</li> <li>the <code>ntfy token</code> command and the <code>auth-tokens</code> config option to <a href=#access-tokens>manage access tokens</a> for users.</li> </ul> <p>These commands <strong>directly edit the auth database</strong> (as defined in <code>auth-file</code>), so they only work on the server, and only if the user accessing them has the right permissions.</p> <h3 id=users-and-roles>Users and roles<a class=headerlink href=#users-and-roles title="Permanent link">&para;</a></h3> <p>Users can be added to the ntfy user database in two different ways</p> <ul> <li><a href=#users-via-the-cli>Using the CLI</a>: Using the <code>ntfy user</code> command, you can manually add/update/remove users.</li> <li><a href=#users-via-the-config>In the config</a>: You can provision users in the <code>server.yml</code> file via <code>auth-users</code> key.</li> </ul> <h4 id=users-via-the-cli>Users via the CLI<a class=headerlink href=#users-via-the-cli title="Permanent link">&para;</a></h4> <p>The <code>ntfy user</code> command allows you to add/remove/change users in the ntfy user database, as well as change passwords or roles (<code>user</code> or <code>admin</code>). In practice, you'll often just create one admin user with <code>ntfy user add --role=admin ...</code> and be done with all this (see <a href=#example-private-instance>example below</a>).</p> <p><strong>Roles:</strong></p> <ul> <li>Role <code>user</code> (default): Users with this role have no special permissions. Manage access using <code>ntfy access</code> (see <a href=#access-control-list-acl>below</a>).</li> <li>Role <code>admin</code>: Users with this role can read/write to all topics. Granular access control is not necessary.</li> </ul> <p><strong>Example commands</strong> (type <code>ntfy user --help</code> or <code>ntfy user COMMAND --help</code> for more details):</p> <div class=highlight><pre><span></span><code>ntfy user list                     # Shows list of users (alias: &#39;ntfy access&#39;)
ntfy user add phil                 # Add regular user phil  
ntfy user add --role=admin phil    # Add admin user phil
ntfy user del phil                 # Delete user phil
ntfy user change-pass phil         # Change password for user phil
ntfy user change-role phil admin   # Make user phil an admin
ntfy user change-tier phil pro     # Change phil&#39;s tier to &quot;pro&quot;
ntfy user hash                     # Generate password hash, use with auth-users config option
</code></pre></div> <h4 id=users-via-the-config>Users via the config<a class=headerlink href=#users-via-the-config title="Permanent link">&para;</a></h4> <p>As an alternative to manually creating users via the <code>ntfy user</code> CLI command, you can provision users declaratively in the <code>server.yml</code> file by adding them to the <code>auth-users</code> array. This is useful for general admins, or if you'd like to deploy your ntfy server via Docker/Ansible without manually editing the database.</p> <p>The <code>auth-users</code> option is a list of users that are automatically created/updated when the server starts. Users previously defined in the config but later removed will be deleted. Each entry is defined in the format <code>&lt;username&gt;:&lt;password-hash&gt;:&lt;role&gt;</code>.</p> <p>Here's an example with two users: <code>phil</code> is an admin, <code>ben</code> is a regular user.</p> <div class="tabbed-set tabbed-alternate" data-tabs=4:2><input checked=checked id=__tabbed_4_1 name=__tabbed_4 type=radio><input id=__tabbed_4_2 name=__tabbed_4 type=radio><div class=tabbed-labels><label for=__tabbed_4_1>Declarative users in /etc/ntfy/server.yml</label><label for=__tabbed_4_2>Declarative users via env variables</label></div> <div class=tabbed-content> <div class=tabbed-block> <div class=highlight><pre><span></span><code><span class=nt>auth-file</span><span class=p>:</span><span class=w> </span><span class=s>&quot;/var/lib/ntfy/user.db&quot;</span>
<span class=nt>auth-users</span><span class=p>:</span>
<span class=w>  </span><span class="p p-Indicator">-</span><span class=w> </span><span class=s>&quot;phil:$2a$10$YLiO8U21sX1uhZamTLJXHuxgVC0Z/GKISibrKCLohPgtG7yIxSk4C:admin&quot;</span>
<span class=w>  </span><span class="p p-Indicator">-</span><span class=w> </span><span class=s>&quot;ben:$2a$10$NKbrNb7HPMjtQXWJ0f1pouw03LDLT/WzlO9VAv44x84bRCkh19h6m:user&quot;</span>
</code></pre></div> </div> <div class=tabbed-block> <div class=highlight><pre><span></span><code># Comma-separated list, use single quotes to avoid issues with the bcrypt hash 
NTFY_AUTH_FILE=&#39;/var/lib/ntfy/user.db&#39;
NTFY_AUTH_USERS=&#39;phil:$2a$10$YLiO8U21sX1uhZamTLJXHuxgVC0Z/GKISibrKCLohPgtG7yIxSk4C:admin,ben:$2a$10$NKbrNb7HPMjtQXWJ0f1pouw03LDLT/WzlO9VAv44x84bRCkh19h6m:user&#39;
</code></pre></div> </div> </div> </div> <p>The password hash can be created using <code>ntfy user hash</code> or an <a href=https://bcrypt-generator.com/ >online bcrypt generator</a> (though note that you're putting your password in an untrusted website).</p> <div class="admonition important"> <p class=admonition-title>Important</p> <p>Users added declaratively via the config file are marked in the database as "provisioned users". Removing users from the config file will <strong>delete them from the database</strong> the next time ntfy is restarted.</p> <p>Also, users that were originally manually created will be "upgraded" to be provisioned users if they are added to the config. Adding a user manually, then adding it to the config, and then removing it from the config will hence lead to the <strong>deletion of that user</strong>.</p> </div> <h3 id=access-control-list-acl>Access control list (ACL)<a class=headerlink href=#access-control-list-acl title="Permanent link">&para;</a></h3> <p>The access control list (ACL) <strong>manages access to topics for non-admin users, and for anonymous access (<code>everyone</code>/<code>*</code>)</strong>. Each entry represents the access permissions for a user to a specific topic or topic pattern. Entries can be created in two different ways:</p> <ul> <li><a href=#acl-entries-via-the-cli>Using the CLI</a>: Using the <code>ntfy access</code> command, you can manually edit the access control list.</li> <li><a href=#acl-entries-via-the-config>In the config</a>: You can provision ACL entries in the <code>server.yml</code> file via <code>auth-access</code> key.</li> </ul> <h4 id=acl-entries-via-the-cli>ACL entries via the CLI<a class=headerlink href=#acl-entries-via-the-cli title="Permanent link">&para;</a></h4> <p>The ACL can be displayed or modified with the <code>ntfy access</code> command:</p> <div class=highlight><pre><span></span><code>ntfy access                            # Shows access control list (alias: &#39;ntfy user list&#39;)
ntfy access USERNAME                   # Shows access control entries for USERNAME
ntfy access USERNAME TOPIC PERMISSION  # Allow/deny access for USERNAME to TOPIC
</code></pre></div> <p>A <code>USERNAME</code> is an existing user, as created with <code>ntfy user add</code> (see <a href=#users-and-roles>users and roles</a>), or the anonymous user <code>everyone</code> or <code>*</code>, which represents clients that access the API without username/password.</p> <p>A <code>TOPIC</code> is either a specific topic name (e.g. <code>mytopic</code>, or <code>phil_alerts</code>), or a wildcard pattern that matches any number of topics (e.g. <code>alerts_*</code> or <code>ben-*</code>). Only the wildcard character <code>*</code> is supported. It stands for zero to any number of characters.</p> <p>A <code>PERMISSION</code> is any of the following supported permissions:</p> <ul> <li><code>read-write</code> (alias: <code>rw</code>): Allows <a href=../publish/ >publishing messages</a> to the given topic, as well as <a href=../subscribe/api/ >subscribing</a> and reading messages</li> <li><code>read-only</code> (aliases: <code>read</code>, <code>ro</code>): Allows only subscribing and reading messages, but not publishing to the topic</li> <li><code>write-only</code> (aliases: <code>write</code>, <code>wo</code>): Allows only publishing to the topic, but not subscribing to it</li> <li><code>deny</code> (alias: <code>none</code>): Allows neither publishing nor subscribing to a topic </li> </ul> <p><strong>Example commands</strong> (type <code>ntfy access --help</code> for more details): <div class=highlight><pre><span></span><code>ntfy access                        # Shows entire access control list
ntfy access phil                   # Shows access for user phil
ntfy access phil mytopic rw        # Allow read-write access to mytopic for user phil
ntfy access everyone mytopic rw    # Allow anonymous read-write access to mytopic
ntfy access everyone &quot;up*&quot; write   # Allow anonymous write-only access to topics &quot;up...&quot;
ntfy access --reset                # Reset entire access control list
ntfy access --reset phil           # Reset all access for user phil
ntfy access --reset phil mytopic   # Reset access for user phil and topic mytopic
</code></pre></div></p> <p><strong>Example ACL:</strong> <div class=highlight><pre><span></span><code>$ ntfy access
user phil (admin)
- read-write access to all topics (admin role)
user ben (user)
- read-write access to topic garagedoor
- read-write access to topic alerts*
- read-only access to topic furnace
user * (anonymous)
- read-only access to topic announcements
- read-only access to topic server-stats
- no access to any (other) topics (server config)
</code></pre></div></p> <p>In this example, <code>phil</code> has the role <code>admin</code>, so he has read-write access to all topics (no ACL entries are necessary). User <code>ben</code> has three topic-specific entries. He can read, but not write to topic <code>furnace</code>, and has read-write access to topic <code>garagedoor</code> and all topics starting with the word <code>alerts</code> (wildcards). Clients that are not authenticated (called <code>*</code>/<code>everyone</code>) only have read access to the <code>announcements</code> and <code>server-stats</code> topics.</p> <h4 id=acl-entries-via-the-config>ACL entries via the config<a class=headerlink href=#acl-entries-via-the-config title="Permanent link">&para;</a></h4> <p>As an alternative to manually creating ACL entries via the <code>ntfy access</code> CLI command, you can provision access control entries declaratively in the <code>server.yml</code> file by adding them to the <code>auth-access</code> array, similar to the <code>auth-users</code> option (see <a href=#users-via-the-config>users via the config</a>.</p> <p>The <code>auth-access</code> option is a list of access control entries that are automatically created/updated when the server starts. When entries are removed, they are deleted from the database. Each entry is defined in the format <code>&lt;username&gt;:&lt;topic-pattern&gt;:&lt;access&gt;</code>.</p> <p>The <code>&lt;username&gt;</code> can be any existing, provisioned user as defined in the <code>auth-users</code> section (see <a href=#users-via-the-config>users via the config</a>), or <code>everyone</code>/<code>*</code> for anonymous access. The <code>&lt;topic-pattern&gt;</code> can be a specific topic name or a pattern with wildcards (<code>*</code>). The <code>&lt;access&gt;</code> can be one of the following:</p> <ul> <li><code>read-write</code> or <code>rw</code>: Allows both publishing to and subscribing to the topic</li> <li><code>read-only</code>, <code>read</code>, or <code>ro</code>: Allows only subscribing to the topic</li> <li><code>write-only</code>, <code>write</code>, or <code>wo</code>: Allows only publishing to the topic</li> <li><code>deny-all</code>, <code>deny</code>, or <code>none</code>: Denies all access to the topic</li> </ul> <p>Here's an example with several ACL entries:</p> <div class="tabbed-set tabbed-alternate" data-tabs=5:2><input checked=checked id=__tabbed_5_1 name=__tabbed_5 type=radio><input id=__tabbed_5_2 name=__tabbed_5 type=radio><div class=tabbed-labels><label for=__tabbed_5_1>Declarative ACL entries in /etc/ntfy/server.yml</label><label for=__tabbed_5_2>Declarative ACL entries via env variables</label></div> <div class=tabbed-content> <div class=tabbed-block> <div class=highlight><pre><span></span><code><span class=nt>auth-file</span><span class=p>:</span><span class=w> </span><span class=s>&quot;/var/lib/ntfy/user.db&quot;</span>
<span class=nt>auth-users</span><span class=p>:</span>
<span class=w>  </span><span class="p p-Indicator">-</span><span class=w> </span><span class=s>&quot;phil:$2a$10$YLiO8U21sX1uhZamTLJXHuxgVC0Z/GKISibrKCLohPgtG7yIxSk4C:user&quot;</span>
<span class=w>  </span><span class="p p-Indicator">-</span><span class=w> </span><span class=s>&quot;ben:$2a$10$NKbrNb7HPMjtQXWJ0f1pouw03LDLT/WzlO9VAv44x84bRCkh19h6m:user&quot;</span>
<span class=nt>auth-access</span><span class=p>:</span>
<span class=w>  </span><span class="p p-Indicator">-</span><span class=w> </span><span class=s>&quot;phil:mytopic:rw&quot;</span>
<span class=w>  </span><span class="p p-Indicator">-</span><span class=w> </span><span class=s>&quot;ben:alerts-*:rw&quot;</span>
<span class=w>  </span><span class="p p-Indicator">-</span><span class=w> </span><span class=s>&quot;ben:system-logs:ro&quot;</span>
<span class=w>  </span><span class="p p-Indicator">-</span><span class=w> </span><span class=s>&quot;*:announcements:ro&quot;</span><span class=w> </span><span class=c1># or: &quot;everyone:announcements,ro&quot;</span>
</code></pre></div> </div> <div class=tabbed-block> <div class=highlight><pre><span></span><code># Comma-separated list
NTFY_AUTH_FILE=&#39;/var/lib/ntfy/user.db&#39;
NTFY_AUTH_USERS=&#39;phil:$2a$10$YLiO8U21sX1uhZamTLJXHuxgVC0Z/GKISibrKCLohPgtG7yIxSk4C:user,ben:$2a$10$NKbrNb7HPMjtQXWJ0f1pouw03LDLT/WzlO9VAv44x84bRCkh19h6m:user&#39;
NTFY_AUTH_ACCESS=&#39;phil:mytopic:rw,ben:alerts-*:rw,ben:system-logs:ro,*:announcements:ro&#39;
</code></pre></div> </div> </div> </div> <p>In this example, the <code>auth-users</code> section defines two users, <code>phil</code> and <code>ben</code>. The <code>auth-access</code> section defines access control entries for these users. <code>phil</code> has read-write access to the topic <code>mytopic</code>, while <code>ben</code> has read-write access to all topics starting with <code>alerts-</code> and read-only access to the topic <code>system-logs</code>. The last entry allows anonymous users (i.e. clients that do not authenticate) to read the <code>announcements</code> topic.</p> <h3 id=access-tokens>Access tokens<a class=headerlink href=#access-tokens title="Permanent link">&para;</a></h3> <p>In addition to username/password auth, ntfy also provides authentication via access tokens. Access tokens are useful to avoid having to configure your password across multiple publishing/subscribing applications. For instance, you may want to use a dedicated token to publish from your backup host, and one from your home automation system.</p> <div class="admonition info"> <p class=admonition-title>Info</p> <p>As of today, access tokens grant users <strong>full access to the user account</strong>. Aside from changing the password, and deleting the account, every action can be performed with a token. Granular access tokens are on the roadmap, but not yet implemented.</p> </div> <p>You can create access tokens in two different ways:</p> <ul> <li><a href=#tokens-via-the-cli>Using the CLI</a>: Using the <code>ntfy token</code> command, you can manually add/update/remove tokens.</li> <li><a href=#tokens-via-the-config>In the config</a>: You can provision access tokens in the <code>server.yml</code> file via <code>auth-tokens</code> key.</li> </ul> <h4 id=tokens-via-the-cli>Tokens via the CLI<a class=headerlink href=#tokens-via-the-cli title="Permanent link">&para;</a></h4> <p>The <code>ntfy token</code> command can be used to manage access tokens for users. Tokens can have labels, and they can expire automatically (or never expire). Each user can have up to 60 tokens (hardcoded). </p> <p><strong>Example commands</strong> (type <code>ntfy token --help</code> or <code>ntfy token COMMAND --help</code> for more details): <div class=highlight><pre><span></span><code>ntfy token list                      # Shows list of tokens for all users
ntfy token list phil                 # Shows list of tokens for user phil
ntfy token add phil                  # Create token for user phil which never expires
ntfy token add --expires=2d phil     # Create token for user phil which expires in 2 days
ntfy token remove phil tk_th2sxr...  # Delete token
ntfy token generate                  # Generate random token, can be used in auth-tokens config option
</code></pre></div></p> <p><strong>Creating an access token:</strong> <div class=highlight><pre><span></span><code>$ ntfy token add --expires=30d --label=&quot;backups&quot; phil
$ ntfy token list
user phil
- tk_7eevizlsiwf9yi4uxsrs83r4352o0 (backups), expires 15 Mar 23 14:33 EDT, accessed from 0.0.0.0 at 13 Feb 23 13:33 EST
</code></pre></div></p> <p>Once an access token is created, you can <strong>use it to authenticate against the ntfy server, e.g. when you publish or subscribe to topics</strong>. To learn how, check out <a href=../publish/#access-tokens>authenticate via access tokens</a>.</p> <h4 id=tokens-via-the-config>Tokens via the config<a class=headerlink href=#tokens-via-the-config title="Permanent link">&para;</a></h4> <p>Access tokens can be pre-provisioned in the <code>server.yml</code> configuration file using the <code>auth-tokens</code> config option. This is useful for automated setups, Docker environments, or when you want to define tokens declaratively.</p> <p>The <code>auth-tokens</code> option is a list of access tokens that are automatically created/updated when the server starts. When entries are removed, they are deleted from the database. Each entry is defined in the format <code>&lt;username&gt;:&lt;token&gt;[:&lt;label&gt;]</code>.</p> <p>The <code>&lt;username&gt;</code> must be an existing, provisioned user, as defined in the <code>auth-users</code> section (see <a href=#users-via-the-config>users via the config</a>). The <code>&lt;token&gt;</code> is a valid access token, which must start with <code>tk_</code> and be 32 characters long (including the prefix). You can generate random tokens using the <code>ntfy token generate</code> command. The optional <code>&lt;label&gt;</code> is a human-readable label for the token, which can be used to identify it later.</p> <p>Once configured, these tokens can be used to authenticate API requests just like tokens created via the CLI. For usage examples, see <a href=../publish/#access-tokens>authenticate via access tokens</a>.</p> <p>Here's an example:</p> <div class="tabbed-set tabbed-alternate" data-tabs=6:2><input checked=checked id=__tabbed_6_1 name=__tabbed_6 type=radio><input id=__tabbed_6_2 name=__tabbed_6 type=radio><div class=tabbed-labels><label for=__tabbed_6_1>Declarative tokens in /etc/ntfy/server.yml</label><label for=__tabbed_6_2>Declarative tokens via env variables</label></div> <div class=tabbed-content> <div class=tabbed-block> <div class=highlight><pre><span></span><code><span class=nt>auth-file</span><span class=p>:</span><span class=w> </span><span class=s>&quot;/var/lib/ntfy/user.db&quot;</span>
<span class=nt>auth-users</span><span class=p>:</span>
<span class=w>  </span><span class="p p-Indicator">-</span><span class=w> </span><span class=s>&quot;phil:$2a$10$YLiO8U21sX1uhZamTLJXHuxgVC0Z/GKISibrKCLohPgtG7yIxSk4C:admin&quot;</span>
<span class=w>  </span><span class="p p-Indicator">-</span><span class=w> </span><span class=s>&quot;backup-service:$2a$10$NKbrNb7HPMjtQXWJ0f1pouw03LDLT/WzlO9VAv44x84bRCkh19h6m:user&quot;</span>
<span class=nt>auth-tokens</span><span class=p>:</span>
<span class=w>  </span><span class="p p-Indicator">-</span><span class=w> </span><span class=s>&quot;phil:tk_3gd7d2yftt4b8ixyfe9mnmro88o76&quot;</span>
<span class=w>  </span><span class="p p-Indicator">-</span><span class=w> </span><span class=s>&quot;backup-service:tk_f099we8uzj7xi5qshzajwp6jffvkz:Backup</span><span class=nv> </span><span class=s>script&quot;</span>
</code></pre></div> </div> <div class=tabbed-block> <div class=highlight><pre><span></span><code># Comma-separated list
NTFY_AUTH_FILE=&#39;/var/lib/ntfy/user.db&#39;
NTFY_AUTH_USERS=&#39;phil:$2a$10$YLiO8U21sX1uhZamTLJXHuxgVC0Z/GKISibrKCLohPgtG7yIxSk4C:admin,ben:$2a$10$NKbrNb7HPMjtQXWJ0f1pouw03LDLT/WzlO9VAv44x84bRCkh19h6m:user&#39;
NTFY_AUTH_TOKENS=&#39;phil:tk_3gd7d2yftt4b8ixyfe9mnmro88o76,backup-service:tk_f099we8uzj7xi5qshzajwp6jffvkz:Backup script&#39;
</code></pre></div> </div> </div> </div> <p>In this example, the <code>auth-users</code> section defines two users, <code>phil</code> and <code>backup-service</code>. The <code>auth-tokens</code> section defines access tokens for these users. <code>phil</code> has a token <code>tk_3gd7d2yftt4b8ixyfe9mnmro88o76</code>, while <code>backup-service</code> has a token <code>tk_f099we8uzj7xi5qshzajwp6jffvkz</code> with the label "Backup script".</p> <h3 id=example-private-instance>Example: Private instance<a class=headerlink href=#example-private-instance title="Permanent link">&para;</a></h3> <p>The easiest way to configure a private instance is to set <code>auth-default-access</code> to <code>deny-all</code> in the <code>server.yml</code>, and to configure users in the <code>auth-users</code> section (see <a href=#users-via-the-config>users via the config</a>), access control entries in the <code>auth-access</code> section (see <a href=#acl-entries-via-the-config>ACL entries via the config</a>), and access tokens in the <code>auth-tokens</code> section (see <a href=#tokens-via-the-config>access tokens via the config</a>).</p> <p>Here's an example that defines a single admin user <code>phil</code> with the password <code>mypass</code>, and a regular user <code>backup-script</code> with the password <code>backup-script</code>. The admin user has full access to all topics, while regular user can only access the <code>backups</code> topic with read-write permissions. The <code>auth-default-access</code> is set to <code>deny-all</code>, which means that all other users and anonymous access are denied by default.</p> <div class="tabbed-set tabbed-alternate" data-tabs=7:2><input checked=checked id=__tabbed_7_1 name=__tabbed_7 type=radio><input id=__tabbed_7_2 name=__tabbed_7 type=radio><div class=tabbed-labels><label for=__tabbed_7_1>Config via /etc/ntfy/server.yml</label><label for=__tabbed_7_2>Config via env variables</label></div> <div class=tabbed-content> <div class=tabbed-block> <div class=highlight><pre><span></span><code><span class=nt>auth-file</span><span class=p>:</span><span class=w> </span><span class=s>&quot;/var/lib/ntfy/user.db&quot;</span>
<span class=nt>auth-default-access</span><span class=p>:</span><span class=w> </span><span class=s>&quot;deny-all&quot;</span>
<span class=nt>auth-users</span><span class=p>:</span>
<span class=w>  </span><span class="p p-Indicator">-</span><span class=w> </span><span class=s>&quot;phil:$2a$10$YLiO8U21sX1uhZamTLJXHuxgVC0Z/GKISibrKCLohPgtG7yIxSk4C:admin&quot;</span>
<span class=w>  </span><span class="p p-Indicator">-</span><span class=w> </span><span class=s>&quot;backup-script:$2a$10$/ehiQt.w7lhTmHXq.RNsOOkIwiPPeWFIzWYO3DRxNixnWKLX8.uj.:user&quot;</span>
<span class=nt>auth-access</span><span class=p>:</span>
<span class=w>  </span><span class="p p-Indicator">-</span><span class=w> </span><span class=s>&quot;backup-service:backups:rw&quot;</span>
<span class=nt>auth-tokens</span><span class=p>:</span>
<span class=w>  </span><span class="p p-Indicator">-</span><span class=w> </span><span class=s>&quot;phil:tk_3gd7d2yftt4b8ixyfe9mnmro88o76:My</span><span class=nv> </span><span class=s>personal</span><span class=nv> </span><span class=s>token&quot;</span>
</code></pre></div> </div> <div class=tabbed-block> <div class=highlight><pre><span></span><code><span class="l l-Scalar l-Scalar-Plain">NTFY_AUTH_FILE=&#39;/var/lib/ntfy/user.db&#39;</span>
<span class="l l-Scalar l-Scalar-Plain">NTFY_AUTH_DEFAULT_ACCESS=&#39;deny-all&#39;</span>
<span class="l l-Scalar l-Scalar-Plain">NTFY_AUTH_USERS=&#39;phil:$2a$10$YLiO8U21sX1uhZamTLJXHuxgVC0Z/GKISibrKCLohPgtG7yIxSk4C:admin,backup-script:$2a$10$/ehiQt.w7lhTmHXq.RNsOOkIwiPPeWFIzWYO3DRxNixnWKLX8.uj.:user&#39;</span>
<span class="l l-Scalar l-Scalar-Plain">NTFY_AUTH_ACCESS=&#39;backup-service:backups:rw&#39;</span>
<span class="l l-Scalar l-Scalar-Plain">NTFY_AUTH_TOKENS=&#39;phil:tk_3gd7d2yftt4b8ixyfe9mnmro88o76:My personal token&#39;</span>
</code></pre></div> </div> </div> </div> <p>Once you've done that, you can publish and subscribe using <a href=https://en.wikipedia.org/wiki/Basic_access_authentication>Basic Auth</a> with the given username/password. Be sure to use HTTPS to avoid eavesdropping and exposing your password. </p> <p>Here's a simple example (using the credentials of the <code>phil</code> user):</p> <div class="tabbed-set tabbed-alternate" data-tabs=8:7><input checked=checked id=__tabbed_8_1 name=__tabbed_8 type=radio><input id=__tabbed_8_2 name=__tabbed_8 type=radio><input id=__tabbed_8_3 name=__tabbed_8 type=radio><input id=__tabbed_8_4 name=__tabbed_8 type=radio><input id=__tabbed_8_5 name=__tabbed_8 type=radio><input id=__tabbed_8_6 name=__tabbed_8 type=radio><input id=__tabbed_8_7 name=__tabbed_8 type=radio><div class=tabbed-labels><label for=__tabbed_8_1>Command line (curl)</label><label for=__tabbed_8_2>ntfy CLI</label><label for=__tabbed_8_3>HTTP</label><label for=__tabbed_8_4>JavaScript</label><label for=__tabbed_8_5>Go</label><label for=__tabbed_8_6>Python</label><label for=__tabbed_8_7>PHP</label></div> <div class=tabbed-content> <div class=tabbed-block> <div class=highlight><pre><span></span><code>curl \
    -u phil:mypass \
    -d &quot;Look ma, with auth&quot; \
    https://ntfy.example.com/mysecrets
</code></pre></div> </div> <div class=tabbed-block> <div class=highlight><pre><span></span><code>ntfy publish \
    -u phil:mypass \
    ntfy.example.com/mysecrets \
    &quot;Look ma, with auth&quot;
</code></pre></div> </div> <div class=tabbed-block> <div class=highlight><pre><span></span><code><span class=nf>POST</span> <span class=nn>/mysecrets</span> <span class=kr>HTTP</span><span class=o>/</span><span class=m>1.1</span>
<span class=na>Host</span><span class=o>:</span> <span class=l>ntfy.example.com</span>
<span class=na>Authorization</span><span class=o>:</span> <span class=l>Basic cGhpbDpteXBhc3M=</span>

Look ma, with auth
</code></pre></div> </div> <div class=tabbed-block> <div class=highlight><pre><span></span><code><span class=nx>fetch</span><span class=p>(</span><span class=s1>&#39;https://ntfy.example.com/mysecrets&#39;</span><span class=p>,</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=nx>method</span><span class=o>:</span><span class=w> </span><span class=s1>&#39;POST&#39;</span><span class=p>,</span><span class=w> </span><span class=c1>// PUT works too</span>
<span class=w>    </span><span class=nx>body</span><span class=o>:</span><span class=w> </span><span class=s1>&#39;Look ma, with auth&#39;</span><span class=p>,</span>
<span class=w>    </span><span class=nx>headers</span><span class=o>:</span><span class=w> </span><span class=p>{</span>
<span class=w>        </span><span class=s1>&#39;Authorization&#39;</span><span class=o>:</span><span class=w> </span><span class=s1>&#39;Basic cGhpbDpteXBhc3M=&#39;</span>
<span class=w>    </span><span class=p>}</span>
<span class=p>})</span>
</code></pre></div> </div> <div class=tabbed-block> <div class=highlight><pre><span></span><code><span class=nx>req</span><span class=p>,</span><span class=w> </span><span class=nx>_</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>http</span><span class=p>.</span><span class=nx>NewRequest</span><span class=p>(</span><span class=s>&quot;POST&quot;</span><span class=p>,</span><span class=w> </span><span class=s>&quot;https://ntfy.example.com/mysecrets&quot;</span><span class=p>,</span>
<span class=w>    </span><span class=nx>strings</span><span class=p>.</span><span class=nx>NewReader</span><span class=p>(</span><span class=s>&quot;Look ma, with auth&quot;</span><span class=p>))</span>
<span class=nx>req</span><span class=p>.</span><span class=nx>Header</span><span class=p>.</span><span class=nx>Set</span><span class=p>(</span><span class=s>&quot;Authorization&quot;</span><span class=p>,</span><span class=w> </span><span class=s>&quot;Basic cGhpbDpteXBhc3M=&quot;</span><span class=p>)</span>
<span class=nx>http</span><span class=p>.</span><span class=nx>DefaultClient</span><span class=p>.</span><span class=nx>Do</span><span class=p>(</span><span class=nx>req</span><span class=p>)</span>
</code></pre></div> </div> <div class=tabbed-block> <div class=highlight><pre><span></span><code><span class=n>requests</span><span class=o>.</span><span class=n>post</span><span class=p>(</span><span class=s2>&quot;https://ntfy.example.com/mysecrets&quot;</span><span class=p>,</span>
    <span class=n>data</span><span class=o>=</span><span class=s2>&quot;Look ma, with auth&quot;</span><span class=p>,</span>
    <span class=n>headers</span><span class=o>=</span><span class=p>{</span>
        <span class=s2>&quot;Authorization&quot;</span><span class=p>:</span> <span class=s2>&quot;Basic cGhpbDpteXBhc3M=&quot;</span>
    <span class=p>})</span>
</code></pre></div> </div> <div class=tabbed-block> <div class=highlight><pre><span></span><code><span class=nb>file_get_contents</span><span class=p>(</span><span class=s1>&#39;https://ntfy.example.com/mysecrets&#39;</span><span class=p>,</span> <span class=k>false</span><span class=p>,</span> <span class=nb>stream_context_create</span><span class=p>([</span>
    <span class=s1>&#39;http&#39;</span> <span class=o>=&gt;</span> <span class=p>[</span>
        <span class=s1>&#39;method&#39;</span> <span class=o>=&gt;</span> <span class=s1>&#39;POST&#39;</span><span class=p>,</span> <span class=c1>// PUT also works</span>
        <span class=s1>&#39;header&#39;</span> <span class=o>=&gt;</span> 
            <span class=s1>&#39;Content-Type: text/plain\r\n&#39;</span> <span class=o>.</span>
            <span class=s1>&#39;Authorization: Basic cGhpbDpteXBhc3M=&#39;</span><span class=p>,</span>
        <span class=s1>&#39;content&#39;</span> <span class=o>=&gt;</span> <span class=s1>&#39;Look ma, with auth&#39;</span>
    <span class=p>]</span>
<span class=p>]));</span>
</code></pre></div> </div> </div> </div> <h3 id=example-unifiedpush>Example: UnifiedPush<a class=headerlink href=#example-unifiedpush title="Permanent link">&para;</a></h3> <p><a href=https://unifiedpush.org>UnifiedPush</a> requires that the <a href=https://unifiedpush.org/developers/spec/definitions/#application-server>application server</a> (e.g. Synapse, Fediverse Server, â€¦) has anonymous write access to the <a href=https://unifiedpush.org/developers/spec/definitions/#endpoint>topic</a> used for push messages. The topic names used by UnifiedPush all start with the <code>up*</code> prefix. Please refer to the <strong><a href=https://unifiedpush.org/users/distributors/ntfy/#limit-access-to-some-users-acl>UnifiedPush documentation</a></strong> for more details.</p> <p>To enable support for UnifiedPush for private servers (i.e. <code>auth-default-access: "deny-all"</code>), you should either allow anonymous write access for the entire prefix or explicitly per topic:</p> <div class="tabbed-set tabbed-alternate" data-tabs=9:2><input checked=checked id=__tabbed_9_1 name=__tabbed_9 type=radio><input id=__tabbed_9_2 name=__tabbed_9 type=radio><div class=tabbed-labels><label for=__tabbed_9_1>Prefix</label><label for=__tabbed_9_2>Explicitly</label></div> <div class=tabbed-content> <div class=tabbed-block> <div class=highlight><pre><span></span><code>$ ntfy access &#39;*&#39; &#39;up*&#39; write-only
</code></pre></div> </div> <div class=tabbed-block> <div class=highlight><pre><span></span><code>$ ntfy access &#39;*&#39; upYzMtZGZiYTY5 write-only
</code></pre></div> </div> </div> </div> <h2 id=e-mail-notifications>E-mail notifications<a class=headerlink href=#e-mail-notifications title="Permanent link">&para;</a></h2> <p>To allow forwarding messages via e-mail, you can configure an <strong>SMTP server for outgoing messages</strong>. Once configured, you can set the <code>X-Email</code> header to <a href=../publish/#e-mail-notifications>send messages via e-mail</a> (e.g. <code>curl -d "hi there" -H "X-Email: phil@example.com" ntfy.sh/mytopic</code>).</p> <p>As of today, only SMTP servers with PLAIN auth and STARTLS are supported. To enable e-mail sending, you must set the following settings:</p> <ul> <li><code>base-url</code> is the root URL for the ntfy server; this is needed for e-mail footer</li> <li><code>smtp-sender-addr</code> is the hostname:port of the SMTP server</li> <li><code>smtp-sender-user</code> and <code>smtp-sender-pass</code> are the username and password of the SMTP user</li> <li><code>smtp-sender-from</code> is the e-mail address of the sender</li> </ul> <p>Here's an example config using <a href=https://aws.amazon.com/ses/ >Amazon SES</a> for outgoing mail (this is how it is configured for <code>ntfy.sh</code>):</p> <div class="tabbed-set tabbed-alternate" data-tabs=10:1><input checked=checked id=__tabbed_10_1 name=__tabbed_10 type=radio><div class=tabbed-labels><label for=__tabbed_10_1>/etc/ntfy/server.yml</label></div> <div class=tabbed-content> <div class=tabbed-block> <div class=highlight><pre><span></span><code><span class=nt>base-url</span><span class=p>:</span><span class=w> </span><span class=s>&quot;https://ntfy.sh&quot;</span>
<span class=nt>smtp-sender-addr</span><span class=p>:</span><span class=w> </span><span class=s>&quot;email-smtp.us-east-2.amazonaws.com:587&quot;</span>
<span class=nt>smtp-sender-user</span><span class=p>:</span><span class=w> </span><span class=s>&quot;AKIDEADBEEFAFFE12345&quot;</span>
<span class=nt>smtp-sender-pass</span><span class=p>:</span><span class=w> </span><span class=s>&quot;Abd13Kf+sfAk2DzifjafldkThisIsNotARealKeyOMG.&quot;</span>
<span class=nt>smtp-sender-from</span><span class=p>:</span><span class=w> </span><span class=s>&quot;ntfy@ntfy.sh&quot;</span>
</code></pre></div> </div> </div> </div> <p>Please also refer to the <a href=#rate-limiting>rate limiting</a> settings below, specifically <code>visitor-email-limit-burst</code> and <code>visitor-email-limit-burst</code>. Setting these conservatively is necessary to avoid abuse.</p> <h2 id=e-mail-publishing>E-mail publishing<a class=headerlink href=#e-mail-publishing title="Permanent link">&para;</a></h2> <p>To allow publishing messages via e-mail, ntfy can run a lightweight <strong>SMTP server for incoming messages</strong>. Once configured, users can <a href=../publish/#e-mail-publishing>send emails to a topic e-mail address</a> (e.g. <code>mytopic@ntfy.sh</code> or <code>myprefix-mytopic@ntfy.sh</code>) to publish messages to a topic. This is useful for e-mail based integrations such as for statuspage.io (though these days most services also support webhooks and HTTP calls).</p> <p>To configure the SMTP server, you must at least set <code>smtp-server-listen</code> and <code>smtp-server-domain</code>:</p> <ul> <li><code>smtp-server-listen</code> defines the IP address and port the SMTP server will listen on, e.g. <code>:25</code> or <code>1.2.3.4:25</code></li> <li><code>smtp-server-domain</code> is the e-mail domain, e.g. <code>ntfy.sh</code> (must be identical to MX record, see below)</li> <li><code>smtp-server-addr-prefix</code> is an optional prefix for the e-mail addresses to prevent spam. If set to <code>ntfy-</code>, for instance, only e-mails to <code>ntfy-$topic@ntfy.sh</code> will be accepted. If this is not set, all emails to <code>$topic@ntfy.sh</code> will be accepted (which may obviously be a spam problem).</li> </ul> <p>Here's an example config (this is how it is configured for <code>ntfy.sh</code>):</p> <div class="tabbed-set tabbed-alternate" data-tabs=11:1><input checked=checked id=__tabbed_11_1 name=__tabbed_11 type=radio><div class=tabbed-labels><label for=__tabbed_11_1>/etc/ntfy/server.yml</label></div> <div class=tabbed-content> <div class=tabbed-block> <div class=highlight><pre><span></span><code><span class=nt>smtp-server-listen</span><span class=p>:</span><span class=w> </span><span class=s>&quot;:25&quot;</span>
<span class=nt>smtp-server-domain</span><span class=p>:</span><span class=w> </span><span class=s>&quot;ntfy.sh&quot;</span>
<span class=nt>smtp-server-addr-prefix</span><span class=p>:</span><span class=w> </span><span class=s>&quot;ntfy-&quot;</span>
</code></pre></div> </div> </div> </div> <p>In addition to configuring the ntfy server, you have to create two DNS records (an <a href=https://en.wikipedia.org/wiki/MX_record>MX record</a> and a corresponding A record), so incoming mail will find its way to your server. Here's an example of how <code>ntfy.sh</code> is configured (in <a href=https://aws.amazon.com/route53/ >Amazon Route 53</a>):</p> <figure> <p><img alt="DNS records for incoming mail" src=../static/img/screenshot-email-publishing-dns.png width=600> </p> <figcaption>DNS records for incoming mail</figcaption> </figure> <p>You can check if everything is working correctly by sending an email as raw SMTP via <code>nc</code>. Create a text file, e.g. <code>email.txt</code></p> <div class=highlight><pre><span></span><code>EHLO example.com
MAIL FROM: phil@example.com
RCPT TO: ntfy-mytopic@ntfy.sh
DATA
Subject: Email for you
Content-Type: text/plain; charset=&quot;UTF-8&quot;

Hello from ðŸ‡©ðŸ‡ª
.
</code></pre></div> <p>And then send the mail via <code>nc</code> like this. If you see any lines starting with <code>451</code>, those are errors from the ntfy server. Read them carefully.</p> <div class=highlight><pre><span></span><code>$ cat email.txt | nc -N ntfy.sh 25
220 ntfy.sh ESMTP Service Ready
250-Hello example.com
...
250 2.0.0 Roger, accepting mail from &lt;phil@example.com&gt;
250 2.0.0 I&#39;ll make sure &lt;ntfy-mytopic@ntfy.sh&gt; gets this
</code></pre></div> <p>As for the DNS setup, be sure to verify that <code>dig MX</code> and <code>dig A</code> are returning results similar to this:</p> <div class=highlight><pre><span></span><code>$ dig MX ntfy.sh +short 
10 mx1.ntfy.sh.
$ dig A mx1.ntfy.sh +short 
3.139.215.220
</code></pre></div> <h3 id=local-only-email>Local-only email<a class=headerlink href=#local-only-email title="Permanent link">&para;</a></h3> <p>If you want to send emails from an internal service on the same network as your ntfy instance, you do not need to worry about DNS records at all. Define a port for the SMTP server and pick an SMTP server domain (can be anything).</p> <div class="tabbed-set tabbed-alternate" data-tabs=12:1><input checked=checked id=__tabbed_12_1 name=__tabbed_12 type=radio><div class=tabbed-labels><label for=__tabbed_12_1>/etc/ntfy/server.yml</label></div> <div class=tabbed-content> <div class=tabbed-block> <div class=highlight><pre><span></span><code><span class=nt>smtp-server-listen</span><span class=p>:</span><span class=w> </span><span class=s>&quot;:25&quot;</span>
<span class=nt>smtp-server-domain</span><span class=p>:</span><span class=w> </span><span class=s>&quot;example.com&quot;</span>
<span class=nt>smtp-server-addr-prefix</span><span class=p>:</span><span class=w> </span><span class=s>&quot;ntfy-&quot;</span><span class=w>  </span><span class=c1># optional</span>
</code></pre></div> </div> </div> </div> <p>Then, in the email settings of your internal service, set the SMTP server address to the IP address of your ntfy instance. Set the port to the value you defined in <code>smtp-server-listen</code>. Leave any username and password fields empty. In the "From" address, pick anything (e.g., "alerts@ntfy.sh"); the value doesn't matter. In the "To" address, put in an email address that follows this pattern: <code>[topic]@[smtp-server-domain]</code> (or <code>[smtp-server-addr-prefix][topic]@[smtp-server-domain]</code> if you set <code>smtp-server-addr-prefix</code>).</p> <p>So if you used <code>example.com</code> as the SMTP server domain, and you want to send a message to the <code>email-alerts</code> topic, set the "To" address to <code>email-alerts@example.com</code>. If the topic has access restrictions, you will need to include an access token in the "To" address, such as <code>email-alerts+tk_AbC123dEf456@example.com</code>.</p> <p>If the internal service lets you use define an email "Subject", it will become the title of the notification. The body of the email will become the message of the notification.</p> <h2 id=behind-a-proxy-tls-etc>Behind a proxy (TLS, etc.)<a class=headerlink href=#behind-a-proxy-tls-etc title="Permanent link">&para;</a></h2> <div class="admonition warning"> <p class=admonition-title>Warning</p> <p>If you are running ntfy behind a proxy, you must set the <code>behind-proxy</code> flag. Otherwise, all visitors are <a href=#rate-limiting>rate limited</a> as if they are one.</p> </div> <p>It may be desirable to run ntfy behind a proxy (e.g. nginx, HAproxy or Apache), so you can provide TLS certificates using Let's Encrypt using certbot, or simply because you'd like to share the ports (80/443) with other services. Whatever your reasons may be, there are a few things to consider. </p> <h3 id=ip-based-rate-limiting>IP-based rate limiting<a class=headerlink href=#ip-based-rate-limiting title="Permanent link">&para;</a></h3> <p>If you are running ntfy behind a proxy, you should set the <code>behind-proxy</code> flag. This will instruct the <a href=#rate-limiting>rate limiting</a> logic to use the header configured in <code>proxy-forwarded-header</code> (default is <code>X-Forwarded-For</code>) as the primary identifier for a visitor, as opposed to the remote IP address. </p> <p>If the <code>behind-proxy</code> flag is not set, all visitors will be counted as one, because from the perspective of the ntfy server, they all share the proxy's IP address.</p> <p>Relevant flags to consider:</p> <ul> <li><code>behind-proxy</code> makes it so that the real visitor IP address is extracted from the header defined in <code>proxy-forwarded-header</code>. Without this, the remote address of the incoming connection is used (default: <code>false</code>).</li> <li><code>proxy-forwarded-header</code> is the header to use to identify visitors (default: <code>X-Forwarded-For</code>). It may be a single IP address (e.g. <code>1.2.3.4</code>), a comma-separated list of IP addresses (e.g. <code>1.2.3.4, 5.6.7.8</code>), or an <a href=https://datatracker.ietf.org/doc/html/rfc7239>RFC 7239</a>-style header (e.g. <code>for=1.2.3.4;by=proxy.example.com, for=5.6.7.8</code>).</li> <li><code>proxy-trusted-hosts</code> is a comma-separated list of IP addresses, hosts or CIDRs that are removed from the forwarded header to determine the real IP address. This is only useful if there are multiple proxies involved that add themselves to the forwarded header (default: empty).</li> <li><code>visitor-prefix-bits-ipv4</code> is the number of bits of the IPv4 address to use for rate limiting (default is <code>32</code>, which is the entire IP address). In IPv4 environments, by default, a visitor's <strong>full IPv4 address</strong> is used as-is for rate limiting. This means that if someone publishes messages from multiple IP addresses, they will be counted as separate visitors. You can adjust this by setting the <code>visitor-prefix-bits-ipv4</code> config option. To group visitors in a /24 subnet and count them as one, for instance, set it to <code>24</code>. In that case, <code>1.2.3.4</code> and <code>1.2.3.99</code> are treated as the same visitor.</li> <li><code>visitor-prefix-bits-ipv6</code> is the number of bits of the IPv6 address to use for rate limiting (default is <code>64</code>, which is a /64 subnet). In IPv6 environments, by default, a visitor's IP address is <strong>truncated to the /64 subnet</strong>, meaning that <code>2001:db8:25:86:1::1</code> and <code>2001:db8:25:86:2::1</code> are treated as the same visitor. Use the <code>visitor-prefix-bits-ipv6</code> config option to adjust this behavior. See <a href=#ipv6-considerations>IPv6 considerations</a> for more details.</li> </ul> <div class="tabbed-set tabbed-alternate" data-tabs=13:5><input checked=checked id=__tabbed_13_1 name=__tabbed_13 type=radio><input id=__tabbed_13_2 name=__tabbed_13 type=radio><input id=__tabbed_13_3 name=__tabbed_13 type=radio><input id=__tabbed_13_4 name=__tabbed_13 type=radio><input id=__tabbed_13_5 name=__tabbed_13 type=radio><div class=tabbed-labels><label for=__tabbed_13_1>/etc/ntfy/server.yml (behind a proxy)</label><label for=__tabbed_13_2>/etc/ntfy/server.yml (X-Client-IP header)</label><label for=__tabbed_13_3>/etc/ntfy/server.yml (Forwarded header)</label><label for=__tabbed_13_4>/etc/ntfy/server.yml (multiple proxies)</label><label for=__tabbed_13_5>/etc/ntfy/server.yml (adjusted IPv4/IPv6 prefixes proxies)</label></div> <div class=tabbed-content> <div class=tabbed-block> <div class=highlight><pre><span></span><code><span class=c1># Tell ntfy to use &quot;X-Forwarded-For&quot; header to identify visitors for rate limiting</span>
<span class=c1>#</span>
<span class=c1># Example: If &quot;X-Forwarded-For: 9.9.9.9, 1.2.3.4&quot; is set, </span>
<span class=c1>#          the visitor IP will be 1.2.3.4 (right-most address).</span>
<span class=c1>#</span>
<span class=nt>behind-proxy</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
</code></pre></div> </div> <div class=tabbed-block> <div class=highlight><pre><span></span><code><span class=c1># Tell ntfy to use &quot;X-Client-IP&quot; header to identify visitors for rate limiting</span>
<span class=c1>#</span>
<span class=c1># Example: If &quot;X-Client-IP: 9.9.9.9&quot; is set, </span>
<span class=c1>#          the visitor IP will be 9.9.9.9.</span>
<span class=c1>#</span>
<span class=nt>behind-proxy</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class=nt>proxy-forwarded-header</span><span class=p>:</span><span class=w> </span><span class=s>&quot;X-Client-IP&quot;</span>
</code></pre></div> </div> <div class=tabbed-block> <div class=highlight><pre><span></span><code><span class=c1># Tell ntfy to use &quot;Forwarded&quot; header (RFC 7239) to identify visitors for rate limiting</span>
<span class=c1>#</span>
<span class=c1># Example: If &quot;Forwarded: for=1.2.3.4;by=proxy.example.com, for=9.9.9.9&quot; is set, </span>
<span class=c1>#          the visitor IP will be 9.9.9.9.</span>
<span class=c1>#</span>
<span class=nt>behind-proxy</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class=nt>proxy-forwarded-header</span><span class=p>:</span><span class=w> </span><span class=s>&quot;Forwarded&quot;</span>
</code></pre></div> </div> <div class=tabbed-block> <div class=highlight><pre><span></span><code><span class=c1># Tell ntfy to use &quot;X-Forwarded-For&quot; header to identify visitors for rate limiting,</span>
<span class=c1># and to strip the IP addresses of the proxies 1.2.3.4 and 1.2.3.5</span>
<span class=c1>#</span>
<span class=c1># Example: If &quot;X-Forwarded-For: 9.9.9.9, 1.2.3.4&quot; is set, </span>
<span class=c1>#          the visitor IP will be 9.9.9.9 (right-most unknown address).</span>
<span class=c1>#</span>
<span class=nt>behind-proxy</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class=nt>proxy-trusted-hosts</span><span class=p>:</span><span class=w> </span><span class=s>&quot;1.2.3.0/24,</span><span class=nv> </span><span class=s>1.2.2.2,</span><span class=nv> </span><span class=s>2001:db8::/64&quot;</span>
</code></pre></div> </div> <div class=tabbed-block> <div class=highlight><pre><span></span><code><span class=c1># Tell ntfy to treat visitors as being in a /24 subnet (IPv4) or /48 subnet (IPv6)</span>
<span class=c1># as one visitor, so that they are counted as one for rate limiting.</span>
<span class=c1>#</span>
<span class=c1># Example 1: If 1.2.3.4 and 1.2.3.5 publish a message, the visitor 1.2.3.0 will have</span>
<span class=c1>#            used 2 messages.</span>
<span class=c1># Example 2: If 2001:db8:2500:1::1 and 2001:db8:2500:2::1 publish a message, the visitor</span>
<span class=c1>#            2001:db8:2500:: will have used 2 messages.</span>
<span class=c1>#</span>
<span class=nt>visitor-prefix-bits-ipv4</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">24</span>
<span class=nt>visitor-prefix-bits-ipv6</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">48</span>
</code></pre></div> </div> </div> </div> <h3 id=tlsssl>TLS/SSL<a class=headerlink href=#tlsssl title="Permanent link">&para;</a></h3> <p>ntfy supports HTTPS/TLS by setting the <code>listen-https</code> <a href=#config-options>config option</a>. However, if you are behind a proxy, it is recommended that TLS/SSL termination is done by the proxy itself (see below).</p> <p>I highly recommend using <a href=https://certbot.eff.org/ >certbot</a>. I use it with the <a href=https://certbot-dns-route53.readthedocs.io/en/stable/ >dns-route53 plugin</a>, which lets you use <a href=https://aws.amazon.com/route53/ >AWS Route 53</a> as the challenge. That's much easier than using the HTTP challenge. I've found <a href=https://nandovieira.com/using-lets-encrypt-in-development-with-nginx-and-aws-route53>this guide</a> to be incredibly helpful.</p> <h3 id=nginxapache2caddy>nginx/Apache2/caddy<a class=headerlink href=#nginxapache2caddy title="Permanent link">&para;</a></h3> <p>For your convenience, here's a working config that'll help configure things behind a proxy. Be sure to <strong>enable WebSockets</strong> by forwarding the <code>Connection</code> and <code>Upgrade</code> headers accordingly. </p> <p>In this example, ntfy runs on <code>:2586</code> and we proxy traffic to it. We also redirect HTTP to HTTPS for GET requests against a topic or the root domain:</p> <div class="tabbed-set tabbed-alternate" data-tabs=14:4><input checked=checked id=__tabbed_14_1 name=__tabbed_14 type=radio><input id=__tabbed_14_2 name=__tabbed_14 type=radio><input id=__tabbed_14_3 name=__tabbed_14 type=radio><input id=__tabbed_14_4 name=__tabbed_14 type=radio><div class=tabbed-labels><label for=__tabbed_14_1>nginx (convenient)</label><label for=__tabbed_14_2>nginx (more secure)</label><label for=__tabbed_14_3>Apache2</label><label for=__tabbed_14_4>caddy</label></div> <div class=tabbed-content> <div class=tabbed-block> <div class=highlight><pre><span></span><code># /etc/nginx/sites-*/ntfy
#
# This config allows insecure HTTP POST/PUT requests against topics to allow a short curl syntax (without -L
# and &quot;https://&quot; prefix). It also disables output buffering, which has worked well for the ntfy.sh server.
#
# This is pretty much how ntfy.sh is configured. To see the exact configuration,
# see https://github.com/binwiederhier/ntfy-ansible/

server {
  listen 80;
  server_name ntfy.sh;

  location / {
    # Redirect HTTP to HTTPS, but only for GET topic addresses, since we want 
    # it to work with curl without the annoying https:// prefix
    set $redirect_https &quot;&quot;;
    if ($request_method = GET) {
      set $redirect_https &quot;yes&quot;;
    }
    if ($request_uri ~* &quot;^/([-_a-z0-9]{0,64}$|docs/|static/)&quot;) {
      set $redirect_https &quot;${redirect_https}yes&quot;;
    }
    if ($redirect_https = &quot;yesyes&quot;) {
      return 302 https://$http_host$request_uri$is_args$query_string;
    }

    proxy_pass http://127.0.0.1:2586;
    proxy_http_version 1.1;

    proxy_buffering off;
    proxy_request_buffering off;
    proxy_redirect off;

    proxy_set_header Host $http_host;
    proxy_set_header Upgrade $http_upgrade;
    proxy_set_header Connection &quot;upgrade&quot;;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;

    proxy_connect_timeout 3m;
    proxy_send_timeout 3m;
    proxy_read_timeout 3m;

    client_max_body_size 0; # Stream request body to backend
  }
}

server {
  listen 443 ssl http2;
  server_name ntfy.sh;

  # See https://ssl-config.mozilla.org/#server=nginx&amp;version=1.18.0&amp;config=intermediate&amp;openssl=1.1.1k&amp;hsts=false&amp;ocsp=false&amp;guideline=5.6
  ssl_session_timeout 1d;
  ssl_session_cache shared:MozSSL:10m; # about 40000 sessions
  ssl_session_tickets off;
  ssl_protocols TLSv1.2 TLSv1.3;
  ssl_ciphers ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-CHACHA20-POLY1305:ECDHE-RSA-CHACHA20-POLY1305:DHE-RSA-AES128-GCM-SHA256:DHE-RSA-AES256-GCM-SHA384;
  ssl_prefer_server_ciphers off;

  ssl_certificate /etc/letsencrypt/live/ntfy.sh/fullchain.pem;
  ssl_certificate_key /etc/letsencrypt/live/ntfy.sh/privkey.pem;

  location / {
    proxy_pass http://127.0.0.1:2586;
    proxy_http_version 1.1;

    proxy_buffering off;
    proxy_request_buffering off;
    proxy_redirect off;

    proxy_set_header Host $http_host;
    proxy_set_header Upgrade $http_upgrade;
    proxy_set_header Connection &quot;upgrade&quot;;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;

    proxy_connect_timeout 3m;
    proxy_send_timeout 3m;
    proxy_read_timeout 3m;

    client_max_body_size 0; # Stream request body to backend
  }
}
</code></pre></div> </div> <div class=tabbed-block> <div class=highlight><pre><span></span><code># /etc/nginx/sites-*/ntfy
#
# This config requires the use of the -L flag in curl to redirect to HTTPS, and it keeps nginx output buffering
# enabled. While recommended, I have had issues with that in the past.

server {
  listen 80;
  server_name ntfy.sh;

  location / {
    return 302 https://$http_host$request_uri$is_args$query_string;

    proxy_pass http://127.0.0.1:2586;
    proxy_http_version 1.1;

    proxy_set_header Host $http_host;
    proxy_set_header Upgrade $http_upgrade;
    proxy_set_header Connection &quot;upgrade&quot;;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;

    proxy_connect_timeout 3m;
    proxy_send_timeout 3m;
    proxy_read_timeout 3m;

    client_max_body_size 0; # Stream request body to backend
  }
}

server {
  listen 443 ssl http2;
  server_name ntfy.sh;

  # See https://ssl-config.mozilla.org/#server=nginx&amp;version=1.18.0&amp;config=intermediate&amp;openssl=1.1.1k&amp;hsts=false&amp;ocsp=false&amp;guideline=5.6
  ssl_session_timeout 1d;
  ssl_session_cache shared:MozSSL:10m; # about 40000 sessions
  ssl_session_tickets off;
  ssl_protocols TLSv1.2 TLSv1.3;
  ssl_ciphers ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-CHACHA20-POLY1305:ECDHE-RSA-CHACHA20-POLY1305:DHE-RSA-AES128-GCM-SHA256:DHE-RSA-AES256-GCM-SHA384;
  ssl_prefer_server_ciphers off;

  ssl_certificate /etc/letsencrypt/live/ntfy.sh/fullchain.pem;
  ssl_certificate_key /etc/letsencrypt/live/ntfy.sh/privkey.pem;

  location / {
    proxy_pass http://127.0.0.1:2586;
    proxy_http_version 1.1;

    proxy_set_header Host $http_host;
    proxy_set_header Upgrade $http_upgrade;
    proxy_set_header Connection &quot;upgrade&quot;;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;

    proxy_connect_timeout 3m;
    proxy_send_timeout 3m;
    proxy_read_timeout 3m;

    client_max_body_size 0; # Stream request body to backend
  }
}
</code></pre></div> </div> <div class=tabbed-block> <div class=highlight><pre><span></span><code># /etc/apache2/sites-*/ntfy.conf

&lt;VirtualHost *:80&gt;
    ServerName ntfy.sh

    # Proxy connections to ntfy (requires &quot;a2enmod proxy proxy_http&quot;)
    ProxyPass / http://127.0.0.1:2586/ upgrade=websocket
    ProxyPassReverse / http://127.0.0.1:2586/

    SetEnv proxy-nokeepalive 1
    SetEnv proxy-sendchunked 1

    # Higher than the max message size of 4096 bytes
    LimitRequestBody 102400

    # Redirect HTTP to HTTPS, but only for GET topic addresses, since we want 
    # it to work with curl without the annoying https:// prefix (requires &quot;a2enmod alias&quot;)
    &lt;If &quot;%{REQUEST_METHOD} == &#39;GET&#39;&quot;&gt;
        RedirectMatch permanent &quot;^/([-_A-Za-z0-9]{0,64})$&quot; &quot;https://%{SERVER_NAME}/$1&quot;
    &lt;/If&gt;

&lt;/VirtualHost&gt;

&lt;VirtualHost *:443&gt;
    ServerName ntfy.sh

    SSLEngine on
    SSLCertificateFile /etc/letsencrypt/live/ntfy.sh/fullchain.pem
    SSLCertificateKeyFile /etc/letsencrypt/live/ntfy.sh/privkey.pem
    Include /etc/letsencrypt/options-ssl-apache.conf

    # Proxy connections to ntfy (requires &quot;a2enmod proxy proxy_http&quot;)
    ProxyPass / http://127.0.0.1:2586/ upgrade=websocket
    ProxyPassReverse / http://127.0.0.1:2586/

    SetEnv proxy-nokeepalive 1
    SetEnv proxy-sendchunked 1

    # Higher than the max message size of 4096 bytes 
    LimitRequestBody 102400

&lt;/VirtualHost&gt;
</code></pre></div> </div> <div class=tabbed-block> <div class=highlight><pre><span></span><code># Note that this config is most certainly incomplete. Please help out and let me know what&#39;s missing
# via Discord/Matrix or in a GitHub issue.
# Note: Caddy automatically handles both HTTP and WebSockets with reverse_proxy 

ntfy.sh, http://nfty.sh {
    reverse_proxy 127.0.0.1:2586

    # Redirect HTTP to HTTPS, but only for GET topic addresses, since we want
    # it to work with curl without the annoying https:// prefix
    @httpget {
        protocol http
        method GET
        path_regexp ^/([-_a-z0-9]{0,64}$|docs/|static/)
    }
    redir @httpget https://{host}{uri}
}
</code></pre></div> </div> </div> </div> <h2 id=firebase-fcm>Firebase (FCM)<a class=headerlink href=#firebase-fcm title="Permanent link">&para;</a></h2> <div class="admonition info"> <p class=admonition-title>Info</p> <p>Using Firebase is <strong>optional</strong> and only works if you modify and <a href=../develop/#android-app>build your own Android .apk</a>. For a self-hosted instance, it's easier to just not bother with FCM.</p> </div> <p><a href=https://firebase.google.com/docs/cloud-messaging>Firebase Cloud Messaging (FCM)</a> is the Google approved way to send push messages to Android devices. FCM is the only method that an Android app can receive messages without having to run a <a href=https://developer.android.com/guide/components/foreground-services>foreground service</a>.</p> <p>For the main host <a href=https://ntfy.sh>ntfy.sh</a>, the <a href=../subscribe/phone/ >ntfy Android app</a> uses Firebase to send messages to the device. For other hosts, instant delivery is used and FCM is not involved.</p> <p>To configure FCM for your self-hosted instance of the ntfy server, follow these steps:</p> <ol> <li>Sign up for a <a href=https://console.firebase.google.com/ >Firebase account</a></li> <li>Create a Firebase app and download the key file (e.g. <code>myapp-firebase-adminsdk-...json</code>)</li> <li>Place the key file in <code>/etc/ntfy</code>, set the <code>firebase-key-file</code> in <code>server.yml</code> accordingly and restart the ntfy server</li> <li>Build your own Android .apk following <a href=../develop/#android-app>these instructions</a></li> </ol> <p>Example: <div class=highlight><pre><span></span><code># If set, also publish messages to a Firebase Cloud Messaging (FCM) topic for your app.
# This is optional and only required to support Android apps (which don&#39;t allow background services anymore).
#
firebase-key-file: &quot;/etc/ntfy/ntfy-sh-firebase-adminsdk-ahnce-9f4d6f14b5.json&quot;
</code></pre></div></p> <h2 id=ios-instant-notifications>iOS instant notifications<a class=headerlink href=#ios-instant-notifications title="Permanent link">&para;</a></h2> <p>Unlike Android, iOS heavily restricts background processing, which sadly makes it impossible to implement instant push notifications without a central server. </p> <p>To still support instant notifications on iOS through your self-hosted ntfy server, you have to forward so called <code>poll_request</code> messages to the main ntfy.sh server (or any upstream server that's APNS/Firebase connected, if you build your own iOS app), which will then forward it to Firebase/APNS.</p> <p>To configure it, simply set <code>upstream-base-url</code> like so:</p> <div class=highlight><pre><span></span><code><span class=nt>upstream-base-url</span><span class=p>:</span><span class=w> </span><span class=s>&quot;https://ntfy.sh&quot;</span>
<span class=nt>upstream-access-token</span><span class=p>:</span><span class=w> </span><span class=s>&quot;...&quot;</span><span class=w> </span><span class=c1># optional, only if rate limits exceeded, or upstream server protected</span>
</code></pre></div> <p>If set, all incoming messages will publish a poll request to the configured upstream server, containing the message ID of the original message, instructing the iOS app to poll this server for the actual message contents.</p> <p>If <code>upstream-base-url</code> is not set, notifications will still eventually get to your device, but delivery can take hours, depending on the state of the phone. If you are using your phone, it shouldn't take more than 20-30 minutes though.</p> <p>In case you're curious, here's an example of the entire flow: </p> <ul> <li>In the iOS app, you subscribe to <code>https://ntfy.example.com/mytopic</code></li> <li>The app subscribes to the Firebase topic <code>6de73be8dfb7d69e...</code> (the SHA256 of the topic URL)</li> <li>When you publish a message to <code>https://ntfy.example.com/mytopic</code>, your ntfy server will publish a poll request to <code>https://ntfy.sh/6de73be8dfb7d69e...</code>. The request from your server to the upstream server contains only the message ID (in the <code>X-Poll-ID</code> header), and the SHA256 checksum of the topic URL (as upstream topic).</li> <li>The ntfy.sh server publishes the poll request message to Firebase, which forwards it to APNS, which forwards it to your iOS device</li> <li>Your iOS device receives the poll request, and fetches the actual message from your server, and then displays it</li> </ul> <p>Here's an example of what the self-hosted server forwards to the upstream server. The request is equivalent to this curl:</p> <div class=highlight><pre><span></span><code>curl -X POST -H &quot;X-Poll-ID: s4PdJozxM8na&quot; https://ntfy.sh/6de73be8dfb7d69e32fb2c00c23fe7adbd8b5504406e3068c273aa24cef4055b
{&quot;id&quot;:&quot;4HsClFEuCIcs&quot;,&quot;time&quot;:1654087955,&quot;event&quot;:&quot;poll_request&quot;,&quot;topic&quot;:&quot;6de73be8dfb7d69e32fb2c00c23fe7adbd8b5504406e3068c273aa24cef4055b&quot;,&quot;message&quot;:&quot;New message&quot;,&quot;poll_id&quot;:&quot;s4PdJozxM8na&quot;}
</code></pre></div> <p>Note that the self-hosted server literally sends the message <code>New message</code> for every message, even if your message may be <code>Some other message</code>. This is so that if iOS cannot talk to the self-hosted server (in time, or at all), it'll show <code>New message</code> as a popup.</p> <h2 id=web-push>Web Push<a class=headerlink href=#web-push title="Permanent link">&para;</a></h2> <p><a href=https://developer.mozilla.org/en-US/docs/Web/API/Push_API>Web Push</a> (<a href=https://datatracker.ietf.org/doc/html/rfc8030>RFC8030</a>) allows ntfy to receive push notifications, even when the ntfy web app (or even the browser, depending on the platform) is closed. When enabled, the user can enable <strong>background notifications</strong> for their topics in the web app under Settings. Once enabled by the user, ntfy will forward published messages to the push endpoint (browser-provided, e.g. fcm.googleapis.com), which will then forward it to the browser.</p> <p>To configure Web Push, you need to generate and configure a <a href=https://datatracker.ietf.org/doc/html/draft-thomson-webpush-vapid>VAPID</a> keypair (via <code>ntfy webpush keys</code>), a database to keep track of the browser's subscriptions, and an admin email address (you):</p> <ul> <li><code>web-push-public-key</code> is the generated VAPID public key, e.g. AA1234BBCCddvveekaabcdfqwertyuiopasdfghjklzxcvbnm1234567890</li> <li><code>web-push-private-key</code> is the generated VAPID private key, e.g. AA2BB1234567890abcdefzxcvbnm1234567890</li> <li><code>web-push-file</code> is a database file to keep track of browser subscription endpoints, e.g. <code>/var/cache/ntfy/webpush.db</code></li> <li><code>web-push-email-address</code> is the admin email address send to the push provider, e.g. <code>sysadmin@example.com</code></li> <li><code>web-push-startup-queries</code> is an optional list of queries to run on startup`</li> <li><code>web-push-expiry-warning-duration</code> defines the duration after which unused subscriptions are sent a warning (default is <code>55d</code>)</li> <li><code>web-push-expiry-duration</code> defines the duration after which unused subscriptions will expire (default is <code>60d</code>)</li> </ul> <p>Limitations:</p> <ul> <li> <p>Like foreground browser notifications, background push notifications require the web app to be served over HTTPS. A <em>valid</em> certificate is required, as service workers will not run on origins with untrusted certificates.</p> </li> <li> <p>Web Push is only supported for the same server. You cannot use subscribe to web push on a topic on another server. This is due to a limitation of the Push API, which doesn't allow multiple push servers for the same origin.</p> </li> </ul> <p>To configure VAPID keys, first generate them:</p> <div class=highlight><pre><span></span><code>$<span class=w> </span>ntfy<span class=w> </span>webpush<span class=w> </span>keys
Web<span class=w> </span>Push<span class=w> </span>keys<span class=w> </span>generated.
...
</code></pre></div> <p>Then copy the generated values into your <code>server.yml</code> or use the corresponding environment variables or command line arguments:</p> <div class=highlight><pre><span></span><code><span class=nt>web-push-public-key</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">AA1234BBCCddvveekaabcdfqwertyuiopasdfghjklzxcvbnm1234567890</span>
<span class=nt>web-push-private-key</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">AA2BB1234567890abcdefzxcvbnm1234567890</span>
<span class=nt>web-push-file</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">/var/cache/ntfy/webpush.db</span>
<span class=nt>web-push-email-address</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">sysadmin@example.com</span>
</code></pre></div> <p>The <code>web-push-file</code> is used to store the push subscriptions. Unused subscriptions will send out a warning after 55 days, and will automatically expire after 60 days (default). If the gateway returns an error (e.g. 410 Gone when a user has unsubscribed), subscriptions are also removed automatically.</p> <p>The web app refreshes subscriptions on start and regularly on an interval, but this file should be persisted across restarts. If the subscription file is deleted or lost, any web apps that aren't open will not receive new web push notifications until you open then.</p> <p>Changing your public/private keypair is <strong>not recommended</strong>. Browsers only allow one server identity (public key) per origin, and if you change them the clients will not be able to subscribe via web push until the user manually clears the notification permission.</p> <h2 id=tiers>Tiers<a class=headerlink href=#tiers title="Permanent link">&para;</a></h2> <p>ntfy supports associating users to pre-defined tiers. Tiers can be used to grant users higher limits, such as daily message limits, attachment size, or make it possible for users to reserve topics. If <a href=#payments>payments are enabled</a>, tiers can be paid or unpaid, and users can upgrade/downgrade between them. If payments are disabled, then the only way to switch between tiers is with the <code>ntfy user change-tier</code> command (see <a href=#users-and-roles>users and roles</a>).</p> <p>By default, <strong>newly created users have no tier</strong>, and all usage limits are read from the <code>server.yml</code> config file. Once a user is associated with a tier, some limits are overridden based on the tier.</p> <p>The <code>ntfy tier</code> command can be used to manage all available tiers. By default, there are no pre-defined tiers.</p> <p><strong>Example commands</strong> (type <code>ntfy token --help</code> or <code>ntfy token COMMAND --help</code> for more details): <div class=highlight><pre><span></span><code>ntfy tier add pro                     # Add tier with code &quot;pro&quot;, using the defaults
ntfy tier change --name=&quot;Pro&quot; pro     # Update the name of an existing tier
ntfy tier del starter                 # Delete an existing tier
ntfy user change-tier phil pro        # Switch user &quot;phil&quot; to tier &quot;pro&quot;
</code></pre></div></p> <p><strong>Creating a tier (full example):</strong> <div class=highlight><pre><span></span><code>ntfy tier add \
  --name=&quot;Pro&quot; \
  --message-limit=10000 \
  --message-expiry-duration=24h \
  --email-limit=50 \
  --call-limit=10 \
  --reservation-limit=10 \
  --attachment-file-size-limit=100M \
  --attachment-total-size-limit=1G \
  --attachment-expiry-duration=12h \
  --attachment-bandwidth-limit=5G \
  --stripe-price-id=price_123456 \
  pro
</code></pre></div></p> <h2 id=payments>Payments<a class=headerlink href=#payments title="Permanent link">&para;</a></h2> <p>ntfy supports paid <a href=#tiers>tiers</a> via <a href=https://stripe.com/ >Stripe</a> as a payment provider. If payments are enabled, users can register, login and switch plans in the web app. The web app will behave slightly differently if payments are enabled (e.g. showing an upgrade banner, or "ntfy Pro" tags).</p> <div class="admonition info"> <p class=admonition-title>Info</p> <p>The ntfy payments integration is very tailored to ntfy.sh and Stripe. I do not intend to support arbitrary use cases.</p> </div> <p>To enable payments, sign up with <a href=https://stripe.com/ >Stripe</a>, set the <code>stripe-secret-key</code> and <code>stripe-webhook-key</code> config options: </p> <ul> <li><code>stripe-secret-key</code> is the key used for the Stripe API communication. Setting this values enables payments in the ntfy web app (e.g. Upgrade dialog). See <a href=https://dashboard.stripe.com/apikeys>API keys</a>.</li> <li><code>stripe-webhook-key</code> is the key required to validate the authenticity of incoming webhooks from Stripe. Webhooks are essential to keep the local database in sync with the payment provider. See <a href=https://dashboard.stripe.com/webhooks>Webhooks</a>.</li> <li><code>billing-contact</code> is an email address or website displayed in the "Upgrade tier" dialog to let people reach out with billing questions. If unset, nothing will be displayed.</li> </ul> <p>In addition to setting these two options, you also need to define a <a href=https://dashboard.stripe.com/webhooks>Stripe webhook</a> for the <code>customer.subscription.updated</code> and <code>customer.subscription.deleted</code> event, which points to <code>https://ntfy.example.com/v1/account/billing/webhook</code>.</p> <p>Here's an example:</p> <div class=highlight><pre><span></span><code><span class=nt>stripe-secret-key</span><span class=p>:</span><span class=w> </span><span class=s>&quot;sk_test_ZmhzZGtmbGhkc2tqZmhzYcO2a2hmbGtnaHNkbGtnaGRsc2hnbG&quot;</span>
<span class=nt>stripe-webhook-key</span><span class=p>:</span><span class=w> </span><span class=s>&quot;whsec_ZnNkZnNIRExBSFNES0hBRFNmaHNka2ZsaGR&quot;</span>
<span class=nt>billing-contact</span><span class=p>:</span><span class=w> </span><span class=s>&quot;phil@example.com&quot;</span>
</code></pre></div> <h2 id=phone-calls>Phone calls<a class=headerlink href=#phone-calls title="Permanent link">&para;</a></h2> <p>ntfy supports phone calls via <a href=https://www.twilio.com/ >Twilio</a> as a call provider. If phone calls are enabled, users can verify and add a phone number, and then receive phone calls when publishing a message using the <code>X-Call</code> header. See <a href=../publish/#phone-calls>publishing page</a> for more details.</p> <p>To enable Twilio integration, sign up with <a href=https://www.twilio.com/ >Twilio</a>, purchase a phone number (Toll free numbers are the easiest), and then configure the following options:</p> <ul> <li><code>twilio-account</code> is the Twilio account SID, e.g. AC12345beefbeef67890beefbeef122586</li> <li><code>twilio-auth-token</code> is the Twilio auth token, e.g. affebeef258625862586258625862586</li> <li><code>twilio-phone-number</code> is the outgoing phone number you purchased, e.g. +18775132586 </li> <li><code>twilio-verify-service</code> is the Twilio Verify service SID, e.g. VA12345beefbeef67890beefbeef122586</li> </ul> <p>After you have configured phone calls, create a <a href=#tiers>tier</a> with a call limit (e.g. <code>ntfy tier create --call-limit=10 ...</code>), and then assign it to a user. Users may then use the <code>X-Call</code> header to receive a phone call when publishing a message.</p> <h2 id=message-limits>Message limits<a class=headerlink href=#message-limits title="Permanent link">&para;</a></h2> <p>There are a few message limits that you can configure:</p> <ul> <li><code>message-size-limit</code> defines the max size of a message body. Please note message sizes &gt;4K are <strong>not recommended, and largely untested</strong>. The Android/iOS and other clients may not work, or work properly. If FCM and/or APNS is used, the limit should stay 4K, because their limits are around that size. If you increase this size limit regardless, FCM and APNS will NOT work for large messages.</li> <li><code>message-delay-limit</code> defines the max delay of a message when using the "Delay" header and <a href=../publish/#scheduled-delivery>scheduled delivery</a>.</li> </ul> <h2 id=rate-limiting>Rate limiting<a class=headerlink href=#rate-limiting title="Permanent link">&para;</a></h2> <div class="admonition info"> <p class=admonition-title>Info</p> <p>Be aware that if you are running ntfy behind a proxy, you must set the <code>behind-proxy</code> flag. Otherwise, all visitors are rate limited as if they are one.</p> </div> <p>By default, ntfy runs without authentication, so it is vitally important that we protect the server from abuse or overload. There are various limits and rate limits in place that you can use to configure the server:</p> <ul> <li><strong>Global limit</strong>: A global limit applies across all visitors (IPs, clients, users)</li> <li><strong>Visitor limit</strong>: A visitor limit only applies to a certain visitor. A <strong>visitor</strong> is identified by its IP address (or the <code>X-Forwarded-For</code> header if <code>behind-proxy</code> is set). All config options that start with the word <code>visitor</code> apply only on a per-visitor basis.</li> </ul> <p>During normal usage, you shouldn't encounter these limits at all, and even if you burst a few requests or emails (e.g. when you reconnect after a connection drop), it shouldn't have any effect.</p> <h3 id=general-limits>General limits<a class=headerlink href=#general-limits title="Permanent link">&para;</a></h3> <p>Let's do the easy limits first:</p> <ul> <li><code>global-topic-limit</code> defines the total number of topics before the server rejects new topics. It defaults to 15,000.</li> <li><code>visitor-subscription-limit</code> is the number of subscriptions (open connections) per visitor. This value defaults to 30.</li> </ul> <h3 id=request-limits>Request limits<a class=headerlink href=#request-limits title="Permanent link">&para;</a></h3> <p>In addition to the limits above, there is a requests/second limit per visitor for all sensitive GET/PUT/POST requests. This limit uses a <a href=https://en.wikipedia.org/wiki/Token_bucket>token bucket</a> (using Go's <a href=https://pkg.go.dev/golang.org/x/time/rate>rate package</a>):</p> <p>Each visitor has a bucket of 60 requests they can fire against the server (defined by <code>visitor-request-limit-burst</code>). After the 60, new requests will encounter a <code>429 Too Many Requests</code> response. The visitor request bucket is refilled at a rate of one request every 5s (defined by <code>visitor-request-limit-replenish</code>)</p> <ul> <li><code>visitor-request-limit-burst</code> is the initial bucket of requests each visitor has. This defaults to 60.</li> <li><code>visitor-request-limit-replenish</code> is the rate at which the bucket is refilled (one request per x). Defaults to 5s.</li> <li><code>visitor-request-limit-exempt-hosts</code> is a comma-separated list of hostnames and IPs to be exempt from request rate limiting; hostnames are resolved at the time the server is started. Defaults to an empty list.</li> </ul> <h3 id=message-limits_1>Message limits<a class=headerlink href=#message-limits_1 title="Permanent link">&para;</a></h3> <p>By default, the number of messages a visitor can send is governed entirely by the <a href=#request-limits>request limit</a>. For instance, if the request limit allows for 15,000 requests per day, and all of those requests are POST/PUT requests to publish messages, then that is the daily message limit.</p> <p>To limit the number of daily messages per visitor, you can set <code>visitor-message-daily-limit</code>. This defines the number of messages a visitor can send in a day. This counter is reset every day at midnight (UTC).</p> <h3 id=attachment-limits>Attachment limits<a class=headerlink href=#attachment-limits title="Permanent link">&para;</a></h3> <p>Aside from the global file size and total attachment cache limits (see <a href=#attachments>above</a>), there are two relevant per-visitor limits:</p> <ul> <li><code>visitor-attachment-total-size-limit</code> is the total storage limit used for attachments per visitor. It defaults to 100M. The per-visitor storage is automatically decreased as attachments expire. External attachments (attached via <code>X-Attach</code>, see <a href=../publish/#attachments>publishing docs</a>) do not count here. </li> <li><code>visitor-attachment-daily-bandwidth-limit</code> is the total daily attachment download/upload bandwidth limit per visitor, including PUT and GET requests. This is to protect your precious bandwidth from abuse, since egress costs money in most cloud providers. This defaults to 500M.</li> </ul> <h3 id=e-mail-limits>E-mail limits<a class=headerlink href=#e-mail-limits title="Permanent link">&para;</a></h3> <p>Similarly to the request limit, there is also an e-mail limit (only relevant if <a href=#e-mail-notifications>e-mail notifications</a> are enabled):</p> <ul> <li><code>visitor-email-limit-burst</code> is the initial bucket of emails each visitor has. This defaults to 16.</li> <li><code>visitor-email-limit-replenish</code> is the rate at which the bucket is refilled (one email per x). Defaults to 1h.</li> </ul> <h3 id=firebase-limits>Firebase limits<a class=headerlink href=#firebase-limits title="Permanent link">&para;</a></h3> <p>If <a href=#firebase-fcm>Firebase is configured</a>, all messages are also published to a Firebase topic (unless <code>Firebase: no</code> is set). Firebase enforces <a href=https://firebase.google.com/docs/cloud-messaging/concept-options#topics_throttling>its own limits</a> on how many messages can be published. Unfortunately these limits are a little vague and can change depending on the time of day. In practice, I have only ever observed <code>429 Quota exceeded</code> responses from Firebase if <strong>too many messages are published to the same topic</strong>. </p> <p>In ntfy, if Firebase responds with a 429 after publishing to a topic, the visitor (= IP address) who published the message is <strong>banned from publishing to Firebase for 10 minutes</strong> (not configurable). Because publishing to Firebase happens asynchronously, there is no indication of the user that this has happened. Non-Firebase subscribers (WebSocket or HTTP stream) are not affected. After the 10 minutes are up, messages forwarding to Firebase is resumed for this visitor.</p> <p>If this ever happens, there will be a log message that looks something like this: <div class=highlight><pre><span></span><code>WARN Firebase quota exceeded (likely for topic), temporarily denying Firebase access to visitor
</code></pre></div></p> <h3 id=ipv6-considerations>IPv6 considerations<a class=headerlink href=#ipv6-considerations title="Permanent link">&para;</a></h3> <p>By default, rate limiting for IPv6 is done using the <code>/64</code> subnet of the visitor's IPv6 address. This means that all visitors in the same <code>/64</code> subnet are treated as one visitor. This is done to prevent abuse, as IPv6 subnet assignments are typically much larger than IPv4 subnets (and much cheaper), and it is common for ISPs to assign large subnets to their customers.</p> <p>Other than that, rate limiting for IPv6 is done the same way as for IPv4, using the visitor's IP address or subnet to identify them.</p> <p>There are two options to configure the number of bits used for rate limiting (for IPv4 and IPv6):</p> <ul> <li><code>visitor-prefix-bits-ipv4</code> is number of bits of the IPv4 address to use for rate limiting (default: 32, full address)</li> <li><code>visitor-prefix-bits-ipv6</code> is number of bits of the IPv6 address to use for rate limiting (default: 64, /64 subnet)</li> </ul> <h3 id=subscriber-based-rate-limiting>Subscriber-based rate limiting<a class=headerlink href=#subscriber-based-rate-limiting title="Permanent link">&para;</a></h3> <p>By default, ntfy puts almost all rate limits on the message publisher, e.g. number of messages, requests, and attachment size are all based on the visitor who publishes a message. <strong>Subscriber-based rate limiting is a way to use the rate limits of a topic's subscriber, instead of the limits of the publisher.</strong></p> <p>If subscriber-based rate limiting is enabled, <strong>messages published on UnifiedPush topics</strong> (topics starting with <code>up</code>, e.g. <code>up123456789012</code>) will be counted towards the "rate visitor" of the topic. A "rate visitor" is the first subscriber to the topic. </p> <p>Once enabled, a client subscribing to UnifiedPush topics via HTTP stream, or websockets, will be automatically registered as a "rate visitor", i.e. the visitor whose rate limits will be used when publishing on this topic. Note that setting the rate visitor requires <strong>read-write permission</strong> on the topic.</p> <p>If this setting is enabled, publishing to UnifiedPush topics will lead to an <code>HTTP 507 Insufficient Storage</code> response if no "rate visitor" has been previously registered. This is to avoid burning the publisher's <code>visitor-message-daily-limit</code>.</p> <p>To enable subscriber-based rate limiting, set <code>visitor-subscriber-rate-limiting: true</code>.</p> <div class="admonition info"> <p class=admonition-title>Info</p> <p>Due to a <a href=https://github.com/binwiederhier/ntfy/issues/1048>denial-of-service issue</a>, support for the <code>Rate-Topics</code> header was removed entirely. This is unfortunate, but subscriber-based rate limiting will still work for <code>up*</code> topics.</p> </div> <h2 id=tuning-for-scale>Tuning for scale<a class=headerlink href=#tuning-for-scale title="Permanent link">&para;</a></h2> <p>If you're running ntfy for your home server, you probably don't need to worry about scale at all. In its default config, if it's not behind a proxy, the ntfy server can keep about <strong>as many connections as the open file limit allows</strong>. This limit is typically called <code>nofile</code>. Other than that, RAM and CPU are obviously relevant. You may also want to check out <a href=https://www.reddit.com/r/golang/comments/r9u4ee/how_many_actively_connected_http_clients_can_a_go/ >this discussion on Reddit</a>.</p> <p>Depending on <em>how you run it</em>, here are a few limits that are relevant:</p> <h3 id=message-cache_1>Message cache<a class=headerlink href=#message-cache_1 title="Permanent link">&para;</a></h3> <p>By default, the <a href=#message-cache>message cache</a> (defined by <code>cache-file</code>) uses the SQLite default settings, which means it syncs to disk on every write. For personal servers, this is perfectly adequate. For larger installations, such as ntfy.sh, the <a href=https://sqlite.org/wal.html>write-ahead log (WAL)</a> should be enabled, and the sync mode should be adjusted. See <a href=https://phiresky.github.io/blog/2020/sqlite-performance-tuning/ >this article</a> for details.</p> <p>In addition to that, for very high load servers (such as ntfy.sh), it may be beneficial to write messages to the cache in batches, and asynchronously. This can be enabled with the <code>cache-batch-size</code> and <code>cache-batch-timeout</code>. If you start seeing <code>database locked</code> messages in the logs, you should probably enable that.</p> <p>Here's how ntfy.sh has been tuned in the <code>server.yml</code> file:</p> <div class=highlight><pre><span></span><code><span class=nt>cache-batch-size</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">25</span>
<span class=nt>cache-batch-timeout</span><span class=p>:</span><span class=w> </span><span class=s>&quot;1s&quot;</span>
<span class=nt>cache-startup-queries</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">|</span>
<span class=w>    </span><span class=no>pragma journal_mode = WAL;</span>
<span class=w>    </span><span class=no>pragma synchronous = normal;</span>
<span class=w>    </span><span class=no>pragma temp_store = memory;</span>
<span class=w>    </span><span class=no>pragma busy_timeout = 15000;</span>
<span class=w>    </span><span class=no>vacuum;</span>
</code></pre></div> <h3 id=for-systemd-services>For systemd services<a class=headerlink href=#for-systemd-services title="Permanent link">&para;</a></h3> <p>If you're running ntfy in a systemd service (e.g. for .deb/.rpm packages), the main limiting factor is the <code>LimitNOFILE</code> setting in the systemd unit. The default open files limit for <code>ntfy.service</code> is 10,000. You can override it by creating a <code>/etc/systemd/system/ntfy.service.d/override.conf</code> file. As far as I can tell, <code>/etc/security/limits.conf</code> is not relevant.</p> <div class="tabbed-set tabbed-alternate" data-tabs=15:1><input checked=checked id=__tabbed_15_1 name=__tabbed_15 type=radio><div class=tabbed-labels><label for=__tabbed_15_1>/etc/systemd/system/ntfy.service.d/override.conf</label></div> <div class=tabbed-content> <div class=tabbed-block> <div class=highlight><pre><span></span><code># Allow 20,000 ntfy connections (and give room for other file handles)
[Service]
LimitNOFILE=20500
</code></pre></div> </div> </div> </div> <h3 id=outside-of-systemd>Outside of systemd<a class=headerlink href=#outside-of-systemd title="Permanent link">&para;</a></h3> <p>If you're running outside systemd, you may want to adjust your <code>/etc/security/limits.conf</code> file to increase the <code>nofile</code> setting. Here's an example that increases the limit to 5,000. You can find out the current setting by running <code>ulimit -n</code>, or manually override it temporarily by running <code>ulimit -n 50000</code>.</p> <div class="tabbed-set tabbed-alternate" data-tabs=16:1><input checked=checked id=__tabbed_16_1 name=__tabbed_16 type=radio><div class=tabbed-labels><label for=__tabbed_16_1>/etc/security/limits.conf</label></div> <div class=tabbed-content> <div class=tabbed-block> <div class=highlight><pre><span></span><code># Increase open files limit globally
* hard nofile 20500
</code></pre></div> </div> </div> </div> <h3 id=proxy-limits-nginx-apache2>Proxy limits (nginx, Apache2)<a class=headerlink href=#proxy-limits-nginx-apache2 title="Permanent link">&para;</a></h3> <p>If you are running <a href=#behind-a-proxy-tls-etc>behind a proxy</a> (e.g. nginx, Apache), the open files limit of the proxy is also relevant. So if your proxy runs inside of systemd, increase the limits in systemd for the proxy. Typically, the proxy open files limit has to be <strong>double the number of how many connections you'd like to support</strong>, because the proxy has to maintain the client connection and the connection to ntfy.</p> <div class="tabbed-set tabbed-alternate" data-tabs=17:2><input checked=checked id=__tabbed_17_1 name=__tabbed_17 type=radio><input id=__tabbed_17_2 name=__tabbed_17 type=radio><div class=tabbed-labels><label for=__tabbed_17_1>/etc/nginx/nginx.conf</label><label for=__tabbed_17_2>/etc/systemd/system/nginx.service.d/override.conf</label></div> <div class=tabbed-content> <div class=tabbed-block> <div class=highlight><pre><span></span><code>events {
  # Allow 40,000 proxy connections (2x of the desired ntfy connection count;
  # and give room for other file handles)
  worker_connections 40500;
}
</code></pre></div> </div> <div class=tabbed-block> <div class=highlight><pre><span></span><code># Allow 40,000 proxy connections (2x of the desired ntfy connection count;
# and give room for other file handles)
[Service]
LimitNOFILE=40500
</code></pre></div> </div> </div> </div> <h3 id=banning-bad-actors-fail2ban>Banning bad actors (fail2ban)<a class=headerlink href=#banning-bad-actors-fail2ban title="Permanent link">&para;</a></h3> <p>If you put stuff on the Internet, bad actors will try to break them or break in. <a href=https://www.fail2ban.org/ >fail2ban</a> and nginx's <a href=http://nginx.org/en/docs/http/ngx_http_limit_req_module.html>ngx_http_limit_req_module module</a> can be used to ban client IPs if they misbehave. This is on top of the <a href=#rate-limiting>rate limiting</a> inside the ntfy server.</p> <p>Here's an example for how ntfy.sh is configured, following the instructions from two tutorials (<a href=https://easyengine.io/tutorials/nginx/fail2ban/ >here</a> and <a href=https://easyengine.io/tutorials/nginx/block-wp-login-php-bruteforce-attack/ >here</a>):</p> <div class="tabbed-set tabbed-alternate" data-tabs=18:4><input checked=checked id=__tabbed_18_1 name=__tabbed_18 type=radio><input id=__tabbed_18_2 name=__tabbed_18 type=radio><input id=__tabbed_18_3 name=__tabbed_18 type=radio><input id=__tabbed_18_4 name=__tabbed_18 type=radio><div class=tabbed-labels><label for=__tabbed_18_1>/etc/nginx/nginx.conf</label><label for=__tabbed_18_2>/etc/nginx/sites-enabled/ntfy.sh</label><label for=__tabbed_18_3>/etc/fail2ban/filter.d/nginx-req-limit.conf</label><label for=__tabbed_18_4>/etc/fail2ban/jail.local</label></div> <div class=tabbed-content> <div class=tabbed-block> <div class=highlight><pre><span></span><code># Rate limit all IP addresses
http {
  limit_req_zone $binary_remote_addr zone=one:10m rate=45r/m;
}

# Alternatively, whitelist certain IP addresses
http {
  geo $limited {
    default 1;
    116.203.112.46/32 0;
    132.226.42.65/32 0;
    ...
  }
  map $limited $limitkey {
    1 $binary_remote_addr;
    0 &quot;&quot;;
  }
  limit_req_zone $limitkey zone=one:10m rate=45r/m;
}
</code></pre></div> </div> <div class=tabbed-block> <div class=highlight><pre><span></span><code># For each server/location block
server {
  location / {
    limit_req zone=one burst=1000 nodelay;
  }
}    
</code></pre></div> </div> <div class=tabbed-block> <div class=highlight><pre><span></span><code>[Definition]
failregex = limiting requests, excess:.* by zone.*client: &lt;HOST&gt;
ignoreregex =
</code></pre></div> </div> <div class=tabbed-block> <div class=highlight><pre><span></span><code>[nginx-req-limit]
enabled = true
filter = nginx-req-limit
action = iptables-multiport[name=ReqLimit, port=&quot;http,https&quot;, protocol=tcp]
logpath = /var/log/nginx/error.log
findtime = 600
bantime = 14400
maxretry = 10
</code></pre></div> </div> </div> </div> <p>Note that if you run nginx in a container, append <code>, chain=DOCKER-USER</code> to the jail.local action. By default, the jail action chain is <code>INPUT</code>, but <code>FORWARD</code> is used when using docker networks. <code>DOCKER-USER</code>, available when using docker, is part of the <code>FORWARD</code> chain.</p> <p>The official ntfy.sh server uses fail2ban to ban IPs. Check out ntfy.sh's <a href=https://github.com/binwiederhier/ntfy-ansible/tree/main/roles/fail2ban>Ansible fail2ban role</a> for details. Ban actors are banned for 1 hour initially, and up to 4 hours at a time for repeated offenses. IPv4 addresses are banned individually, while IPv6 addresses are banned by their <code>/56</code> prefix.</p> <h2 id=ipv6-support>IPv6 support<a class=headerlink href=#ipv6-support title="Permanent link">&para;</a></h2> <p>ntfy fully supports IPv6, though there are a few things to keep in mind.</p> <ul> <li><strong>Listening on an IPv6 address</strong>: By default, ntfy listens on <code>:80</code> (IPv4-only). If you want to listen on an IPv6 address, you need to explicitly set the <code>listen-http</code> and/or <code>listen-https</code> options in your <code>server.yml</code> file to an IPv6 address, e.g. <code>[::]:80</code>. To listen on IPv4 and IPv6, you must run ntfy behind a reverse proxy, e.g. <code>listen :80; listen [::]:80;</code> in nginx.</li> <li><strong>Rate limiting:</strong> By default, ntfy uses the <code>/64</code> subnet of the visitor's IPv6 address for rate limiting. This means that all visitors in the same <code>/64</code> subnet are treated as one visitor. If you want to change this, you can set the <code>visitor-prefix-bits-ipv6</code> option in your <code>server.yml</code> file to a different value (e.g. <code>48</code> for <code>/48</code> subnets). See <a href=#ipv6-considerations>IPv6 considerations</a> and <a href=#ip-based-rate-limiting>IP-based rate limiting</a> for more details.</li> <li><strong>Banning IPs with fail2ban:</strong> By default, if you're using the <code>iptables-multiport</code> action, fail2ban bans individual IPv4 and IPv6 addresses via <code>iptables</code> and <code>ip6tables</code>. While this behavior is fine for IPv4, it is not for IPv6, because every host can technically have up to 2^64 addresses. Please ensure that your <code>actionban</code> and <code>actionunban</code> commands support IPv6 and also ban the entire prefix (e.g. <code>/48</code>). See <a href=#banning-bad-actors-fail2ban>Banning bad actors</a> for details.</li> </ul> <div class="admonition info"> <p class=admonition-title>Info</p> <p>The official ntfy.sh server supports IPv6. Check out ntfy.sh's <a href=https://github.com/binwiederhier/ntfy-ansible>Ansible repository</a> for examples of how to configure <a href=https://github.com/binwiederhier/ntfy-ansible/tree/main/roles/ntfy>ntfy</a>, <a href=https://github.com/binwiederhier/ntfy-ansible/tree/main/roles/nginx>nginx</a> and <a href=https://github.com/binwiederhier/ntfy-ansible/tree/main/roles/fail2ban>fail2ban</a>.</p> </div> <h2 id=health-checks>Health checks<a class=headerlink href=#health-checks title="Permanent link">&para;</a></h2> <p>A preliminary health check API endpoint is exposed at <code>/v1/health</code>. The endpoint returns a <code>json</code> response in the format shown below. If a non-200 HTTP status code is returned or if the returned <code>healthy</code> field is <code>false</code> the ntfy service should be considered as unhealthy.</p> <div class=highlight><pre><span></span><code><span class=p>{</span><span class=nt>&quot;healthy&quot;</span><span class=p>:</span><span class=kc>true</span><span class=p>}</span>
</code></pre></div> <p>See <a href=../install/#docker>Installation for Docker</a> for an example of how this could be used in a <code>docker-compose</code> environment.</p> <h2 id=monitoring>Monitoring<a class=headerlink href=#monitoring title="Permanent link">&para;</a></h2> <p>If configured, ntfy can expose a <code>/metrics</code> endpoint for <a href=https://prometheus.io/ >Prometheus</a>, which can then be used to create dashboards and alerts (e.g. via <a href=https://grafana.com/ >Grafana</a>).</p> <p>To configure the metrics endpoint, either set <code>enable-metrics</code> and/or set the <code>listen-metrics-http</code> option to a dedicated listen address. Metrics may be considered sensitive information, so before you enable them, be sure you know what you are doing, and/or secure access to the endpoint in your reverse proxy.</p> <ul> <li><code>enable-metrics</code> enables the /metrics endpoint for the default ntfy server (i.e. HTTP, HTTPS and/or Unix socket)</li> <li><code>metrics-listen-http</code> exposes the metrics endpoint via a dedicated <code>[IP]:port</code>. If set, this option implicitly enables metrics as well, e.g. "10.0.1.1:9090" or ":9090"</li> </ul> <div class="tabbed-set tabbed-alternate" data-tabs=19:2><input checked=checked id=__tabbed_19_1 name=__tabbed_19 type=radio><input id=__tabbed_19_2 name=__tabbed_19 type=radio><div class=tabbed-labels><label for=__tabbed_19_1>server.yml (Using default port)</label><label for=__tabbed_19_2>server.yml (Using dedicated IP/port)</label></div> <div class=tabbed-content> <div class=tabbed-block> <div class=highlight><pre><span></span><code><span class=nt>enable-metrics</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
</code></pre></div> </div> <div class=tabbed-block> <div class=highlight><pre><span></span><code><span class=nt>metrics-listen-http</span><span class=p>:</span><span class=w> </span><span class=s>&quot;10.0.1.1:9090&quot;</span>
</code></pre></div> </div> </div> </div> <p>In Prometheus, an example scrape config would look like this:</p> <div class="tabbed-set tabbed-alternate" data-tabs=20:1><input checked=checked id=__tabbed_20_1 name=__tabbed_20 type=radio><div class=tabbed-labels><label for=__tabbed_20_1>prometheus.yml</label></div> <div class=tabbed-content> <div class=tabbed-block> <div class=highlight><pre><span></span><code><span class=nt>scrape_configs</span><span class=p>:</span>
<span class=w>  </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>job_name</span><span class=p>:</span><span class=w> </span><span class=s>&quot;ntfy&quot;</span>
<span class=w>    </span><span class=nt>static_configs</span><span class=p>:</span>
<span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>targets</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">[</span><span class=s>&quot;10.0.1.1:9090&quot;</span><span class="p p-Indicator">]</span>
</code></pre></div> </div> </div> </div> <p>Here's an example Grafana dashboard built from the metrics (see <a href=https://raw.githubusercontent.com/binwiederhier/ntfy/main/examples/grafana-dashboard/ntfy-grafana.json>Grafana JSON on GitHub</a>):</p> <figure style="padding-left: 50px; padding-right: 50px"> <p><a href=../../static/img/grafana-dashboard.png target=_blank><img src=../../static/img/grafana-dashboard.png></a> </p> <figcaption>ntfy Grafana dashboard</figcaption> </figure> <h2 id=profiling>Profiling<a class=headerlink href=#profiling title="Permanent link">&para;</a></h2> <p>ntfy can expose Go's <a href=https://pkg.go.dev/net/http/pprof>net/http/pprof</a> endpoints to support profiling of the ntfy server. If enabled, ntfy will listen on a dedicated listen IP/port, which can be accessed via the web browser on <code>http://&lt;ip&gt;:&lt;port&gt;/debug/pprof/</code>. This can be helpful to expose bottlenecks, and visualize call flows. To enable, simply set the <code>profile-listen-http</code> config option.</p> <h2 id=logging-debugging>Logging &amp; debugging<a class=headerlink href=#logging-debugging title="Permanent link">&para;</a></h2> <p>By default, ntfy logs to the console (stderr), with an <code>info</code> log level, and in a human-readable text format.</p> <p>ntfy supports five different log levels, can also write to a file, log as JSON, and even supports granular log level overrides for easier debugging. Some options (<code>log-level</code> and <code>log-level-overrides</code>) can be hot reloaded by calling <code>kill -HUP $pid</code> or <code>systemctl reload ntfy</code>.</p> <p>The following config options define the logging behavior:</p> <ul> <li><code>log-format</code> defines the output format, can be <code>text</code> (default) or <code>json</code></li> <li><code>log-file</code> is a filename to write logs to. If this is not set, ntfy logs to stderr.</li> <li><code>log-level</code> defines the default log level, can be one of <code>trace</code>, <code>debug</code>, <code>info</code> (default), <code>warn</code> or <code>error</code>. Be aware that <code>debug</code> (and particularly <code>trace</code>) can be <strong>very verbose</strong>. Only turn them on briefly for debugging purposes.</li> <li><code>log-level-overrides</code> lets you override the log level if certain fields match. This is incredibly powerful for debugging certain parts of the system (e.g. only the account management, or only a certain visitor). This is an array of strings in the format:<ul> <li><code>field=value -&gt; level</code> to match a value exactly, e.g. <code>tag=manager -&gt; trace</code></li> <li><code>field -&gt; level</code> to match any value, e.g. <code>time_taken_ms -&gt; debug</code></li> </ul> </li> </ul> <p><strong>Logging config (good for production use):</strong> <div class=highlight><pre><span></span><code><span class=nt>log-level</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">info</span>
<span class=nt>log-format</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">json</span>
<span class=nt>log-file</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">/var/log/ntfy.log</span>
</code></pre></div></p> <p><strong>Temporary debugging:</strong> <br> If something's not working right, you can debug/trace through what the ntfy server is doing by setting the <code>log-level</code> to <code>debug</code> or <code>trace</code>. The <code>debug</code> setting will output information about each published message, but not the message contents. The <code>trace</code> setting will also print the message contents.</p> <p>Alternatively, you can set <code>log-level-overrides</code> for only certain fields, such as a visitor's IP address (<code>visitor_ip</code>), a username (<code>user_name</code>), or a tag (<code>tag</code>). There are dozens of fields you can use to override log levels. To learn what they are, either turn the log-level to <code>trace</code> and observe, or reference the <a href=https://github.com/binwiederhier/ntfy>source code</a>.</p> <p>Here's an example that will output only <code>info</code> log events, except when they match either of the defined overrides: <div class=highlight><pre><span></span><code><span class=nt>log-level</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">info</span>
<span class=nt>log-level-overrides</span><span class=p>:</span>
<span class=w>  </span><span class="p p-Indicator">-</span><span class=w> </span><span class=s>&quot;tag=manager</span><span class=nv> </span><span class=s>-&gt;</span><span class=nv> </span><span class=s>trace&quot;</span>
<span class=w>  </span><span class="p p-Indicator">-</span><span class=w> </span><span class=s>&quot;visitor_ip=1.2.3.4</span><span class=nv> </span><span class=s>-&gt;</span><span class=nv> </span><span class=s>debug&quot;</span>
<span class=w>  </span><span class="p p-Indicator">-</span><span class=w> </span><span class=s>&quot;time_taken_ms</span><span class=nv> </span><span class=s>-&gt;</span><span class=nv> </span><span class=s>debug&quot;</span>
</code></pre></div></p> <div class="admonition warning"> <p class=admonition-title>Warning</p> <p>The <code>debug</code> and <code>trace</code> log levels are very verbose, and using <code>log-level-overrides</code> has a performance penalty. Only use it for temporary debugging.</p> </div> <p>You can also hot-reload the <code>log-level</code> and <code>log-level-overrides</code> by sending the <code>SIGHUP</code> signal to the process after editing the <code>server.yml</code> file. You can do so by calling <code>systemctl reload ntfy</code> (if ntfy is running inside systemd), or by calling <code>kill -HUP $(pidof ntfy)</code>. If successful, you'll see something like this:</p> <div class=highlight><pre><span></span><code>$ ntfy serve
2022/06/02 10:29:28 INFO Listening on :2586[http] :1025[smtp], log level is INFO
2022/06/02 10:29:34 INFO Partially hot reloading configuration ...
2022/06/02 10:29:34 INFO Log level is TRACE
</code></pre></div> <h2 id=config-options>Config options<a class=headerlink href=#config-options title="Permanent link">&para;</a></h2> <p>Each config option can be set in the config file <code>/etc/ntfy/server.yml</code> (e.g. <code>listen-http: :80</code>) or as a CLI option (e.g. <code>--listen-http :80</code>. Here's a list of all available options. Alternatively, you can set an environment variable before running the <code>ntfy</code> command (e.g. <code>export NTFY_LISTEN_HTTP=:80</code>).</p> <div class="admonition info"> <p class=admonition-title>Info</p> <p>All config options can also be defined in the <code>server.yml</code> file using underscores instead of dashes, e.g. <code>cache_duration</code> and <code>cache-duration</code> are both supported. This is to support stricter YAML parsers that do not support dashes.</p> </div> <table> <thead> <tr> <th>Config option</th> <th>Env variable</th> <th>Format</th> <th>Default</th> <th>Description</th> </tr> </thead> <tbody> <tr> <td><code>base-url</code></td> <td><code>NTFY_BASE_URL</code></td> <td><em>URL</em></td> <td>-</td> <td>Public facing base URL of the service (e.g. <code>https://ntfy.sh</code>)</td> </tr> <tr> <td><code>listen-http</code></td> <td><code>NTFY_LISTEN_HTTP</code></td> <td><code>[host]:port</code></td> <td><code>:80</code></td> <td>Listen address for the HTTP web server</td> </tr> <tr> <td><code>listen-https</code></td> <td><code>NTFY_LISTEN_HTTPS</code></td> <td><code>[host]:port</code></td> <td>-</td> <td>Listen address for the HTTPS web server. If set, you also need to set <code>key-file</code> and <code>cert-file</code>.</td> </tr> <tr> <td><code>listen-unix</code></td> <td><code>NTFY_LISTEN_UNIX</code></td> <td><em>filename</em></td> <td>-</td> <td>Path to a Unix socket to listen on</td> </tr> <tr> <td><code>listen-unix-mode</code></td> <td><code>NTFY_LISTEN_UNIX_MODE</code></td> <td><em>file mode</em></td> <td><em>system default</em></td> <td>File mode of the Unix socket, e.g. 0700 or 0777</td> </tr> <tr> <td><code>key-file</code></td> <td><code>NTFY_KEY_FILE</code></td> <td><em>filename</em></td> <td>-</td> <td>HTTPS/TLS private key file, only used if <code>listen-https</code> is set.</td> </tr> <tr> <td><code>cert-file</code></td> <td><code>NTFY_CERT_FILE</code></td> <td><em>filename</em></td> <td>-</td> <td>HTTPS/TLS certificate file, only used if <code>listen-https</code> is set.</td> </tr> <tr> <td><code>firebase-key-file</code></td> <td><code>NTFY_FIREBASE_KEY_FILE</code></td> <td><em>filename</em></td> <td>-</td> <td>If set, also publish messages to a Firebase Cloud Messaging (FCM) topic for your app. This is optional and only required to save battery when using the Android app. See <a href=#firebase-fcm>Firebase (FCM)</a>.</td> </tr> <tr> <td><code>cache-file</code></td> <td><code>NTFY_CACHE_FILE</code></td> <td><em>filename</em></td> <td>-</td> <td>If set, messages are cached in a local SQLite database instead of only in-memory. This allows for service restarts without losing messages in support of the since= parameter. See <a href=#message-cache>message cache</a>.</td> </tr> <tr> <td><code>cache-duration</code></td> <td><code>NTFY_CACHE_DURATION</code></td> <td><em>duration</em></td> <td>12h</td> <td>Duration for which messages will be buffered before they are deleted. This is required to support the <code>since=...</code> and <code>poll=1</code> parameter. Set this to <code>0</code> to disable the cache entirely.</td> </tr> <tr> <td><code>cache-startup-queries</code></td> <td><code>NTFY_CACHE_STARTUP_QUERIES</code></td> <td><em>string (SQL queries)</em></td> <td>-</td> <td>SQL queries to run during database startup; this is useful for tuning and <a href=#message-cache>enabling WAL mode</a></td> </tr> <tr> <td><code>cache-batch-size</code></td> <td><code>NTFY_CACHE_BATCH_SIZE</code></td> <td><em>int</em></td> <td>0</td> <td>Max size of messages to batch together when writing to message cache (if zero, writes are synchronous)</td> </tr> <tr> <td><code>cache-batch-timeout</code></td> <td><code>NTFY_CACHE_BATCH_TIMEOUT</code></td> <td><em>duration</em></td> <td>0s</td> <td>Timeout for batched async writes to the message cache (if zero, writes are synchronous)</td> </tr> <tr> <td><code>auth-file</code></td> <td><code>NTFY_AUTH_FILE</code></td> <td><em>filename</em></td> <td>-</td> <td>Auth database file used for access control. If set, enables authentication and access control. See <a href=#access-control>access control</a>.</td> </tr> <tr> <td><code>auth-default-access</code></td> <td><code>NTFY_AUTH_DEFAULT_ACCESS</code></td> <td><code>read-write</code>, <code>read-only</code>, <code>write-only</code>, <code>deny-all</code></td> <td><code>read-write</code></td> <td>Default permissions if no matching entries in the auth database are found. Default is <code>read-write</code>.</td> </tr> <tr> <td><code>behind-proxy</code></td> <td><code>NTFY_BEHIND_PROXY</code></td> <td><em>bool</em></td> <td>false</td> <td>If set, use forwarded header (e.g. X-Forwarded-For, X-Client-IP) to determine visitor IP address (for rate limiting)</td> </tr> <tr> <td><code>proxy-forwarded-header</code></td> <td><code>NTFY_PROXY_FORWARDED_HEADER</code></td> <td><em>string</em></td> <td><code>X-Forwarded-For</code></td> <td>Use specified header to determine visitor IP address (for rate limiting)</td> </tr> <tr> <td><code>proxy-trusted-hosts</code></td> <td><code>NTFY_PROXY_TRUSTED_HOSTS</code></td> <td><em>comma-separated host/IP/CIDR list</em></td> <td>-</td> <td>Comma-separated list of trusted IP addresses, hosts, or CIDRs to remove from forwarded header</td> </tr> <tr> <td><code>attachment-cache-dir</code></td> <td><code>NTFY_ATTACHMENT_CACHE_DIR</code></td> <td><em>directory</em></td> <td>-</td> <td>Cache directory for attached files. To enable attachments, this has to be set.</td> </tr> <tr> <td><code>attachment-total-size-limit</code></td> <td><code>NTFY_ATTACHMENT_TOTAL_SIZE_LIMIT</code></td> <td><em>size</em></td> <td>5G</td> <td>Limit of the on-disk attachment cache directory. If the limits is exceeded, new attachments will be rejected.</td> </tr> <tr> <td><code>attachment-file-size-limit</code></td> <td><code>NTFY_ATTACHMENT_FILE_SIZE_LIMIT</code></td> <td><em>size</em></td> <td>15M</td> <td>Per-file attachment size limit (e.g. 300k, 2M, 100M). Larger attachment will be rejected.</td> </tr> <tr> <td><code>attachment-expiry-duration</code></td> <td><code>NTFY_ATTACHMENT_EXPIRY_DURATION</code></td> <td><em>duration</em></td> <td>3h</td> <td>Duration after which uploaded attachments will be deleted (e.g. 3h, 20h). Strongly affects <code>visitor-attachment-total-size-limit</code>.</td> </tr> <tr> <td><code>smtp-sender-addr</code></td> <td><code>NTFY_SMTP_SENDER_ADDR</code></td> <td><code>host:port</code></td> <td>-</td> <td>SMTP server address to allow email sending</td> </tr> <tr> <td><code>smtp-sender-user</code></td> <td><code>NTFY_SMTP_SENDER_USER</code></td> <td><em>string</em></td> <td>-</td> <td>SMTP user; only used if e-mail sending is enabled</td> </tr> <tr> <td><code>smtp-sender-pass</code></td> <td><code>NTFY_SMTP_SENDER_PASS</code></td> <td><em>string</em></td> <td>-</td> <td>SMTP password; only used if e-mail sending is enabled</td> </tr> <tr> <td><code>smtp-sender-from</code></td> <td><code>NTFY_SMTP_SENDER_FROM</code></td> <td><em>e-mail address</em></td> <td>-</td> <td>SMTP sender e-mail address; only used if e-mail sending is enabled</td> </tr> <tr> <td><code>smtp-server-listen</code></td> <td><code>NTFY_SMTP_SERVER_LISTEN</code></td> <td><code>[ip]:port</code></td> <td>-</td> <td>Defines the IP address and port the SMTP server will listen on, e.g. <code>:25</code> or <code>1.2.3.4:25</code></td> </tr> <tr> <td><code>smtp-server-domain</code></td> <td><code>NTFY_SMTP_SERVER_DOMAIN</code></td> <td><em>domain name</em></td> <td>-</td> <td>SMTP server e-mail domain, e.g. <code>ntfy.sh</code></td> </tr> <tr> <td><code>smtp-server-addr-prefix</code></td> <td><code>NTFY_SMTP_SERVER_ADDR_PREFIX</code></td> <td><em>string</em></td> <td>-</td> <td>Optional prefix for the e-mail addresses to prevent spam, e.g. <code>ntfy-</code></td> </tr> <tr> <td><code>twilio-account</code></td> <td><code>NTFY_TWILIO_ACCOUNT</code></td> <td><em>string</em></td> <td>-</td> <td>Twilio account SID, e.g. AC12345beefbeef67890beefbeef122586</td> </tr> <tr> <td><code>twilio-auth-token</code></td> <td><code>NTFY_TWILIO_AUTH_TOKEN</code></td> <td><em>string</em></td> <td>-</td> <td>Twilio auth token, e.g. affebeef258625862586258625862586</td> </tr> <tr> <td><code>twilio-phone-number</code></td> <td><code>NTFY_TWILIO_PHONE_NUMBER</code></td> <td><em>string</em></td> <td>-</td> <td>Twilio outgoing phone number, e.g. +18775132586</td> </tr> <tr> <td><code>twilio-verify-service</code></td> <td><code>NTFY_TWILIO_VERIFY_SERVICE</code></td> <td><em>string</em></td> <td>-</td> <td>Twilio Verify service SID, e.g. VA12345beefbeef67890beefbeef122586</td> </tr> <tr> <td><code>keepalive-interval</code></td> <td><code>NTFY_KEEPALIVE_INTERVAL</code></td> <td><em>duration</em></td> <td>45s</td> <td>Interval in which keepalive messages are sent to the client. This is to prevent intermediaries closing the connection for inactivity. Note that the Android app has a hardcoded timeout at 77s, so it should be less than that.</td> </tr> <tr> <td><code>manager-interval</code></td> <td><code>NTFY_MANAGER_INTERVAL</code></td> <td><em>duration</em></td> <td>1m</td> <td>Interval in which the manager prunes old messages, deletes topics and prints the stats.</td> </tr> <tr> <td><code>message-size-limit</code></td> <td><code>NTFY_MESSAGE_SIZE_LIMIT</code></td> <td><em>size</em></td> <td>4K</td> <td>The size limit for the message body. Please note that this is largely untested, and that FCM/APNS have limits around 4KB. If you increase this size limit, FCM and APNS will NOT work for large messages.</td> </tr> <tr> <td><code>message-delay-limit</code></td> <td><code>NTFY_MESSAGE_DELAY_LIMIT</code></td> <td><em>duration</em></td> <td>3d</td> <td>Amount of time a message can be <a href=../publish/#scheduled-delivery>scheduled</a> into the future when using the <code>Delay</code> header</td> </tr> <tr> <td><code>global-topic-limit</code></td> <td><code>NTFY_GLOBAL_TOPIC_LIMIT</code></td> <td><em>number</em></td> <td>15,000</td> <td>Rate limiting: Total number of topics before the server rejects new topics.</td> </tr> <tr> <td><code>upstream-base-url</code></td> <td><code>NTFY_UPSTREAM_BASE_URL</code></td> <td><em>URL</em></td> <td><code>https://ntfy.sh</code></td> <td>Forward poll request to an upstream server, this is needed for iOS push notifications for self-hosted servers</td> </tr> <tr> <td><code>upstream-access-token</code></td> <td><code>NTFY_UPSTREAM_ACCESS_TOKEN</code></td> <td><em>string</em></td> <td><code>tk_zyYLYj...</code></td> <td>Access token to use for the upstream server; needed only if upstream rate limits are exceeded or upstream server requires auth</td> </tr> <tr> <td><code>visitor-attachment-total-size-limit</code></td> <td><code>NTFY_VISITOR_ATTACHMENT_TOTAL_SIZE_LIMIT</code></td> <td><em>size</em></td> <td>100M</td> <td>Rate limiting: Total storage limit used for attachments per visitor, for all attachments combined. Storage is freed after attachments expire. See <code>attachment-expiry-duration</code>.</td> </tr> <tr> <td><code>visitor-attachment-daily-bandwidth-limit</code></td> <td><code>NTFY_VISITOR_ATTACHMENT_DAILY_BANDWIDTH_LIMIT</code></td> <td><em>size</em></td> <td>500M</td> <td>Rate limiting: Total daily attachment download/upload traffic limit per visitor. This is to protect your bandwidth costs from exploding.</td> </tr> <tr> <td><code>visitor-email-limit-burst</code></td> <td><code>NTFY_VISITOR_EMAIL_LIMIT_BURST</code></td> <td><em>number</em></td> <td>16</td> <td>Rate limiting:Initial limit of e-mails per visitor</td> </tr> <tr> <td><code>visitor-email-limit-replenish</code></td> <td><code>NTFY_VISITOR_EMAIL_LIMIT_REPLENISH</code></td> <td><em>duration</em></td> <td>1h</td> <td>Rate limiting: Strongly related to <code>visitor-email-limit-burst</code>: The rate at which the bucket is refilled</td> </tr> <tr> <td><code>visitor-message-daily-limit</code></td> <td><code>NTFY_VISITOR_MESSAGE_DAILY_LIMIT</code></td> <td><em>number</em></td> <td>-</td> <td>Rate limiting: Allowed number of messages per day per visitor, reset every day at midnight (UTC). By default, this value is unset.</td> </tr> <tr> <td><code>visitor-request-limit-burst</code></td> <td><code>NTFY_VISITOR_REQUEST_LIMIT_BURST</code></td> <td><em>number</em></td> <td>60</td> <td>Rate limiting: Allowed GET/PUT/POST requests per second, per visitor. This setting is the initial bucket of requests each visitor has</td> </tr> <tr> <td><code>visitor-request-limit-replenish</code></td> <td><code>NTFY_VISITOR_REQUEST_LIMIT_REPLENISH</code></td> <td><em>duration</em></td> <td>5s</td> <td>Rate limiting: Strongly related to <code>visitor-request-limit-burst</code>: The rate at which the bucket is refilled</td> </tr> <tr> <td><code>visitor-request-limit-exempt-hosts</code></td> <td><code>NTFY_VISITOR_REQUEST_LIMIT_EXEMPT_HOSTS</code></td> <td><em>comma-separated host/IP/CIDR list</em></td> <td>-</td> <td>Rate limiting: List of hostnames and IPs to be exempt from request rate limiting</td> </tr> <tr> <td><code>visitor-subscription-limit</code></td> <td><code>NTFY_VISITOR_SUBSCRIPTION_LIMIT</code></td> <td><em>number</em></td> <td>30</td> <td>Rate limiting: Number of subscriptions per visitor (IP address)</td> </tr> <tr> <td><code>visitor-subscriber-rate-limiting</code></td> <td><code>NTFY_VISITOR_SUBSCRIBER_RATE_LIMITING</code></td> <td><em>bool</em></td> <td><code>false</code></td> <td>Rate limiting: Enables subscriber-based rate limiting</td> </tr> <tr> <td><code>visitor-prefix-bits-ipv4</code></td> <td><code>NTFY_VISITOR_PREFIX_BITS_IPV4</code></td> <td><em>number</em></td> <td>32</td> <td>Rate limiting: Number of bits to use for IPv4 visitor prefix, e.g. 24 for /24</td> </tr> <tr> <td><code>visitor-prefix-bits-ipv6</code></td> <td><code>NTFY_VISITOR_PREFIX_BITS_IPV6</code></td> <td><em>number</em></td> <td>64</td> <td>Rate limiting: Number of bits to use for IPv6 visitor prefix, e.g. 48 for /48</td> </tr> <tr> <td><code>web-root</code></td> <td><code>NTFY_WEB_ROOT</code></td> <td><em>path</em>, e.g. <code>/</code> or <code>/app</code>, or <code>disable</code></td> <td><code>/</code></td> <td>Sets root of the web app (e.g. /, or /app), or disables it entirely (disable)</td> </tr> <tr> <td><code>enable-signup</code></td> <td><code>NTFY_ENABLE_SIGNUP</code></td> <td><em>boolean</em> (<code>true</code> or <code>false</code>)</td> <td><code>false</code></td> <td>Allows users to sign up via the web app, or API</td> </tr> <tr> <td><code>enable-login</code></td> <td><code>NTFY_ENABLE_LOGIN</code></td> <td><em>boolean</em> (<code>true</code> or <code>false</code>)</td> <td><code>false</code></td> <td>Allows users to log in via the web app, or API</td> </tr> <tr> <td><code>enable-reservations</code></td> <td><code>NTFY_ENABLE_RESERVATIONS</code></td> <td><em>boolean</em> (<code>true</code> or <code>false</code>)</td> <td><code>false</code></td> <td>Allows users to reserve topics (if their tier allows it)</td> </tr> <tr> <td><code>stripe-secret-key</code></td> <td><code>NTFY_STRIPE_SECRET_KEY</code></td> <td><em>string</em></td> <td>-</td> <td>Payments: Key used for the Stripe API communication, this enables payments</td> </tr> <tr> <td><code>stripe-webhook-key</code></td> <td><code>NTFY_STRIPE_WEBHOOK_KEY</code></td> <td><em>string</em></td> <td>-</td> <td>Payments: Key required to validate the authenticity of incoming webhooks from Stripe</td> </tr> <tr> <td><code>billing-contact</code></td> <td><code>NTFY_BILLING_CONTACT</code></td> <td><em>email address</em> or <em>website</em></td> <td>-</td> <td>Payments: Email or website displayed in Upgrade dialog as a billing contact</td> </tr> <tr> <td><code>web-push-public-key</code></td> <td><code>NTFY_WEB_PUSH_PUBLIC_KEY</code></td> <td><em>string</em></td> <td>-</td> <td>Web Push: Public Key. Run <code>ntfy webpush keys</code> to generate</td> </tr> <tr> <td><code>web-push-private-key</code></td> <td><code>NTFY_WEB_PUSH_PRIVATE_KEY</code></td> <td><em>string</em></td> <td>-</td> <td>Web Push: Private Key. Run <code>ntfy webpush keys</code> to generate</td> </tr> <tr> <td><code>web-push-file</code></td> <td><code>NTFY_WEB_PUSH_FILE</code></td> <td><em>string</em></td> <td>-</td> <td>Web Push: Database file that stores subscriptions</td> </tr> <tr> <td><code>web-push-email-address</code></td> <td><code>NTFY_WEB_PUSH_EMAIL_ADDRESS</code></td> <td><em>string</em></td> <td>-</td> <td>Web Push: Sender email address</td> </tr> <tr> <td><code>web-push-startup-queries</code></td> <td><code>NTFY_WEB_PUSH_STARTUP_QUERIES</code></td> <td><em>string</em></td> <td>-</td> <td>Web Push: SQL queries to run against subscription database at startup</td> </tr> <tr> <td><code>web-push-expiry-duration</code></td> <td><code>NTFY_WEB_PUSH_EXPIRY_DURATION</code></td> <td><em>duration</em></td> <td>60d</td> <td>Web Push: Duration after which a subscription is considered stale and will be deleted. This is to prevent stale subscriptions.</td> </tr> <tr> <td><code>web-push-expiry-warning-duration</code></td> <td><code>NTFY_WEB_PUSH_EXPIRY_WARNING_DURATION</code></td> <td><em>duration</em></td> <td>55d</td> <td>Web Push: Duration after which a warning is sent to subscribers that their subscription will expire soon. This is to prevent stale subscriptions.</td> </tr> <tr> <td><code>log-format</code></td> <td><code>NTFY_LOG_FORMAT</code></td> <td><em>string</em></td> <td><code>text</code></td> <td>Defines the output format, can be text or json</td> </tr> <tr> <td><code>log-file</code></td> <td><code>NTFY_LOG_FILE</code></td> <td><em>string</em></td> <td>-</td> <td>Defines the filename to write logs to. If this is not set, ntfy logs to stderr</td> </tr> <tr> <td><code>log-level</code></td> <td><code>NTFY_LOG_LEVEL</code></td> <td><em>string</em></td> <td><code>info</code></td> <td>Defines the default log level, can be one of trace, debug, info, warn or error</td> </tr> </tbody> </table> <p>The format for a <em>duration</em> is: <code>&lt;number&gt;(smhd)</code>, e.g. 30s, 20m, 1h or 3d. <br> The format for a <em>size</em> is: <code>&lt;number&gt;(GMK)</code>, e.g. 1G, 200M or 4000k.</p> <h2 id=command-line-options>Command line options<a class=headerlink href=#command-line-options title="Permanent link">&para;</a></h2> <div class=highlight><pre><span></span><code>NAME:
   ntfy serve - Run the ntfy server

USAGE:
   ntfy serve [OPTIONS..]

CATEGORY:
   Server commands

DESCRIPTION:
   Run the ntfy server and listen for incoming requests

   The command will load the configuration from /etc/ntfy/server.yml. Config options can 
   be overridden using the command line options.

   Examples:
     ntfy serve                      # Starts server in the foreground (on port 80)
     ntfy serve --listen-http :8080  # Starts server with alternate port

OPTIONS:
   --debug, -d                                                                                                            enable debug logging (default: false) [$NTFY_DEBUG]
   --trace                                                                                                                enable tracing (very verbose, be careful) (default: false) [$NTFY_TRACE]
   --no-log-dates, --no_log_dates                                                                                         disable the date/time prefix (default: false) [$NTFY_NO_LOG_DATES]
   --log-level value, --log_level value                                                                                   set log level (default: &quot;INFO&quot;) [$NTFY_LOG_LEVEL]
   --log-level-overrides value, --log_level_overrides value [ --log-level-overrides value, --log_level_overrides value ]  set log level overrides [$NTFY_LOG_LEVEL_OVERRIDES]
   --log-format value, --log_format value                                                                                 set log format (default: &quot;text&quot;) [$NTFY_LOG_FORMAT]
   --log-file value, --log_file value                                                                                     set log file, default is STDOUT [$NTFY_LOG_FILE]
   --config value, -c value                                                                                               config file (default: &quot;/etc/ntfy/server.yml&quot;) [$NTFY_CONFIG_FILE]
   --base-url value, --base_url value, -B value                                                                           externally visible base URL for this host (e.g. https://ntfy.sh) [$NTFY_BASE_URL]
   --listen-http value, --listen_http value, -l value                                                                     ip:port used as HTTP listen address (default: &quot;:80&quot;) [$NTFY_LISTEN_HTTP]
   --listen-https value, --listen_https value, -L value                                                                   ip:port used as HTTPS listen address [$NTFY_LISTEN_HTTPS]
   --listen-unix value, --listen_unix value, -U value                                                                     listen on unix socket path [$NTFY_LISTEN_UNIX]
   --listen-unix-mode value, --listen_unix_mode value                                                                     file permissions of unix socket, e.g. 0700 (default: system default) [$NTFY_LISTEN_UNIX_MODE]
   --key-file value, --key_file value, -K value                                                                           private key file, if listen-https is set [$NTFY_KEY_FILE]
   --cert-file value, --cert_file value, -E value                                                                         certificate file, if listen-https is set [$NTFY_CERT_FILE]
   --firebase-key-file value, --firebase_key_file value, -F value                                                         Firebase credentials file; if set additionally publish to FCM topic [$NTFY_FIREBASE_KEY_FILE]
   --cache-file value, --cache_file value, -C value                                                                       cache file used for message caching [$NTFY_CACHE_FILE]
   --cache-duration since, --cache_duration since, -b since                                                               buffer messages for this time to allow since requests (default: &quot;12h&quot;) [$NTFY_CACHE_DURATION]
   --cache-batch-size value, --cache_batch_size value                                                                     max size of messages to batch together when writing to message cache (if zero, writes are synchronous) (default: 0) [$NTFY_BATCH_SIZE]
   --cache-batch-timeout value, --cache_batch_timeout value                                                               timeout for batched async writes to the message cache (if zero, writes are synchronous) (default: &quot;0s&quot;) [$NTFY_CACHE_BATCH_TIMEOUT]
   --cache-startup-queries value, --cache_startup_queries value                                                           queries run when the cache database is initialized [$NTFY_CACHE_STARTUP_QUERIES]
   --auth-file value, --auth_file value, -H value                                                                         auth database file used for access control [$NTFY_AUTH_FILE]
   --auth-startup-queries value, --auth_startup_queries value                                                             queries run when the auth database is initialized [$NTFY_AUTH_STARTUP_QUERIES]
   --auth-default-access value, --auth_default_access value, -p value                                                     default permissions if no matching entries in the auth database are found (default: &quot;read-write&quot;) [$NTFY_AUTH_DEFAULT_ACCESS]
   --attachment-cache-dir value, --attachment_cache_dir value                                                             cache directory for attached files [$NTFY_ATTACHMENT_CACHE_DIR]
   --attachment-total-size-limit value, --attachment_total_size_limit value, -A value                                     limit of the on-disk attachment cache (default: &quot;5G&quot;) [$NTFY_ATTACHMENT_TOTAL_SIZE_LIMIT]
   --attachment-file-size-limit value, --attachment_file_size_limit value, -Y value                                       per-file attachment size limit (e.g. 300k, 2M, 100M) (default: &quot;15M&quot;) [$NTFY_ATTACHMENT_FILE_SIZE_LIMIT]
   --attachment-expiry-duration value, --attachment_expiry_duration value, -X value                                       duration after which uploaded attachments will be deleted (e.g. 3h, 20h) (default: &quot;3h&quot;) [$NTFY_ATTACHMENT_EXPIRY_DURATION]
   --keepalive-interval value, --keepalive_interval value, -k value                                                       interval of keepalive messages (default: &quot;45s&quot;) [$NTFY_KEEPALIVE_INTERVAL]
   --manager-interval value, --manager_interval value, -m value                                                           interval of for message pruning and stats printing (default: &quot;1m&quot;) [$NTFY_MANAGER_INTERVAL]
   --disallowed-topics value, --disallowed_topics value [ --disallowed-topics value, --disallowed_topics value ]          topics that are not allowed to be used [$NTFY_DISALLOWED_TOPICS]
   --web-root value, --web_root value                                                                                     sets root of the web app (e.g. /, or /app), or disables it (disable) (default: &quot;/&quot;) [$NTFY_WEB_ROOT]
   --enable-signup, --enable_signup                                                                                       allows users to sign up via the web app, or API (default: false) [$NTFY_ENABLE_SIGNUP]
   --enable-login, --enable_login                                                                                         allows users to log in via the web app, or API (default: false) [$NTFY_ENABLE_LOGIN]
   --enable-reservations, --enable_reservations                                                                           allows users to reserve topics (if their tier allows it) (default: false) [$NTFY_ENABLE_RESERVATIONS]
   --upstream-base-url value, --upstream_base_url value                                                                   forward poll request to an upstream server, this is needed for iOS push notifications for self-hosted servers [$NTFY_UPSTREAM_BASE_URL]
   --upstream-access-token value, --upstream_access_token value                                                           access token to use for the upstream server; needed only if upstream rate limits are exceeded or upstream server requires auth [$NTFY_UPSTREAM_ACCESS_TOKEN]
   --smtp-sender-addr value, --smtp_sender_addr value                                                                     SMTP server address (host:port) for outgoing emails [$NTFY_SMTP_SENDER_ADDR]
   --smtp-sender-user value, --smtp_sender_user value                                                                     SMTP user (if e-mail sending is enabled) [$NTFY_SMTP_SENDER_USER]
   --smtp-sender-pass value, --smtp_sender_pass value                                                                     SMTP password (if e-mail sending is enabled) [$NTFY_SMTP_SENDER_PASS]
   --smtp-sender-from value, --smtp_sender_from value                                                                     SMTP sender address (if e-mail sending is enabled) [$NTFY_SMTP_SENDER_FROM]
   --smtp-server-listen value, --smtp_server_listen value                                                                 SMTP server address (ip:port) for incoming emails, e.g. :25 [$NTFY_SMTP_SERVER_LISTEN]
   --smtp-server-domain value, --smtp_server_domain value                                                                 SMTP domain for incoming e-mail, e.g. ntfy.sh [$NTFY_SMTP_SERVER_DOMAIN]
   --smtp-server-addr-prefix value, --smtp_server_addr_prefix value                                                       SMTP email address prefix for topics to prevent spam (e.g. &#39;ntfy-&#39;) [$NTFY_SMTP_SERVER_ADDR_PREFIX]
   --twilio-account value, --twilio_account value                                                                         Twilio account SID, used for phone calls, e.g. AC123... [$NTFY_TWILIO_ACCOUNT]
   --twilio-auth-token value, --twilio_auth_token value                                                                   Twilio auth token [$NTFY_TWILIO_AUTH_TOKEN]
   --twilio-phone-number value, --twilio_phone_number value                                                               Twilio number to use for outgoing calls [$NTFY_TWILIO_PHONE_NUMBER]
   --twilio-verify-service value, --twilio_verify_service value                                                           Twilio Verify service ID, used for phone number verification [$NTFY_TWILIO_VERIFY_SERVICE]
   --message-size-limit value, --message_size_limit value                                                                 size limit for the message (see docs for limitations) (default: &quot;4K&quot;) [$NTFY_MESSAGE_SIZE_LIMIT]
   --message-delay-limit value, --message_delay_limit value                                                               max duration a message can be scheduled into the future (default: &quot;3d&quot;) [$NTFY_MESSAGE_DELAY_LIMIT]
   --global-topic-limit value, --global_topic_limit value, -T value                                                       total number of topics allowed (default: 15000) [$NTFY_GLOBAL_TOPIC_LIMIT]
   --visitor-subscription-limit value, --visitor_subscription_limit value                                                 number of subscriptions per visitor (default: 30) [$NTFY_VISITOR_SUBSCRIPTION_LIMIT]
   --visitor-subscriber-rate-limiting, --visitor_subscriber_rate_limiting                                                 enables subscriber-based rate limiting (default: false) [$NTFY_VISITOR_SUBSCRIBER_RATE_LIMITING]
   --visitor-attachment-total-size-limit value, --visitor_attachment_total_size_limit value                               total storage limit used for attachments per visitor (default: &quot;100M&quot;) [$NTFY_VISITOR_ATTACHMENT_TOTAL_SIZE_LIMIT]
   --visitor-attachment-daily-bandwidth-limit value, --visitor_attachment_daily_bandwidth_limit value                     total daily attachment download/upload bandwidth limit per visitor (default: &quot;500M&quot;) [$NTFY_VISITOR_ATTACHMENT_DAILY_BANDWIDTH_LIMIT]
   --visitor-request-limit-burst value, --visitor_request_limit_burst value                                               initial limit of requests per visitor (default: 60) [$NTFY_VISITOR_REQUEST_LIMIT_BURST]
   --visitor-request-limit-replenish value, --visitor_request_limit_replenish value                                       interval at which burst limit is replenished (one per x) (default: &quot;5s&quot;) [$NTFY_VISITOR_REQUEST_LIMIT_REPLENISH]
   --visitor-request-limit-exempt-hosts value, --visitor_request_limit_exempt_hosts value                                 hostnames and/or IP addresses of hosts that will be exempt from the visitor request limit [$NTFY_VISITOR_REQUEST_LIMIT_EXEMPT_HOSTS]
   --visitor-message-daily-limit value, --visitor_message_daily_limit value                                               max messages per visitor per day, derived from request limit if unset (default: 0) [$NTFY_VISITOR_MESSAGE_DAILY_LIMIT]
   --visitor-email-limit-burst value, --visitor_email_limit_burst value                                                   initial limit of e-mails per visitor (default: 16) [$NTFY_VISITOR_EMAIL_LIMIT_BURST]
   --visitor-email-limit-replenish value, --visitor_email_limit_replenish value                                           interval at which burst limit is replenished (one per x) (default: &quot;1h&quot;) [$NTFY_VISITOR_EMAIL_LIMIT_REPLENISH]
   --visitor-prefix-bits-ipv4 value, --visitor_prefix_bits_ipv4 value                                                     number of bits of the IPv4 address to use for rate limiting (default: 32, full address) (default: 32) [$NTFY_VISITOR_PREFIX_BITS_IPV4]
   --visitor-prefix-bits-ipv6 value, --visitor_prefix_bits_ipv6 value                                                     number of bits of the IPv6 address to use for rate limiting (default: 64, /64 subnet) (default: 64) [$NTFY_VISITOR_PREFIX_BITS_IPV6]
   --behind-proxy, --behind_proxy, -P                                                                                     if set, use forwarded header (e.g. X-Forwarded-For, X-Client-IP) to determine visitor IP address (for rate limiting) (default: false) [$NTFY_BEHIND_PROXY]
   --proxy-forwarded-header value, --proxy_forwarded_header value                                                         use specified header to determine visitor IP address (for rate limiting) (default: &quot;X-Forwarded-For&quot;) [$NTFY_PROXY_FORWARDED_HEADER]
   --proxy-trusted-hosts value, --proxy_trusted_hosts value                                                               comma-separated list of trusted IP addresses, hosts, or CIDRs to remove from forwarded header [$NTFY_PROXY_TRUSTED_HOSTS]
   --stripe-secret-key value, --stripe_secret_key value                                                                   key used for the Stripe API communication, this enables payments [$NTFY_STRIPE_SECRET_KEY]
   --stripe-webhook-key value, --stripe_webhook_key value                                                                 key required to validate the authenticity of incoming webhooks from Stripe [$NTFY_STRIPE_WEBHOOK_KEY]
   --billing-contact value, --billing_contact value                                                                       e-mail or website to display in upgrade dialog (only if payments are enabled) [$NTFY_BILLING_CONTACT]
   --enable-metrics, --enable_metrics                                                                                     if set, Prometheus metrics are exposed via the /metrics endpoint (default: false) [$NTFY_ENABLE_METRICS]
   --metrics-listen-http value, --metrics_listen_http value                                                               ip:port used to expose the metrics endpoint (implicitly enables metrics) [$NTFY_METRICS_LISTEN_HTTP]
   --profile-listen-http value, --profile_listen_http value                                                               ip:port used to expose the profiling endpoints (implicitly enables profiling) [$NTFY_PROFILE_LISTEN_HTTP]
   --web-push-public-key value, --web_push_public_key value                                                               public key used for web push notifications [$NTFY_WEB_PUSH_PUBLIC_KEY]
   --web-push-private-key value, --web_push_private_key value                                                             private key used for web push notifications [$NTFY_WEB_PUSH_PRIVATE_KEY]
   --web-push-file value, --web_push_file value                                                                           file used to store web push subscriptions [$NTFY_WEB_PUSH_FILE]
   --web-push-email-address value, --web_push_email_address value                                                         e-mail address of sender, required to use browser push services [$NTFY_WEB_PUSH_EMAIL_ADDRESS]
   --web-push-startup-queries value, --web_push_startup_queries value                                                     queries run when the web push database is initialized [$NTFY_WEB_PUSH_STARTUP_QUERIES]
   --web-push-expiry-duration value, --web_push_expiry_duration value                                                     automatically expire unused subscriptions after this time (default: &quot;60d&quot;) [$NTFY_WEB_PUSH_EXPIRY_DURATION]
   --web-push-expiry-warning-duration value, --web_push_expiry_warning_duration value                                     send web push warning notification after this time before expiring unused subscriptions (default: &quot;55d&quot;) [$NTFY_WEB_PUSH_EXPIRY_WARNING_DURATION]
   --help, -h 
</code></pre></div> </article> </div> <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var labels=set.querySelector(".tabbed-labels");for(var tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script> <script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script> </div> </main> <footer class=md-footer> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-copyright> <div class=md-copyright__highlight> Made with â¤ï¸ by Philipp C. Heckel </div> Made with <a href=https://squidfunk.github.io/mkdocs-material/ target=_blank rel=noopener> Material for MkDocs </a> </div> <div class=md-social> <a href=https://github.com/binwiederhier target=_blank rel=noopener title=github.com class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 512 512"><!-- Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path fill=currentColor d="M202.1 328.7c0 20.9-10.9 55.1-36.7 55.1s-36.7-34.2-36.7-55.1 10.9-55.1 36.7-55.1 36.7 34.2 36.7 55.1M496 278.2c0 31.9-3.2 65.7-17.5 95-37.9 76.6-142.1 74.8-216.7 74.8-75.8 0-186.2 2.7-225.6-74.8-14.6-29-20.2-63.1-20.2-95 0-41.9 13.9-81.5 41.5-113.6-5.2-15.8-7.7-32.4-7.7-48.8 0-21.5 4.9-32.3 14.6-51.8 45.3 0 74.3 9 108.8 36 29-6.9 58.8-10 88.7-10 27 0 54.2 2.9 80.4 9.2 34-26.7 63-35.2 107.8-35.2 9.8 19.5 14.6 30.3 14.6 51.8 0 16.4-2.6 32.7-7.7 48.2 27.5 32.4 39 72.3 39 114.2m-64.3 50.5c0-43.9-26.7-82.6-73.5-82.6-18.9 0-37 3.4-56 6-14.9 2.3-29.8 3.2-45.1 3.2-15.2 0-30.1-.9-45.1-3.2-18.7-2.6-37-6-56-6-46.8 0-73.5 38.7-73.5 82.6 0 87.8 80.4 101.3 150.4 101.3h48.2c70.3 0 150.6-13.4 150.6-101.3m-82.6-55.1c-25.8 0-36.7 34.2-36.7 55.1s10.9 55.1 36.7 55.1 36.7-34.2 36.7-55.1-10.9-55.1-36.7-55.1"/></svg> </a> </div> </div> </div> </footer> </div> <div class=md-dialog data-md-component=dialog> <div class="md-dialog__inner md-typeset"></div> </div> <script id=__config type=application/json>{"base": "..", "features": ["search.suggest", "search.highlight", "search.share", "navigation.sections", "toc.integrate", "content.tabs.link"], "search": "../assets/javascripts/workers/search.d50fe291.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script> <script src=../assets/javascripts/bundle.50899def.min.js></script> <script src=../static/js/extra.js></script> </body> </html>